import{as as k,_ as me,r as y,a as D,t as ce,x as ge,c as fe,o as d,e as t,w as l,ay as _e,az as ye,G as V,b as L,h as be,j as ve,k as we,X as he,Y as Ve,aA as Ce,m as ke,A as T,Z as J,n,$ as Y,C as m,a6 as ze,a1 as Le,D as Te,a0 as Ee,a7 as Re,E as De,a2 as xe,aB as Pe,aC as Ue,z as f,aD as qe,p as C,ab as x}from"./index-DG9m7imz.js";/* empty css                   *//* empty css                   *//* empty css                             *//* empty css                *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                 *//* empty css                        */function Me(c){return k({url:"/system/log/login/page",method:"get",params:c})}function Oe(c){return k({url:`/system/log/login/${c}`,method:"delete"})}function Ye(){return k({url:"/system/log/login/clear",method:"delete"})}function Be(c){return k({url:"/system/log/operation/page",method:"get",params:c})}function $e(c){return k({url:`/system/log/operation/${c}`,method:"get"})}function Ae(c){return k({url:`/system/log/operation/${c}`,method:"delete"})}function Ie(){return k({url:"/system/log/operation/clear",method:"delete"})}const Se={class:"app-container"},He={class:"card-header"},Ne={class:"pagination"},Qe={class:"pagination"},je={__name:"index",setup(c){const P=y("login"),U=y(!1),B=y(0),$=y([]),b=D({current:1,size:10}),u=D({username:"",loginResult:"",timeRange:[]}),v=async()=>{U.value=!0;try{const[r,e]=u.timeRange||[],o=await Me({current:b.current,size:b.size,username:u.username||void 0,loginResult:u.loginResult||void 0,startTime:r,endTime:e});$.value=(o==null?void 0:o.records)||[],B.value=(o==null?void 0:o.total)||0}catch{C.error("查询登录日志失败")}finally{U.value=!1}},K=()=>{b.current=1,v()},W=()=>{u.username="",u.loginResult="",u.timeRange=[],b.current=1,v()},ee=async r=>{try{await x.confirm("确定删除这条登录日志吗？","提示",{type:"warning"}),await Oe(r.id),C.success("删除成功"),v()}catch{}},te=async()=>{try{await x.confirm("确定清空所有登录日志吗？","提示",{type:"warning"}),await Ye(),C.success("清空成功"),v()}catch{}},q=y(!1),A=y(0),I=y([]),w=D({current:1,size:10}),s=D({username:"",requestPath:"",success:null,timeRange:[]}),h=async()=>{q.value=!0;try{const[r,e]=s.timeRange||[],o=await Be({current:w.current,size:w.size,username:s.username||void 0,requestPath:s.requestPath||void 0,success:s.success,startTime:r,endTime:e});I.value=(o==null?void 0:o.records)||[],A.value=(o==null?void 0:o.total)||0}catch{C.error("查询操作日志失败")}finally{q.value=!1}},le=()=>{w.current=1,h()},ae=()=>{s.username="",s.requestPath="",s.success=null,s.timeRange=[],w.current=1,h()},M=y(!1),p=y(null),oe=async r=>{try{p.value=await $e(r.id),M.value=!0}catch{C.error("获取详情失败")}},ne=async r=>{try{await x.confirm("确定删除这条操作日志吗？","提示",{type:"warning"}),await Ae(r.id),C.success("删除成功"),h()}catch{}},se=async()=>{try{await x.confirm("确定清空所有操作日志吗？","提示",{type:"warning"}),await Ie(),C.success("清空成功"),h()}catch{}},S=()=>{P.value==="login"?v():h()},re=()=>{S()};return ce(()=>{v()}),(r,e)=>{const o=ke,O=we,_=ve,E=Ve,H=he,N=Ce,Q=be,i=Le,R=Te,j=ze,F=Re,G=ye,ie=_e,ue=De,g=Ue,de=Pe,pe=qe,z=ge("permission"),X=Ee;return d(),fe("div",Se,[t(ue,{class:"table-card",shadow:"never"},{header:l(()=>[L("div",He,[e[14]||(e[14]=L("span",null,"日志管理",-1)),L("div",null,[t(o,{icon:T(Y),onClick:S},{default:l(()=>[...e[13]||(e[13]=[n("刷新",-1)])]),_:1},8,["icon"])])])]),default:l(()=>[t(ie,{modelValue:P.value,"onUpdate:modelValue":e[11]||(e[11]=a=>P.value=a),onTabChange:re},{default:l(()=>[t(G,{label:"登录日志",name:"login"},{default:l(()=>[t(Q,{inline:!0,model:u,class:"query-form"},{default:l(()=>[t(_,{label:"用户名"},{default:l(()=>[t(O,{modelValue:u.username,"onUpdate:modelValue":e[0]||(e[0]=a=>u.username=a),placeholder:"用户名",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),t(_,{label:"结果"},{default:l(()=>[t(H,{modelValue:u.loginResult,"onUpdate:modelValue":e[1]||(e[1]=a=>u.loginResult=a),placeholder:"全部",clearable:"",style:{width:"140px"}},{default:l(()=>[t(E,{label:"成功",value:"success"}),t(E,{label:"失败",value:"fail"})]),_:1},8,["modelValue"])]),_:1}),t(_,{label:"时间"},{default:l(()=>[t(N,{modelValue:u.timeRange,"onUpdate:modelValue":e[2]||(e[2]=a=>u.timeRange=a),type:"datetimerange","range-separator":"至","start-placeholder":"开始","end-placeholder":"结束","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),t(_,null,{default:l(()=>[t(o,{type:"primary",icon:T(J),onClick:K},{default:l(()=>[...e[15]||(e[15]=[n("查询",-1)])]),_:1},8,["icon"]),t(o,{icon:T(Y),onClick:W},{default:l(()=>[...e[16]||(e[16]=[n("重置",-1)])]),_:1},8,["icon"]),V((d(),m(o,{type:"danger",plain:"",onClick:te},{default:l(()=>[...e[17]||(e[17]=[n(" 清空 ",-1)])]),_:1})),[[z,"system:log:login:clear"]])]),_:1})]),_:1},8,["model"]),V((d(),m(j,{data:$.value,border:"",stripe:""},{default:l(()=>[t(i,{label:"用户名",prop:"username",width:"160"}),t(i,{label:"结果",prop:"loginResult",width:"100"},{default:l(({row:a})=>[a.loginResult==="success"?(d(),m(R,{key:0,type:"success"},{default:l(()=>[...e[18]||(e[18]=[n("成功",-1)])]),_:1})):(d(),m(R,{key:1,type:"danger"},{default:l(()=>[...e[19]||(e[19]=[n("失败",-1)])]),_:1}))]),_:1}),t(i,{label:"失败原因",prop:"failReason","min-width":"200","show-overflow-tooltip":""}),t(i,{label:"IP",prop:"ip",width:"140"}),t(i,{label:"User-Agent",prop:"userAgent","min-width":"220","show-overflow-tooltip":""}),t(i,{label:"时间",prop:"createTime",width:"170"}),t(i,{label:"操作",fixed:"right",width:"100"},{default:l(({row:a})=>[V((d(),m(o,{link:"",type:"danger",onClick:Z=>ee(a)},{default:l(()=>[...e[20]||(e[20]=[n(" 删除 ",-1)])]),_:1},8,["onClick"])),[[z,"system:log:login:delete"]])]),_:1})]),_:1},8,["data"])),[[X,U.value]]),L("div",Ne,[t(F,{"current-page":b.current,"onUpdate:currentPage":e[3]||(e[3]=a=>b.current=a),"page-size":b.size,"onUpdate:pageSize":e[4]||(e[4]=a=>b.size=a),layout:"total, sizes, prev, pager, next, jumper",total:B.value,"page-sizes":[10,20,50,100],onSizeChange:v,onCurrentChange:v},null,8,["current-page","page-size","total"])])]),_:1}),t(G,{label:"操作日志",name:"operation"},{default:l(()=>[t(Q,{inline:!0,model:s,class:"query-form"},{default:l(()=>[t(_,{label:"用户名"},{default:l(()=>[t(O,{modelValue:s.username,"onUpdate:modelValue":e[5]||(e[5]=a=>s.username=a),placeholder:"用户名",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),t(_,{label:"路径"},{default:l(()=>[t(O,{modelValue:s.requestPath,"onUpdate:modelValue":e[6]||(e[6]=a=>s.requestPath=a),placeholder:"请求路径",clearable:"",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),t(_,{label:"状态"},{default:l(()=>[t(H,{modelValue:s.success,"onUpdate:modelValue":e[7]||(e[7]=a=>s.success=a),placeholder:"全部",clearable:"",style:{width:"140px"}},{default:l(()=>[t(E,{label:"成功",value:1}),t(E,{label:"失败",value:0})]),_:1},8,["modelValue"])]),_:1}),t(_,{label:"时间"},{default:l(()=>[t(N,{modelValue:s.timeRange,"onUpdate:modelValue":e[8]||(e[8]=a=>s.timeRange=a),type:"datetimerange","range-separator":"至","start-placeholder":"开始","end-placeholder":"结束","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),t(_,null,{default:l(()=>[t(o,{type:"primary",icon:T(J),onClick:le},{default:l(()=>[...e[21]||(e[21]=[n("查询",-1)])]),_:1},8,["icon"]),t(o,{icon:T(Y),onClick:ae},{default:l(()=>[...e[22]||(e[22]=[n("重置",-1)])]),_:1},8,["icon"]),V((d(),m(o,{type:"danger",plain:"",onClick:se},{default:l(()=>[...e[23]||(e[23]=[n(" 清空 ",-1)])]),_:1})),[[z,"system:log:operation:clear"]])]),_:1})]),_:1},8,["model"]),V((d(),m(j,{data:I.value,border:"",stripe:""},{default:l(()=>[t(i,{label:"用户名",prop:"username",width:"160"}),t(i,{label:"方法",prop:"httpMethod",width:"90"}),t(i,{label:"路径",prop:"requestPath","min-width":"220","show-overflow-tooltip":""}),t(i,{label:"耗时(ms)",prop:"costMs",width:"110"}),t(i,{label:"状态",prop:"success",width:"90"},{default:l(({row:a})=>[a.success===1?(d(),m(R,{key:0,type:"success"},{default:l(()=>[...e[24]||(e[24]=[n("成功",-1)])]),_:1})):(d(),m(R,{key:1,type:"danger"},{default:l(()=>[...e[25]||(e[25]=[n("失败",-1)])]),_:1}))]),_:1}),t(i,{label:"时间",prop:"createTime",width:"170"}),t(i,{label:"操作",fixed:"right",width:"160"},{default:l(({row:a})=>[V((d(),m(o,{link:"",type:"primary",onClick:Z=>oe(a)},{default:l(()=>[...e[26]||(e[26]=[n(" 详情 ",-1)])]),_:1},8,["onClick"])),[[z,"system:log:operation:query"]]),V((d(),m(o,{link:"",type:"danger",onClick:Z=>ne(a)},{default:l(()=>[...e[27]||(e[27]=[n(" 删除 ",-1)])]),_:1},8,["onClick"])),[[z,"system:log:operation:delete"]])]),_:1})]),_:1},8,["data"])),[[X,q.value]]),L("div",Qe,[t(F,{"current-page":w.current,"onUpdate:currentPage":e[9]||(e[9]=a=>w.current=a),"page-size":w.size,"onUpdate:pageSize":e[10]||(e[10]=a=>w.size=a),layout:"total, sizes, prev, pager, next, jumper",total:A.value,"page-sizes":[10,20,50,100],onSizeChange:h,onCurrentChange:h},null,8,["current-page","page-size","total"])])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(pe,{modelValue:M.value,"onUpdate:modelValue":e[12]||(e[12]=a=>M.value=a),title:"操作日志详情",size:"520px"},{default:l(()=>[p.value?(d(),m(de,{key:0,column:1,border:""},{default:l(()=>[t(g,{label:"用户名"},{default:l(()=>[n(f(p.value.username||"-"),1)]),_:1}),t(g,{label:"IP"},{default:l(()=>[n(f(p.value.ip||"-"),1)]),_:1}),t(g,{label:"User-Agent"},{default:l(()=>[n(f(p.value.userAgent||"-"),1)]),_:1}),t(g,{label:"HTTP方法"},{default:l(()=>[n(f(p.value.httpMethod||"-"),1)]),_:1}),t(g,{label:"请求路径"},{default:l(()=>[n(f(p.value.requestPath||"-"),1)]),_:1}),t(g,{label:"参数"},{default:l(()=>[n(f(p.value.requestParams||"-"),1)]),_:1}),t(g,{label:"结果"},{default:l(()=>[n(f(p.value.success===1?"成功":"失败"),1)]),_:1}),t(g,{label:"错误信息"},{default:l(()=>[n(f(p.value.errorMessage||"-"),1)]),_:1}),t(g,{label:"耗时(ms)"},{default:l(()=>[n(f(p.value.costMs??"-"),1)]),_:1}),t(g,{label:"时间"},{default:l(()=>[n(f(p.value.createTime||"-"),1)]),_:1})]),_:1})):xe("",!0)]),_:1},8,["modelValue"])])}}},at=me(je,[["__scopeId","data-v-81f6275d"]]);export{at as default};
