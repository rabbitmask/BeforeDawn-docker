import{_ as _e,u as ve,b as ge,r as u,y as G,c as C,z as ye,d as O,x as E,f as t,w as l,B as be,C as we,e as o,i as he,j as b,N as xe,t as w,Q as Ve,q as ke,O as Ce,L as Ee,p as Re,E as Fe,h as De,X as Le,F as P,D as H,G as Q,Y as ze,m as Se,n,Z as Ue,$ as Xe,a6 as Be,s as Te,H as Oe,a9 as $e,a7 as je,a8 as qe,v as z,aa as Ie}from"./index-gZy6T0gL.js";/* empty css                       *//* empty css                   *//* empty css               *//* empty css                      *//* empty css                  *//* empty css                 *//* empty css                *//* empty css               *//* empty css                */import{V as Me}from"./VulnListTable-BdzZz0M4.js";import{u as Ne}from"./dict-DPR_BHxq.js";import{a as Ge,d as Pe,f as He,r as Qe}from"./vulnerability-BzfCHx9x.js";/* empty css                   *//* empty css                        */import"./format-BQFyjrq8.js";import"./dict-DLIqIuKu.js";const Ye={class:"page-container"},Ze={class:"stats-content"},Ae={class:"stats-icon"},Je={class:"stats-info"},Ke={class:"stats-value"},We={class:"stats-content"},et={class:"stats-icon"},tt={class:"stats-info"},lt={class:"stats-value"},at={class:"stats-content"},st={class:"stats-icon"},ot={class:"stats-info"},nt={class:"stats-value"},rt={class:"stats-content"},it={class:"stats-icon"},ut={class:"stats-info"},dt={class:"stats-value"},ct={class:"card-header"},mt={class:"pagination-wrapper"},ft={__name:"index",setup(pt){const $=ve(),S=Ne();ge();const U=u(!1),Y=G(()=>S.getDictData("risk_level")),Z=G(()=>S.getDictData("vuln_status")),d=C({critical:0,high:0,medium:0,low:0}),r=C({keyword:"",riskLevel:"",status:""}),m=C({current:1,size:10}),X=u([]),B=u(0),h=u(!1),c=u(null),R=u(null),x=C({fixComment:""}),A={fixComment:[{required:!0,message:"请输入修复说明",trigger:"blur"},{min:3,message:"修复说明至少3个字符",trigger:"blur"}]},_=u(!1),J=s=>({critical:"danger",high:"warning",medium:"primary",low:"info"})[s]||"info",K=s=>({critical:"严重",high:"高危",medium:"中危",low:"低危"})[s]||s,W=s=>{d.critical=s.filter(e=>e.riskLevel==="critical").length,d.high=s.filter(e=>e.riskLevel==="high").length,d.medium=s.filter(e=>e.riskLevel==="medium").length,d.low=s.filter(e=>e.riskLevel==="low").length},f=async()=>{U.value=!0;try{const s={current:m.current,size:m.size,...r},e=await Ge(s);X.value=e.records||[],B.value=e.total||0,W(X.value)}catch(s){console.error("加载待办列表失败:",s),z.error("加载待办列表失败")}finally{U.value=!1}},V=()=>{m.current=1,f()},ee=()=>{Object.assign(r,{keyword:"",riskLevel:"",status:""}),V()},te=s=>{$.push(`/vulnerability/detail/${s.id}`)},le=s=>{c.value=s,x.fixComment="",h.value=!0},ae=()=>{var s;(s=R.value)==null||s.resetFields(),c.value=null},se=async()=>{R.value&&await R.value.validate(async s=>{if(s){_.value=!0;try{await He(c.value.id,x),z.success("提交修复成功，等待安全人员复测"),h.value=!1,f()}catch(e){console.error("提交修复失败:",e)}finally{_.value=!1}}})},oe=s=>{$.push(`/vulnerability/submit?id=${s.id}`)},k=u(!1),F=u(null),p=C({retestResult:"passed",retestComment:""}),ne={retestResult:[{required:!0,message:"请选择复测结果",trigger:"change"}],retestComment:[{required:!0,message:"请填写复测意见",trigger:"blur"},{min:3,message:"复测意见至少3个字符",trigger:"blur"}]},re=s=>{c.value=s,k.value=!0},ie=async()=>{F.value&&await F.value.validate(async s=>{if(s){_.value=!0;try{await Qe(c.value.id,p);const e=p.retestResult==="passed"?"复测通过":"复测不通过，已打回";z.success(e),k.value=!1,F.value.resetFields(),f()}catch(e){console.error("复测漏洞失败:",e)}finally{_.value=!1}}})},ue=s=>{Ie.confirm("确定要删除这个漏洞吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Pe(s.id),z.success("删除成功"),f()}catch(e){console.error("删除漏洞失败:",e)}}).catch(()=>{})};return ye(async()=>{await S.loadDicts(["risk_level","vuln_status"]),f()}),(s,e)=>{const v=he,g=we,D=be,de=Ee,L=De,i=Fe,j=ze,q=Le,y=Se,T=Re,ce=Te,me=Be,fe=Oe,I=$e,M=qe,pe=je;return E(),O("div",Ye,[t(de,{gutter:20,class:"stats-row"},{default:l(()=>[t(D,{xs:24,sm:12,md:6},{default:l(()=>[t(g,{shadow:"hover",class:"stats-card critical"},{default:l(()=>[o("div",Ze,[o("div",Ae,[t(v,null,{default:l(()=>[t(b(xe))]),_:1})]),o("div",Je,[o("div",Ke,w(d.critical),1),e[12]||(e[12]=o("div",{class:"stats-label"},"严重",-1))])])]),_:1})]),_:1}),t(D,{xs:24,sm:12,md:6},{default:l(()=>[t(g,{shadow:"hover",class:"stats-card high"},{default:l(()=>[o("div",We,[o("div",et,[t(v,null,{default:l(()=>[t(b(Ve))]),_:1})]),o("div",tt,[o("div",lt,w(d.high),1),e[13]||(e[13]=o("div",{class:"stats-label"},"高危",-1))])])]),_:1})]),_:1}),t(D,{xs:24,sm:12,md:6},{default:l(()=>[t(g,{shadow:"hover",class:"stats-card medium"},{default:l(()=>[o("div",at,[o("div",st,[t(v,null,{default:l(()=>[t(b(ke))]),_:1})]),o("div",ot,[o("div",nt,w(d.medium),1),e[14]||(e[14]=o("div",{class:"stats-label"},"中危",-1))])])]),_:1})]),_:1}),t(D,{xs:24,sm:12,md:6},{default:l(()=>[t(g,{shadow:"hover",class:"stats-card low"},{default:l(()=>[o("div",rt,[o("div",it,[t(v,null,{default:l(()=>[t(b(Ce))]),_:1})]),o("div",ut,[o("div",dt,w(d.low),1),e[15]||(e[15]=o("div",{class:"stats-label"},"低危",-1))])])]),_:1})]),_:1})]),_:1}),t(g,{shadow:"never",class:"search-card"},{default:l(()=>[t(T,{model:r,inline:""},{default:l(()=>[t(i,{label:"关键词"},{default:l(()=>[t(L,{modelValue:r.keyword,"onUpdate:modelValue":e[0]||(e[0]=a=>r.keyword=a),placeholder:"漏洞标题",clearable:"",style:{width:"200px"},onClear:V},null,8,["modelValue"])]),_:1}),t(i,{label:"风险等级"},{default:l(()=>[t(q,{modelValue:r.riskLevel,"onUpdate:modelValue":e[1]||(e[1]=a=>r.riskLevel=a),placeholder:"请选择",clearable:"",style:{width:"120px"},onChange:V},{default:l(()=>[(E(!0),O(P,null,H(Y.value,a=>(E(),Q(j,{key:a.dictValue,label:a.dictLabel,value:a.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"状态"},{default:l(()=>[t(q,{modelValue:r.status,"onUpdate:modelValue":e[2]||(e[2]=a=>r.status=a),placeholder:"请选择",clearable:"",style:{width:"120px"},onChange:V},{default:l(()=>[(E(!0),O(P,null,H(Z.value,a=>(E(),Q(j,{key:a.dictValue,label:a.dictLabel,value:a.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(i,null,{default:l(()=>[t(y,{type:"primary",onClick:V},{default:l(()=>[t(v,null,{default:l(()=>[t(b(Ue))]),_:1}),e[16]||(e[16]=n(" 搜索 ",-1))]),_:1}),t(y,{onClick:ee},{default:l(()=>[t(v,null,{default:l(()=>[t(b(Xe))]),_:1}),e[17]||(e[17]=n(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(g,{shadow:"never"},{header:l(()=>[o("div",ct,[o("span",null,"我的待办 ("+w(B.value)+")",1),t(ce,{type:"info"},{default:l(()=>[...e[18]||(e[18]=[n("按优先级排序：严重 > 高危 > 中危 > 低危",-1)])]),_:1})])]),default:l(()=>[t(Me,{data:X.value,loading:U.value,onView:te,onEdit:oe,onFix:le,onRetest:re,onDelete:ue},null,8,["data","loading"]),o("div",mt,[t(me,{"current-page":m.current,"onUpdate:currentPage":e[3]||(e[3]=a=>m.current=a),"page-size":m.size,"onUpdate:pageSize":e[4]||(e[4]=a=>m.size=a),total:B.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:f,onCurrentChange:f},null,8,["current-page","page-size","total"])])]),_:1}),t(I,{modelValue:h.value,"onUpdate:modelValue":e[7]||(e[7]=a=>h.value=a),title:"提交修复",width:"700px",onClose:ae},{footer:l(()=>[t(y,{onClick:e[6]||(e[6]=a=>h.value=!1)},{default:l(()=>[...e[19]||(e[19]=[n("取消",-1)])]),_:1}),t(y,{type:"primary",onClick:se,loading:_.value},{default:l(()=>[...e[20]||(e[20]=[n(" 确定提交 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[t(T,{ref_key:"fixFormRef",ref:R,model:x,rules:A,"label-width":"100px"},{default:l(()=>[t(i,{label:"漏洞标题"},{default:l(()=>{var a;return[t(L,{value:(a=c.value)==null?void 0:a.title,disabled:""},null,8,["value"])]}),_:1}),t(i,{label:"风险等级"},{default:l(()=>{var a;return[t(fe,{type:J((a=c.value)==null?void 0:a.riskLevel),size:"small"},{default:l(()=>{var N;return[n(w(K((N=c.value)==null?void 0:N.riskLevel)),1)]}),_:1},8,["type"])]}),_:1}),t(i,{label:"修复说明",prop:"fixComment"},{default:l(()=>[t(L,{modelValue:x.fixComment,"onUpdate:modelValue":e[5]||(e[5]=a=>x.fixComment=a),type:"textarea",rows:6,placeholder:`请详细描述修复方案和修复内容，例如：
1. 修复方案：XXX
2. 修复内容：XXX
3. 验证方法：XXX`},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(I,{modelValue:k.value,"onUpdate:modelValue":e[11]||(e[11]=a=>k.value=a),title:"复测漏洞",width:"600px","close-on-click-modal":!1},{footer:l(()=>[t(y,{onClick:e[10]||(e[10]=a=>k.value=!1)},{default:l(()=>[...e[23]||(e[23]=[n("取消",-1)])]),_:1}),t(y,{type:"primary",loading:_.value,onClick:ie},{default:l(()=>[...e[24]||(e[24]=[n(" 提交复测 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[t(T,{ref_key:"retestFormRef",ref:F,model:p,rules:ne,"label-width":"100px"},{default:l(()=>[t(i,{label:"复测结果",prop:"retestResult"},{default:l(()=>[t(pe,{modelValue:p.retestResult,"onUpdate:modelValue":e[8]||(e[8]=a=>p.retestResult=a)},{default:l(()=>[t(M,{value:"passed"},{default:l(()=>[...e[21]||(e[21]=[n("通过",-1)])]),_:1}),t(M,{value:"rejected"},{default:l(()=>[...e[22]||(e[22]=[n("不通过",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"复测意见",prop:"retestComment"},{default:l(()=>[t(L,{modelValue:p.retestComment,"onUpdate:modelValue":e[9]||(e[9]=a=>p.retestComment=a),type:"textarea",rows:5,placeholder:"请填写复测意见"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},St=_e(ft,[["__scopeId","data-v-7f458077"]]);export{St as default};
