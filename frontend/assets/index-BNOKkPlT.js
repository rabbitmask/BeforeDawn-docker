import{_ as se,a as D,r as f,t as ne,c as R,o as d,e as l,b as ue,G as de,w as t,j as ie,k as me,X as pe,Y as fe,m as ce,n,H as ge,A as g,Z as _e,$ as be,h as ve,I as ye,a0 as Ve,C as V,a1 as we,a2 as O,F,B as L,D as he,z as U,a3 as ke,a4 as Ee,a5 as Ce,a6 as Re,a7 as Ue,a8 as xe,a9 as ze,aa as Ne,ab as Z,p as h}from"./index-D-KiCPd7.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                       *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                 *//* empty css                        */import{a as Ie}from"./index-DvArlCla.js";import{g as Te,a as Be,b as De,d as Fe,u as Le,c as $e}from"./system-BJOK2zyP.js";import{r as Ae}from"./user-CSE56gtJ.js";function Se(k){return/^1[3-9]\d{9}$/.test(k)}function je(k){return/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/.test(k)}const qe={class:"page-container"},Pe={class:"toolbar"},Oe={__name:"index",setup(k){const i=D({keyword:"",status:null}),m=D({current:1,size:10,total:0}),x=f(!1),$=f([]),A=f([]),z=f([]),_=f(!1),N=f(""),b=f(!1),E=f(null),o=D({id:null,username:"",realName:"",email:"",phone:"",departmentId:null,userRole:"",password:"",status:1}),M={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:4,max:20,message:"用户名长度4-20位",trigger:"blur"}],realName:[{required:!0,message:"请输入姓名",trigger:"blur"}],email:[{validator:(r,e,s)=>{e&&!je(e)?s(new Error("邮箱格式不正确")):s()},trigger:"blur"}],phone:[{validator:(r,e,s)=>{e&&!Se(e)?s(new Error("手机号格式不正确")):s()},trigger:"blur"}],departmentId:[{required:!0,message:"请选择部门",trigger:"change"}],password:[{validator:(r,e,s)=>{!b.value&&!e?s(new Error("请输入密码")):e&&(e.length<6||e.length>20)?s(new Error("密码长度6-20位")):s()},trigger:"blur"}],userRole:[{required:!0,message:"请选择角色",trigger:"change"}]},I=f(!1),S=r=>{const e=z.value.find(s=>s.roleCode===r||s.id===r);return e?e.roleName:r},v=async()=>{x.value=!0;try{const r={current:m.current,size:m.size,...i},e=await Te(r);$.value=e.records,m.total=e.total}catch(r){console.error("加载用户列表失败:",r)}finally{x.value=!1}},G=async()=>{try{const r=await Be({current:1,size:1e3});A.value=r.records||[]}catch(r){console.error("加载部门列表失败:",r)}},H=async()=>{try{z.value=await De()}catch(r){console.error("加载角色列表失败:",r)}},j=()=>{m.current=1,v()},X=()=>{Object.assign(i,{username:"",realName:"",status:null}),j()},Y=()=>{b.value=!1,N.value="新增用户",Object.assign(o,{id:null,username:"",realName:"",email:"",phone:"",departmentId:null,userRole:"",password:"",status:1}),_.value=!0},J=r=>{b.value=!0,N.value="编辑用户",Object.assign(o,{id:r.id,username:r.username,realName:r.realName,email:r.email,phone:r.phone,departmentId:r.departmentId,userRole:r.userRole,status:r.status}),_.value=!0},K=()=>{var r;(r=E.value)==null||r.resetFields()},Q=async()=>{E.value&&await E.value.validate(async r=>{if(r){I.value=!0;try{b.value?(await Le(o.id,o),h.success("更新用户成功")):(await $e(o),h.success("创建用户成功")),_.value=!1,v()}catch(e){console.error("保存用户失败:",e)}finally{I.value=!1}}})},W=r=>{Z.confirm(`确定要将用户 "${r.username}" 的密码重置为默认密码 123456 吗？`,"重置密码",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Ae(r.id),h.success("重置密码成功，默认密码：123456")}catch(e){console.error("重置密码失败:",e),h.error(e.message||"重置密码失败")}}).catch(()=>{})},ee=r=>{Z.confirm(`确定要删除用户 "${r.username}" 吗？此操作不可恢复！`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Fe(r.id),h.success("删除用户成功"),v()}catch(e){console.error("删除用户失败:",e)}}).catch(()=>{})};return ne(()=>{v(),G(),H()}),(r,e)=>{const s=me,u=ie,C=fe,T=pe,y=ge,c=ce,q=ve,p=we,B=he,le=Re,ae=Ue,P=ze,te=xe,re=Ne,oe=Ve;return d(),R("div",qe,[l(q,{model:i,inline:!0,class:"search-form"},{default:t(()=>[l(u,{label:"关键词"},{default:t(()=>[l(s,{modelValue:i.keyword,"onUpdate:modelValue":e[0]||(e[0]=a=>i.keyword=a),placeholder:"用户名/姓名",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),l(u,{label:"状态"},{default:t(()=>[l(T,{modelValue:i.status,"onUpdate:modelValue":e[1]||(e[1]=a=>i.status=a),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:t(()=>[l(C,{label:"启用",value:1}),l(C,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1}),l(u,null,{default:t(()=>[l(c,{type:"primary",onClick:j},{default:t(()=>[l(y,null,{default:t(()=>[l(g(_e))]),_:1}),e[14]||(e[14]=n(" 查询 ",-1))]),_:1}),l(c,{onClick:X},{default:t(()=>[l(y,null,{default:t(()=>[l(g(be))]),_:1}),e[15]||(e[15]=n(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"]),ue("div",Pe,[l(c,{type:"primary",onClick:Y},{default:t(()=>[l(y,null,{default:t(()=>[l(g(ye))]),_:1}),e[16]||(e[16]=n(" 新增用户 ",-1))]),_:1})]),de((d(),V(le,{data:$.value,border:"",stripe:"",style:{width:"100%"}},{default:t(()=>[l(p,{prop:"username",label:"用户名",width:"150"}),l(p,{prop:"realName",label:"姓名",width:"120"}),l(p,{prop:"email",label:"邮箱",width:"200"}),l(p,{prop:"phone",label:"手机号",width:"130"}),l(p,{prop:"departmentName",label:"部门",width:"150"}),l(p,{label:"角色",width:"200"},{default:t(({row:a})=>[a.roleIds&&a.roleIds.length>0?(d(!0),R(F,{key:0},L(a.roleIds,w=>(d(),V(B,{key:w,size:"small",style:{"margin-right":"5px"}},{default:t(()=>[n(U(S(w)),1)]),_:2},1024))),128)):a.userRole?(d(),V(B,{key:1,size:"small"},{default:t(()=>[n(U(S(a.userRole)),1)]),_:2},1024)):O("",!0)]),_:1}),l(p,{label:"状态",width:"80"},{default:t(({row:a})=>[l(B,{type:a.status===1?"success":"danger"},{default:t(()=>[n(U(a.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(p,{prop:"createTime",label:"创建时间",width:"180"},{default:t(({row:a})=>[n(U(g(Ie)(a.createTime)),1)]),_:1}),l(p,{label:"操作",width:"260",fixed:"right"},{default:t(({row:a})=>[l(c,{link:"",type:"primary",onClick:w=>J(a)},{default:t(()=>[l(y,null,{default:t(()=>[l(g(ke))]),_:1}),e[17]||(e[17]=n(" 编辑 ",-1))]),_:1},8,["onClick"]),l(c,{link:"",type:"info",onClick:w=>W(a)},{default:t(()=>[l(y,null,{default:t(()=>[l(g(Ee))]),_:1}),e[18]||(e[18]=n(" 重置密码 ",-1))]),_:1},8,["onClick"]),l(c,{link:"",type:"danger",onClick:w=>ee(a)},{default:t(()=>[l(y,null,{default:t(()=>[l(g(Ce))]),_:1}),e[19]||(e[19]=n(" 删除 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[oe,x.value]]),l(ae,{"current-page":m.current,"onUpdate:currentPage":e[2]||(e[2]=a=>m.current=a),"page-size":m.size,"onUpdate:pageSize":e[3]||(e[3]=a=>m.size=a),total:m.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",class:"mt-20",onSizeChange:v,onCurrentChange:v},null,8,["current-page","page-size","total"]),l(re,{modelValue:_.value,"onUpdate:modelValue":e[13]||(e[13]=a=>_.value=a),title:N.value,width:"600px",onClose:K},{footer:t(()=>[l(c,{onClick:e[12]||(e[12]=a=>_.value=!1)},{default:t(()=>[...e[22]||(e[22]=[n("取消",-1)])]),_:1}),l(c,{type:"primary",onClick:Q,loading:I.value},{default:t(()=>[...e[23]||(e[23]=[n(" 确定 ",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(q,{ref_key:"userFormRef",ref:E,model:o,rules:M,"label-width":"100px"},{default:t(()=>[l(u,{label:"用户名",prop:"username"},{default:t(()=>[l(s,{modelValue:o.username,"onUpdate:modelValue":e[4]||(e[4]=a=>o.username=a),placeholder:"请输入用户名",disabled:b.value},null,8,["modelValue","disabled"])]),_:1}),l(u,{label:"姓名",prop:"realName"},{default:t(()=>[l(s,{modelValue:o.realName,"onUpdate:modelValue":e[5]||(e[5]=a=>o.realName=a),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),l(u,{label:"邮箱",prop:"email"},{default:t(()=>[l(s,{modelValue:o.email,"onUpdate:modelValue":e[6]||(e[6]=a=>o.email=a),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),l(u,{label:"手机号",prop:"phone"},{default:t(()=>[l(s,{modelValue:o.phone,"onUpdate:modelValue":e[7]||(e[7]=a=>o.phone=a),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),l(u,{label:"部门",prop:"departmentId"},{default:t(()=>[l(T,{modelValue:o.departmentId,"onUpdate:modelValue":e[8]||(e[8]=a=>o.departmentId=a),placeholder:"请选择部门",clearable:"",style:{width:"100%"}},{default:t(()=>[(d(!0),R(F,null,L(A.value,a=>(d(),V(C,{key:a.id,label:a.departmentName,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"角色",prop:"userRole"},{default:t(()=>[l(T,{modelValue:o.userRole,"onUpdate:modelValue":e[9]||(e[9]=a=>o.userRole=a),placeholder:"请选择角色",style:{width:"100%"}},{default:t(()=>[(d(!0),R(F,null,L(z.value,a=>(d(),V(C,{key:a.id,label:a.roleName,value:a.roleCode},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),b.value?O("",!0):(d(),V(u,{key:0,label:"密码",prop:"password",required:""},{default:t(()=>[l(s,{modelValue:o.password,"onUpdate:modelValue":e[10]||(e[10]=a=>o.password=a),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1})),l(u,{label:"状态",prop:"status"},{default:t(()=>[l(te,{modelValue:o.status,"onUpdate:modelValue":e[11]||(e[11]=a=>o.status=a)},{default:t(()=>[l(P,{value:1},{default:t(()=>[...e[20]||(e[20]=[n("启用",-1)])]),_:1}),l(P,{value:0},{default:t(()=>[...e[21]||(e[21]=[n("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},tl=se(Oe,[["__scopeId","data-v-6e4d26e6"]]);export{tl as default};
