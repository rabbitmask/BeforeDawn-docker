import{_ as Y,g as ee,f as te,u as ae,q as se,r as y,s as N,t as le,c,o as i,e as a,G as oe,w as s,b as l,aK as ne,a0 as ie,C as p,y as ue,E as ce,a2 as _,z as o,aZ as re,H as de,A as u,aV as _e,aX as ve,aG as V,aW as I,ad as me,F as R,B as L,D as pe,n as r,aI as fe,aP as ye,m as he,a3 as ge,aB as ke,aC as be,Q as we,K as Ce,p as x}from"./index-DG9m7imz.js";/* empty css                   *//* empty css               *//* empty css                             *//* empty css                *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                   *//* empty css                       */import{r as Te}from"./style-CLzRKhDd.js";import{b as Ee,m as De,g as Ae}from"./knowledge-8guogKc6.js";import{f as T}from"./format-BQFyjrq8.js";const Se={class:"page-container"},Be={class:"article-header"},Ne={class:"article-title"},Ve={class:"article-meta"},Ie={class:"meta-item"},Re={class:"author-name"},Le={class:"meta-item"},xe={class:"meta-item"},ze={class:"meta-item"},Ue={class:"article-tags-section"},Me={key:0,class:"category-tag"},$e={key:1,class:"tags-wrapper"},Fe={key:0,class:"article-summary"},Ge={class:"summary-title"},He={class:"article-footer"},Ke={class:"related-info"},Pe={key:0,class:"info-item"},qe={class:"info-value"},Qe={key:1,class:"info-item"},We={class:"info-value"},Xe={key:2,class:"info-item"},Ze={class:"info-value"},je={key:0,class:"recommend-list"},Je=["onClick"],Oe={class:"rec-title"},Ye={class:"rec-meta"},et="https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png",tt={__name:"detail",setup(at){const z=ee(),h=te(),E=ae(),g=se(),k=y(!1),e=y({}),b=y(!1),w=y([]),U=N(()=>e.value.vulnType||e.value.assetType||e.value.techStack),M=N(()=>{var n;return e.value.authorId===((n=E.userInfo)==null?void 0:n.id)||E.hasRole("ADMIN")}),$=n=>g.getDictLabel("vuln_type",n),F=n=>g.getDictLabel("asset_type",n),D=async()=>{k.value=!0;try{const n=z.params.id,t=await Ee(n);e.value=t,(t.vulnType||t.assetType||t.techStack)&&G({vulnType:t.vulnType,assetType:t.assetType,techStack:t.techStack})}catch(n){console.error("加载文章详情失败:",n),x.error("加载文章详情失败")}finally{k.value=!1}},G=async n=>{try{const t=await Ae(n);w.value=(t||[]).filter(C=>C.id!==e.value.id)}catch(t){console.error("加载推荐文章失败:",t)}},H=()=>{h.back()},K=async()=>{try{await De(e.value.id),e.value.usefulCount=(e.value.usefulCount||0)+1,b.value=!0,x.success("点赞成功")}catch(n){console.error("点赞失败:",n)}},P=()=>{h.push(`/knowledge/article/edit/${e.value.id}`)},q=n=>{h.push(`/knowledge/article/detail/${n}`),D()};return le(async()=>{await g.loadDicts(["vuln_type","asset_type"]),D()}),(n,t)=>{const C=ne,v=de,Q=re,W=pe,X=fe,A=he,f=ce,S=ue,m=be,Z=ke,j=we,J=Ce,O=ie;return i(),c("div",Se,[a(C,{onBack:H,class:"mb-20"},{content:s(()=>[...t[1]||(t[1]=[l("span",{class:"page-title"},"文章详情",-1)])]),_:1}),oe((i(),p(J,{gutter:20},{default:s(()=>[a(S,{span:18},{default:s(()=>[a(f,{shadow:"never",class:"article-card"},{default:s(()=>[l("div",Be,[l("h1",Ne,o(e.value.title),1),l("div",Ve,[l("div",Ie,[a(Q,{size:32,src:et},{default:s(()=>[a(v,null,{default:s(()=>[a(u(_e))]),_:1})]),_:1}),l("span",Re,o(e.value.authorName),1)]),l("div",Le,[a(v,null,{default:s(()=>[a(u(ve))]),_:1}),l("span",null,o(u(T)(e.value.publishTime||e.value.createTime)),1)]),l("div",xe,[a(v,null,{default:s(()=>[a(u(V))]),_:1}),l("span",null,o(e.value.viewCount||0)+" 浏览",1)]),l("div",ze,[a(v,null,{default:s(()=>[a(u(I))]),_:1}),l("span",null,o(e.value.usefulCount||0)+" 点赞",1)])]),l("div",Ue,[e.value.categoryName?(i(),c("div",Me,[a(v,null,{default:s(()=>[a(u(me))]),_:1}),l("span",null,o(e.value.categoryName),1)])):_("",!0),e.value.tags&&e.value.tags.length>0?(i(),c("div",$e,[(i(!0),c(R,null,L(e.value.tags,(d,B)=>(i(),p(W,{key:B,type:"info"},{default:s(()=>[r(o(d),1)]),_:2},1024))),128))])):_("",!0)])]),e.value.summary?(i(),c("div",Fe,[a(X,{type:"info",closable:!1},{title:s(()=>[l("div",Ge,[a(v,null,{default:s(()=>[a(u(ye))]),_:1}),t[2]||(t[2]=l("span",null,"内容摘要",-1))])]),default:s(()=>[r(" "+o(e.value.summary),1)]),_:1})])):_("",!0),a(u(Te),{modelValue:e.value.content,"onUpdate:modelValue":t[0]||(t[0]=d=>e.value.content=d),language:"zh-CN",class:"article-content"},null,8,["modelValue"]),l("div",He,[a(A,{type:"primary",icon:u(I),onClick:K,disabled:b.value},{default:s(()=>[r(o(b.value?"已点赞":"觉得有用")+" ("+o(e.value.usefulCount||0)+") ",1)]),_:1},8,["icon","disabled"]),M.value?(i(),p(A,{key:0,type:"warning",icon:u(ge),onClick:P},{default:s(()=>[...t[3]||(t[3]=[r(" 编辑文章 ",-1)])]),_:1},8,["icon"])):_("",!0)])]),_:1})]),_:1}),a(S,{span:6},{default:s(()=>[a(f,{shadow:"never",class:"mb-20"},{header:s(()=>[...t[4]||(t[4]=[l("span",null,"文章信息",-1)])]),default:s(()=>[a(Z,{column:1,border:"",size:"small"},{default:s(()=>[a(m,{label:"文章编号"},{default:s(()=>[r(o(e.value.articleCode),1)]),_:1}),a(m,{label:"浏览次数"},{default:s(()=>[r(o(e.value.viewCount||0),1)]),_:1}),a(m,{label:"引用次数"},{default:s(()=>[r(o(e.value.referenceCount||0),1)]),_:1}),a(m,{label:"点赞次数"},{default:s(()=>[r(o(e.value.usefulCount||0),1)]),_:1}),a(m,{label:"发布时间"},{default:s(()=>[r(o(u(T)(e.value.publishTime)),1)]),_:1}),a(m,{label:"更新时间"},{default:s(()=>[r(o(u(T)(e.value.updateTime)),1)]),_:1})]),_:1})]),_:1}),U.value?(i(),p(f,{key:0,shadow:"never",class:"mb-20"},{header:s(()=>[...t[5]||(t[5]=[l("span",null,"关联信息",-1)])]),default:s(()=>[l("div",Ke,[e.value.vulnType?(i(),c("div",Pe,[t[6]||(t[6]=l("div",{class:"info-label"},"漏洞类型",-1)),l("div",qe,o($(e.value.vulnType)),1)])):_("",!0),e.value.assetType?(i(),c("div",Qe,[t[7]||(t[7]=l("div",{class:"info-label"},"资产类型",-1)),l("div",We,o(F(e.value.assetType)),1)])):_("",!0),e.value.techStack?(i(),c("div",Xe,[t[8]||(t[8]=l("div",{class:"info-label"},"技术栈",-1)),l("div",Ze,o(e.value.techStack),1)])):_("",!0)])]),_:1})):_("",!0),a(f,{shadow:"never"},{header:s(()=>[...t[9]||(t[9]=[l("span",null,"相关文章",-1)])]),default:s(()=>[w.value.length>0?(i(),c("div",je,[(i(!0),c(R,null,L(w.value,d=>(i(),c("div",{key:d.id,class:"recommend-item",onClick:B=>q(d.id)},[l("h4",Oe,o(d.title),1),l("div",Ye,[a(v,null,{default:s(()=>[a(u(V))]),_:1}),l("span",null,o(d.viewCount||0),1)])],8,Je))),128))])):(i(),p(j,{key:1,description:"暂无推荐","image-size":80}))]),_:1})]),_:1})]),_:1})),[[O,k.value]])])}}},ft=Y(tt,[["__scopeId","data-v-71e637b8"]]);export{ft as default};
