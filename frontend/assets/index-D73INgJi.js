import{_ as me,c as P,r as d,z as pe,d as x,x as p,f as l,e as fe,I as ge,w as t,E as ce,h as ve,X as we,Y as _e,m as be,n,i as Ve,j as v,Z as ye,$ as Ee,p as Ue,J as Re,a0 as ke,G as E,a1 as Ce,a2 as J,F as q,D as S,H as Ne,t as z,a3 as Pe,l as xe,a4 as ze,a5 as he,a6 as Ie,a7 as Fe,a8 as De,a9 as Le,aa as Te,v as h}from"./index-DNLodC6g.js";/* empty css                   *//* empty css                   *//* empty css                       *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                 *//* empty css                        */import{a as $e}from"./index-uw5tQqLt.js";import{g as Be,a as qe,b as Se,d as je,u as Ae,c as Oe}from"./system-BCQgmnTM.js";import{r as Ze}from"./user-BU_kqE_Q.js";function Me(k){return/^1[3-9]\d{9}$/.test(k)}function Ge(k){return/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/.test(k)}const He={class:"page-container"},Je={class:"toolbar"},Xe={__name:"index",setup(k){const i=P({username:"",realName:"",status:null}),f=P({current:1,size:10,total:0}),I=d(!1),j=d([]),A=d([]),F=d([]),w=d(!1),D=d(""),_=d(!1),C=d(null),o=P({id:null,username:"",realName:"",email:"",phone:"",departmentId:null,userRole:"",password:"",status:1}),X={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:4,max:20,message:"用户名长度4-20位",trigger:"blur"}],realName:[{required:!0,message:"请输入姓名",trigger:"blur"}],email:[{validator:(r,e,s)=>{e&&!Ge(e)?s(new Error("邮箱格式不正确")):s()},trigger:"blur"}],phone:[{validator:(r,e,s)=>{e&&!Me(e)?s(new Error("手机号格式不正确")):s()},trigger:"blur"}],departmentId:[{required:!0,message:"请选择部门",trigger:"change"}],password:[{validator:(r,e,s)=>{!_.value&&!e?s(new Error("请输入密码")):e&&(e.length<6||e.length>20)?s(new Error("密码长度6-20位")):s()},trigger:"blur"}],userRole:[{required:!0,message:"请选择角色",trigger:"change"}]},O=d(null),U=d(!1),L=d(null),c=P({newPassword:"",confirmPassword:""}),Y={newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:20,message:"密码长度6-20位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入密码",trigger:"blur"},{validator:(r,e,s)=>{e!==c.newPassword?s(new Error("两次输入的密码不一致")):s()},trigger:"blur"}]},b=d(!1),Z=r=>{const e=F.value.find(s=>s.roleCode===r||s.id===r);return e?e.roleName:r},V=async()=>{I.value=!0;try{const r={current:f.current,size:f.size,...i},e=await Be(r);j.value=e.records,f.total=e.total}catch(r){console.error("加载用户列表失败:",r)}finally{I.value=!1}},K=async()=>{try{const r=await qe({current:1,size:1e3});A.value=r.records||[]}catch(r){console.error("加载部门列表失败:",r)}},Q=async()=>{try{F.value=await Se()}catch(r){console.error("加载角色列表失败:",r)}},M=()=>{f.current=1,V()},W=()=>{Object.assign(i,{username:"",realName:"",status:null}),M()},ee=()=>{_.value=!1,D.value="新增用户",Object.assign(o,{id:null,username:"",realName:"",email:"",phone:"",departmentId:null,userRole:"",password:"",status:1}),w.value=!0},le=r=>{_.value=!0,D.value="编辑用户",Object.assign(o,{id:r.id,username:r.username,realName:r.realName,email:r.email,phone:r.phone,departmentId:r.departmentId,userRole:r.userRole,status:r.status}),w.value=!0},ae=()=>{var r;(r=C.value)==null||r.resetFields()},te=async()=>{C.value&&await C.value.validate(async r=>{if(r){b.value=!0;try{_.value?(await Ae(o.id,o),h.success("更新用户成功")):(await Oe(o),h.success("创建用户成功")),w.value=!1,V()}catch(e){console.error("保存用户失败:",e)}finally{b.value=!1}}})},re=r=>{O.value=r.id,Object.assign(c,{newPassword:"",confirmPassword:""}),U.value=!0},se=async()=>{L.value&&await L.value.validate(async r=>{if(r){b.value=!0;try{await Ze(O.value,{newPassword:c.newPassword}),h.success("重置密码成功"),U.value=!1}catch(e){console.error("重置密码失败:",e)}finally{b.value=!1}}})},oe=r=>{Te.confirm(`确定要删除用户 "${r.username}" 吗？此操作不可恢复！`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await je(r.id),h.success("删除用户成功"),V()}catch(e){console.error("删除用户失败:",e)}}).catch(()=>{})};return pe(()=>{V(),K(),Q()}),(r,e)=>{const s=ve,u=ce,N=_e,T=we,y=Ve,m=be,$=Ue,g=Ce,B=Ne,ne=he,ue=Ie,G=De,de=Fe,H=Le,ie=ke;return p(),x("div",He,[l($,{model:i,inline:!0,class:"search-form"},{default:t(()=>[l(u,{label:"用户名"},{default:t(()=>[l(s,{modelValue:i.username,"onUpdate:modelValue":e[0]||(e[0]=a=>i.username=a),placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1}),l(u,{label:"姓名"},{default:t(()=>[l(s,{modelValue:i.realName,"onUpdate:modelValue":e[1]||(e[1]=a=>i.realName=a),placeholder:"请输入姓名",clearable:""},null,8,["modelValue"])]),_:1}),l(u,{label:"状态"},{default:t(()=>[l(T,{modelValue:i.status,"onUpdate:modelValue":e[2]||(e[2]=a=>i.status=a),placeholder:"请选择状态",clearable:""},{default:t(()=>[l(N,{label:"启用",value:1}),l(N,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1}),l(u,null,{default:t(()=>[l(m,{type:"primary",onClick:M},{default:t(()=>[l(y,null,{default:t(()=>[l(v(ye))]),_:1}),e[19]||(e[19]=n(" 查询 ",-1))]),_:1}),l(m,{onClick:W},{default:t(()=>[l(y,null,{default:t(()=>[l(v(Ee))]),_:1}),e[20]||(e[20]=n(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"]),fe("div",Je,[l(m,{type:"primary",onClick:ee},{default:t(()=>[l(y,null,{default:t(()=>[l(v(Re))]),_:1}),e[21]||(e[21]=n(" 新增用户 ",-1))]),_:1})]),ge((p(),E(ne,{data:j.value,border:"",stripe:"",style:{width:"100%"}},{default:t(()=>[l(g,{prop:"username",label:"用户名",width:"150"}),l(g,{prop:"realName",label:"姓名",width:"120"}),l(g,{prop:"email",label:"邮箱",width:"200"}),l(g,{prop:"phone",label:"手机号",width:"130"}),l(g,{prop:"departmentName",label:"部门",width:"150"}),l(g,{label:"角色",width:"200"},{default:t(({row:a})=>[a.roleIds&&a.roleIds.length>0?(p(!0),x(q,{key:0},S(a.roleIds,R=>(p(),E(B,{key:R,size:"small",style:{"margin-right":"5px"}},{default:t(()=>[n(z(Z(R)),1)]),_:2},1024))),128)):a.userRole?(p(),E(B,{key:1,size:"small"},{default:t(()=>[n(z(Z(a.userRole)),1)]),_:2},1024)):J("",!0)]),_:1}),l(g,{label:"状态",width:"80"},{default:t(({row:a})=>[l(B,{type:a.status===1?"success":"danger"},{default:t(()=>[n(z(a.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(g,{prop:"createTime",label:"创建时间",width:"180"},{default:t(({row:a})=>[n(z(v($e)(a.createTime)),1)]),_:1}),l(g,{label:"操作",width:"260",fixed:"right"},{default:t(({row:a})=>[l(m,{link:"",type:"primary",onClick:R=>le(a)},{default:t(()=>[l(y,null,{default:t(()=>[l(v(Pe))]),_:1}),e[22]||(e[22]=n(" 编辑 ",-1))]),_:1},8,["onClick"]),l(m,{link:"",type:"info",onClick:R=>re(a)},{default:t(()=>[l(y,null,{default:t(()=>[l(v(xe))]),_:1}),e[23]||(e[23]=n(" 重置密码 ",-1))]),_:1},8,["onClick"]),l(m,{link:"",type:"danger",onClick:R=>oe(a)},{default:t(()=>[l(y,null,{default:t(()=>[l(v(ze))]),_:1}),e[24]||(e[24]=n(" 删除 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ie,I.value]]),l(ue,{"current-page":f.current,"onUpdate:currentPage":e[3]||(e[3]=a=>f.current=a),"page-size":f.size,"onUpdate:pageSize":e[4]||(e[4]=a=>f.size=a),total:f.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",class:"mt-20",onSizeChange:V,onCurrentChange:V},null,8,["current-page","page-size","total"]),l(H,{modelValue:w.value,"onUpdate:modelValue":e[14]||(e[14]=a=>w.value=a),title:D.value,width:"600px",onClose:ae},{footer:t(()=>[l(m,{onClick:e[13]||(e[13]=a=>w.value=!1)},{default:t(()=>[...e[27]||(e[27]=[n("取消",-1)])]),_:1}),l(m,{type:"primary",onClick:te,loading:b.value},{default:t(()=>[...e[28]||(e[28]=[n(" 确定 ",-1)])]),_:1},8,["loading"])]),default:t(()=>[l($,{ref_key:"userFormRef",ref:C,model:o,rules:X,"label-width":"100px"},{default:t(()=>[l(u,{label:"用户名",prop:"username"},{default:t(()=>[l(s,{modelValue:o.username,"onUpdate:modelValue":e[5]||(e[5]=a=>o.username=a),placeholder:"请输入用户名",disabled:_.value},null,8,["modelValue","disabled"])]),_:1}),l(u,{label:"姓名",prop:"realName"},{default:t(()=>[l(s,{modelValue:o.realName,"onUpdate:modelValue":e[6]||(e[6]=a=>o.realName=a),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),l(u,{label:"邮箱",prop:"email"},{default:t(()=>[l(s,{modelValue:o.email,"onUpdate:modelValue":e[7]||(e[7]=a=>o.email=a),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),l(u,{label:"手机号",prop:"phone"},{default:t(()=>[l(s,{modelValue:o.phone,"onUpdate:modelValue":e[8]||(e[8]=a=>o.phone=a),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),l(u,{label:"部门",prop:"departmentId"},{default:t(()=>[l(T,{modelValue:o.departmentId,"onUpdate:modelValue":e[9]||(e[9]=a=>o.departmentId=a),placeholder:"请选择部门",clearable:"",style:{width:"100%"}},{default:t(()=>[(p(!0),x(q,null,S(A.value,a=>(p(),E(N,{key:a.id,label:a.departmentName,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"角色",prop:"userRole"},{default:t(()=>[l(T,{modelValue:o.userRole,"onUpdate:modelValue":e[10]||(e[10]=a=>o.userRole=a),placeholder:"请选择角色",style:{width:"100%"}},{default:t(()=>[(p(!0),x(q,null,S(F.value,a=>(p(),E(N,{key:a.id,label:a.roleName,value:a.roleCode},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),_.value?J("",!0):(p(),E(u,{key:0,label:"密码",prop:"password",required:""},{default:t(()=>[l(s,{modelValue:o.password,"onUpdate:modelValue":e[11]||(e[11]=a=>o.password=a),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1})),l(u,{label:"状态",prop:"status"},{default:t(()=>[l(de,{modelValue:o.status,"onUpdate:modelValue":e[12]||(e[12]=a=>o.status=a)},{default:t(()=>[l(G,{value:1},{default:t(()=>[...e[25]||(e[25]=[n("启用",-1)])]),_:1}),l(G,{value:0},{default:t(()=>[...e[26]||(e[26]=[n("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(H,{modelValue:U.value,"onUpdate:modelValue":e[18]||(e[18]=a=>U.value=a),title:"重置密码",width:"400px"},{footer:t(()=>[l(m,{onClick:e[17]||(e[17]=a=>U.value=!1)},{default:t(()=>[...e[29]||(e[29]=[n("取消",-1)])]),_:1}),l(m,{type:"primary",onClick:se,loading:b.value},{default:t(()=>[...e[30]||(e[30]=[n(" 确定 ",-1)])]),_:1},8,["loading"])]),default:t(()=>[l($,{ref_key:"passwordFormRef",ref:L,model:c,rules:Y,"label-width":"100px"},{default:t(()=>[l(u,{label:"新密码",prop:"newPassword"},{default:t(()=>[l(s,{modelValue:c.newPassword,"onUpdate:modelValue":e[15]||(e[15]=a=>c.newPassword=a),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),l(u,{label:"确认密码",prop:"confirmPassword"},{default:t(()=>[l(s,{modelValue:c.confirmPassword,"onUpdate:modelValue":e[16]||(e[16]=a=>c.confirmPassword=a),type:"password",placeholder:"请再次输入密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},ul=me(Xe,[["__scopeId","data-v-b3967c5d"]]);export{ul as default};
