import{_ as re,a as F,r as d,A as ne,c as de,o as g,d as l,w as t,E as ie,ak as ue,j as pe,k as me,f as fe,$ as ye,a0 as ce,q as ge,m as T,a1 as be,s as r,a2 as ve,F as _e,K as ke,I as _,a8 as Ve,a4 as we,J as Ce,t as Te,a3 as Ee,a9 as xe,b as M,L as Re,aa as Ue,ab as Ne,ah as De,ac as Pe,at as ze,x as u,ad as Be}from"./index-IfYXXDZ7.js";/* empty css                   *//* empty css                *//* empty css                        *//* empty css                *//* empty css                  *//* empty css                   *//* empty css                 *//* empty css                        *//* empty css                       *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                */import{a as Ie}from"./index-DqNpZBK2.js";import{j as Oe,k as Se,l as A,m as Le,n as $e,o as qe,p as je}from"./system-DSo4Pcpa.js";const Ke={class:"app-container"},Fe={class:"card-header"},Me={__name:"index",setup(Ae){const n=F({current:1,size:10,keyword:"",roleType:"",status:null}),E=d(!1),z=d([]),B=d(0),y=d(!1),x=d(""),R=d(null),s=F({id:null,roleCode:"",roleName:"",roleType:"custom",description:"",sortOrder:0,status:1}),h={roleCode:[{required:!0,message:"请输入角色编码",trigger:"blur"},{pattern:/^[A-Z0-9_]+$/,message:"只能包含大写字母、数字和下划线",trigger:"blur"}],roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"}],roleType:[{required:!0,message:"请选择角色类型",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},U=d(!1),b=d(!1),I=d(null),N=d([]),D=d([]),O=d(null),P=d(!1),k=async()=>{E.value=!0;try{const o=await Oe(n);z.value=o.records||[],B.value=o.total||0}catch{u.error("查询角色列表失败")}finally{E.value=!1}},v=()=>{n.current=1,k()},G=()=>{n.keyword="",n.roleType="",n.status=null,v()},J=()=>{x.value="新增角色",Object.assign(s,{id:null,roleCode:"",roleName:"",roleType:"custom",description:"",sortOrder:0,status:1}),y.value=!0},Q=async o=>{x.value="编辑角色";try{const e=await A(o.id);Object.assign(s,e),y.value=!0}catch{u.error("获取角色详情失败")}},Z=async()=>{await R.value.validate(),U.value=!0;try{s.id?(await $e(s.id,s),u.success("更新角色成功")):(await qe(s),u.success("创建角色成功")),y.value=!1,k()}catch(o){u.error(o.message||"操作失败")}finally{U.value=!1}},H=o=>{if(o.roleType==="system"){u.warning("系统内置角色不允许删除");return}Be.confirm("确定要删除该角色吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Le(o.id),u.success("删除成功"),k()}catch{u.error("删除失败")}}).catch(()=>{})},S=(o,e=new Set)=>(!o||o.length===0||o.forEach(p=>{p.children&&p.children.length>0&&(e.add(p.id),S(p.children,e))}),e),W=async o=>{O.value=o.id;try{const e=await Se();N.value=e;const i=(await A(o.id)).permissionIds||[],c=S(e);D.value=i.filter(V=>!c.has(V)),b.value=!0}catch{u.error("加载权限数据失败")}},X=async()=>{P.value=!0;try{const o=I.value.getCheckedKeys();await je(O.value,o),u.success("分配权限成功"),b.value=!1}catch{u.error("分配权限失败")}finally{P.value=!1}},Y=()=>{var o;(o=R.value)==null||o.resetFields()},ee=()=>{D.value=[],N.value=[]};return ne(()=>{k()}),(o,e)=>{const p=me,i=pe,c=ce,V=ye,m=ge,L=ie,$=_e,f=we,w=Ce,le=Ve,te=xe,C=Ne,q=Ue,ae=De,j=Pe,oe=ze,se=Ee;return g(),de("div",Ke,[l($,{class:"search-card",shadow:"never"},{default:t(()=>[l(L,{inline:!0,model:n,onSubmit:e[3]||(e[3]=ue(()=>{},["prevent"]))},{default:t(()=>[l(i,{label:"关键词"},{default:t(()=>[l(p,{modelValue:n.keyword,"onUpdate:modelValue":e[0]||(e[0]=a=>n.keyword=a),placeholder:"角色编码/角色名称",clearable:"",onKeyup:fe(v,["enter"])},null,8,["modelValue"])]),_:1}),l(i,{label:"角色类型"},{default:t(()=>[l(V,{modelValue:n.roleType,"onUpdate:modelValue":e[1]||(e[1]=a=>n.roleType=a),clearable:"",placeholder:"请选择",style:{width:"140px"}},{default:t(()=>[l(c,{label:"系统内置",value:"system"}),l(c,{label:"自定义",value:"custom"})]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"状态"},{default:t(()=>[l(V,{modelValue:n.status,"onUpdate:modelValue":e[2]||(e[2]=a=>n.status=a),clearable:"",placeholder:"请选择",style:{width:"120px"}},{default:t(()=>[l(c,{label:"启用",value:1}),l(c,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1}),l(i,null,{default:t(()=>[l(m,{type:"primary",icon:T(be),onClick:v},{default:t(()=>[...e[16]||(e[16]=[r("搜索",-1)])]),_:1},8,["icon"]),l(m,{icon:T(ve),onClick:G},{default:t(()=>[...e[17]||(e[17]=[r("重置",-1)])]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1}),l($,{class:"table-card",shadow:"never"},{header:t(()=>[M("div",Fe,[e[19]||(e[19]=M("span",null,"角色列表",-1)),l(m,{type:"primary",icon:T(Re),onClick:J},{default:t(()=>[...e[18]||(e[18]=[r("新增角色",-1)])]),_:1},8,["icon"])])]),default:t(()=>[ke((g(),_(le,{data:z.value,border:"",stripe:""},{default:t(()=>[l(f,{label:"角色编码",prop:"roleCode",width:"150"}),l(f,{label:"角色名称",prop:"roleName",width:"150"}),l(f,{label:"角色类型",prop:"roleType",width:"100"},{default:t(({row:a})=>[a.roleType==="system"?(g(),_(w,{key:0,type:"warning"},{default:t(()=>[...e[20]||(e[20]=[r("系统内置",-1)])]),_:1})):(g(),_(w,{key:1,type:"info"},{default:t(()=>[...e[21]||(e[21]=[r("自定义",-1)])]),_:1}))]),_:1}),l(f,{label:"描述",prop:"description","show-overflow-tooltip":""}),l(f,{label:"排序",prop:"sortOrder",width:"80"}),l(f,{label:"状态",prop:"status",width:"80"},{default:t(({row:a})=>[a.status===1?(g(),_(w,{key:0,type:"success"},{default:t(()=>[...e[22]||(e[22]=[r("启用",-1)])]),_:1})):(g(),_(w,{key:1,type:"danger"},{default:t(()=>[...e[23]||(e[23]=[r("禁用",-1)])]),_:1}))]),_:1}),l(f,{label:"创建时间",prop:"createTime",width:"160"},{default:t(({row:a})=>[r(Te(T(Ie)(a.createTime)),1)]),_:1}),l(f,{label:"操作",fixed:"right",width:"260"},{default:t(({row:a})=>[l(m,{link:"",type:"primary",onClick:K=>W(a)},{default:t(()=>[...e[24]||(e[24]=[r("分配权限",-1)])]),_:1},8,["onClick"]),l(m,{link:"",type:"primary",onClick:K=>Q(a)},{default:t(()=>[...e[25]||(e[25]=[r("编辑",-1)])]),_:1},8,["onClick"]),l(m,{link:"",type:"danger",onClick:K=>H(a),disabled:a.roleType==="system"},{default:t(()=>[...e[26]||(e[26]=[r(" 删除 ",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[se,E.value]]),l(te,{"current-page":n.current,"onUpdate:currentPage":e[4]||(e[4]=a=>n.current=a),"page-size":n.size,"onUpdate:pageSize":e[5]||(e[5]=a=>n.size=a),total:B.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:v,onCurrentChange:v},null,8,["current-page","page-size","total"])]),_:1}),l(j,{modelValue:y.value,"onUpdate:modelValue":e[13]||(e[13]=a=>y.value=a),title:x.value,width:"600px",onClose:Y},{footer:t(()=>[l(m,{onClick:e[12]||(e[12]=a=>y.value=!1)},{default:t(()=>[...e[31]||(e[31]=[r("取消",-1)])]),_:1}),l(m,{type:"primary",loading:U.value,onClick:Z},{default:t(()=>[...e[32]||(e[32]=[r("确定",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(L,{ref_key:"formRef",ref:R,model:s,rules:h,"label-width":"100px"},{default:t(()=>[l(i,{label:"角色编码",prop:"roleCode"},{default:t(()=>[l(p,{modelValue:s.roleCode,"onUpdate:modelValue":e[6]||(e[6]=a=>s.roleCode=a),placeholder:"请输入角色编码（大写字母、数字、下划线）",disabled:s.id&&s.roleType==="system"},null,8,["modelValue","disabled"])]),_:1}),l(i,{label:"角色名称",prop:"roleName"},{default:t(()=>[l(p,{modelValue:s.roleName,"onUpdate:modelValue":e[7]||(e[7]=a=>s.roleName=a),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),l(i,{label:"角色类型",prop:"roleType"},{default:t(()=>[l(q,{modelValue:s.roleType,"onUpdate:modelValue":e[8]||(e[8]=a=>s.roleType=a),disabled:!!s.id},{default:t(()=>[l(C,{label:"system"},{default:t(()=>[...e[27]||(e[27]=[r("系统内置",-1)])]),_:1}),l(C,{label:"custom"},{default:t(()=>[...e[28]||(e[28]=[r("自定义",-1)])]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),l(i,{label:"描述"},{default:t(()=>[l(p,{modelValue:s.description,"onUpdate:modelValue":e[9]||(e[9]=a=>s.description=a),type:"textarea",rows:3,placeholder:"请输入角色描述"},null,8,["modelValue"])]),_:1}),l(i,{label:"排序"},{default:t(()=>[l(ae,{modelValue:s.sortOrder,"onUpdate:modelValue":e[10]||(e[10]=a=>s.sortOrder=a),min:0},null,8,["modelValue"])]),_:1}),l(i,{label:"状态",prop:"status"},{default:t(()=>[l(q,{modelValue:s.status,"onUpdate:modelValue":e[11]||(e[11]=a=>s.status=a)},{default:t(()=>[l(C,{label:1},{default:t(()=>[...e[29]||(e[29]=[r("启用",-1)])]),_:1}),l(C,{label:0},{default:t(()=>[...e[30]||(e[30]=[r("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(j,{modelValue:b.value,"onUpdate:modelValue":e[15]||(e[15]=a=>b.value=a),title:"分配权限",width:"600px",onClose:ee},{footer:t(()=>[l(m,{onClick:e[14]||(e[14]=a=>b.value=!1)},{default:t(()=>[...e[33]||(e[33]=[r("取消",-1)])]),_:1}),l(m,{type:"primary",loading:P.value,onClick:X},{default:t(()=>[...e[34]||(e[34]=[r("确定",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(oe,{ref_key:"permissionTreeRef",ref:I,data:N.value,props:{children:"children",label:"permissionName"},"show-checkbox":"","node-key":"id","default-checked-keys":D.value},null,8,["data","default-checked-keys"])]),_:1},8,["modelValue"])])}}},nl=re(Me,[["__scopeId","data-v-68b652c7"]]);export{nl as default};
