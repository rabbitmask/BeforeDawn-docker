import{_ as se,c as B,r as f,z as ne,d as C,x as i,f as l,e as ue,I as de,w as t,E as ie,h as me,X as pe,Y as fe,m as ce,n,i as ge,j as g,Z as _e,$ as ve,p as be,J as ye,a0 as Ve,G as V,a1 as we,a2 as O,F,D as L,H as Ee,t as N,a3 as he,l as Ue,a4 as ke,a5 as Ce,a6 as Ne,a7 as Re,a8 as xe,a9 as ze,aa as Z,v as E}from"./index-UXitE9cW.js";/* empty css                   *//* empty css                   *//* empty css                       *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                 *//* empty css                        */import{a as Ie}from"./index-BH6k6eeS.js";import{g as Te,a as De,b as Be,d as Fe,u as Le,c as $e}from"./system-CFIHzn9d.js";import{r as Se}from"./user-CKpdVc3T.js";function je(h){return/^1[3-9]\d{9}$/.test(h)}function qe(h){return/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/.test(h)}const Ae={class:"page-container"},Pe={class:"toolbar"},Oe={__name:"index",setup(h){const d=B({username:"",realName:"",status:null}),m=B({current:1,size:10,total:0}),R=f(!1),$=f([]),S=f([]),x=f([]),_=f(!1),z=f(""),v=f(!1),U=f(null),o=B({id:null,username:"",realName:"",email:"",phone:"",departmentId:null,userRole:"",password:"",status:1}),M={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:4,max:20,message:"用户名长度4-20位",trigger:"blur"}],realName:[{required:!0,message:"请输入姓名",trigger:"blur"}],email:[{validator:(r,e,s)=>{e&&!qe(e)?s(new Error("邮箱格式不正确")):s()},trigger:"blur"}],phone:[{validator:(r,e,s)=>{e&&!je(e)?s(new Error("手机号格式不正确")):s()},trigger:"blur"}],departmentId:[{required:!0,message:"请选择部门",trigger:"change"}],password:[{validator:(r,e,s)=>{!v.value&&!e?s(new Error("请输入密码")):e&&(e.length<6||e.length>20)?s(new Error("密码长度6-20位")):s()},trigger:"blur"}],userRole:[{required:!0,message:"请选择角色",trigger:"change"}]},I=f(!1),j=r=>{const e=x.value.find(s=>s.roleCode===r||s.id===r);return e?e.roleName:r},b=async()=>{R.value=!0;try{const r={current:m.current,size:m.size,...d},e=await Te(r);$.value=e.records,m.total=e.total}catch(r){console.error("加载用户列表失败:",r)}finally{R.value=!1}},G=async()=>{try{const r=await De({current:1,size:1e3});S.value=r.records||[]}catch(r){console.error("加载部门列表失败:",r)}},H=async()=>{try{x.value=await Be()}catch(r){console.error("加载角色列表失败:",r)}},q=()=>{m.current=1,b()},J=()=>{Object.assign(d,{username:"",realName:"",status:null}),q()},X=()=>{v.value=!1,z.value="新增用户",Object.assign(o,{id:null,username:"",realName:"",email:"",phone:"",departmentId:null,userRole:"",password:"",status:1}),_.value=!0},Y=r=>{v.value=!0,z.value="编辑用户",Object.assign(o,{id:r.id,username:r.username,realName:r.realName,email:r.email,phone:r.phone,departmentId:r.departmentId,userRole:r.userRole,status:r.status}),_.value=!0},K=()=>{var r;(r=U.value)==null||r.resetFields()},Q=async()=>{U.value&&await U.value.validate(async r=>{if(r){I.value=!0;try{v.value?(await Le(o.id,o),E.success("更新用户成功")):(await $e(o),E.success("创建用户成功")),_.value=!1,b()}catch(e){console.error("保存用户失败:",e)}finally{I.value=!1}}})},W=r=>{Z.confirm(`确定要将用户 "${r.username}" 的密码重置为默认密码 123456 吗？`,"重置密码",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Se(r.id),E.success("重置密码成功，默认密码：123456")}catch(e){console.error("重置密码失败:",e),E.error(e.message||"重置密码失败")}}).catch(()=>{})},ee=r=>{Z.confirm(`确定要删除用户 "${r.username}" 吗？此操作不可恢复！`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Fe(r.id),E.success("删除用户成功"),b()}catch(e){console.error("删除用户失败:",e)}}).catch(()=>{})};return ne(()=>{b(),G(),H()}),(r,e)=>{const s=me,u=ie,k=fe,T=pe,y=ge,c=ce,A=be,p=we,D=Ee,le=Ce,ae=Ne,P=xe,te=Re,re=ze,oe=Ve;return i(),C("div",Ae,[l(A,{model:d,inline:!0,class:"search-form"},{default:t(()=>[l(u,{label:"用户名"},{default:t(()=>[l(s,{modelValue:d.username,"onUpdate:modelValue":e[0]||(e[0]=a=>d.username=a),placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1}),l(u,{label:"姓名"},{default:t(()=>[l(s,{modelValue:d.realName,"onUpdate:modelValue":e[1]||(e[1]=a=>d.realName=a),placeholder:"请输入姓名",clearable:""},null,8,["modelValue"])]),_:1}),l(u,{label:"状态"},{default:t(()=>[l(T,{modelValue:d.status,"onUpdate:modelValue":e[2]||(e[2]=a=>d.status=a),placeholder:"请选择状态",clearable:""},{default:t(()=>[l(k,{label:"启用",value:1}),l(k,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1}),l(u,null,{default:t(()=>[l(c,{type:"primary",onClick:q},{default:t(()=>[l(y,null,{default:t(()=>[l(g(_e))]),_:1}),e[15]||(e[15]=n(" 查询 ",-1))]),_:1}),l(c,{onClick:J},{default:t(()=>[l(y,null,{default:t(()=>[l(g(ve))]),_:1}),e[16]||(e[16]=n(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"]),ue("div",Pe,[l(c,{type:"primary",onClick:X},{default:t(()=>[l(y,null,{default:t(()=>[l(g(ye))]),_:1}),e[17]||(e[17]=n(" 新增用户 ",-1))]),_:1})]),de((i(),V(le,{data:$.value,border:"",stripe:"",style:{width:"100%"}},{default:t(()=>[l(p,{prop:"username",label:"用户名",width:"150"}),l(p,{prop:"realName",label:"姓名",width:"120"}),l(p,{prop:"email",label:"邮箱",width:"200"}),l(p,{prop:"phone",label:"手机号",width:"130"}),l(p,{prop:"departmentName",label:"部门",width:"150"}),l(p,{label:"角色",width:"200"},{default:t(({row:a})=>[a.roleIds&&a.roleIds.length>0?(i(!0),C(F,{key:0},L(a.roleIds,w=>(i(),V(D,{key:w,size:"small",style:{"margin-right":"5px"}},{default:t(()=>[n(N(j(w)),1)]),_:2},1024))),128)):a.userRole?(i(),V(D,{key:1,size:"small"},{default:t(()=>[n(N(j(a.userRole)),1)]),_:2},1024)):O("",!0)]),_:1}),l(p,{label:"状态",width:"80"},{default:t(({row:a})=>[l(D,{type:a.status===1?"success":"danger"},{default:t(()=>[n(N(a.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(p,{prop:"createTime",label:"创建时间",width:"180"},{default:t(({row:a})=>[n(N(g(Ie)(a.createTime)),1)]),_:1}),l(p,{label:"操作",width:"260",fixed:"right"},{default:t(({row:a})=>[l(c,{link:"",type:"primary",onClick:w=>Y(a)},{default:t(()=>[l(y,null,{default:t(()=>[l(g(he))]),_:1}),e[18]||(e[18]=n(" 编辑 ",-1))]),_:1},8,["onClick"]),l(c,{link:"",type:"info",onClick:w=>W(a)},{default:t(()=>[l(y,null,{default:t(()=>[l(g(Ue))]),_:1}),e[19]||(e[19]=n(" 重置密码 ",-1))]),_:1},8,["onClick"]),l(c,{link:"",type:"danger",onClick:w=>ee(a)},{default:t(()=>[l(y,null,{default:t(()=>[l(g(ke))]),_:1}),e[20]||(e[20]=n(" 删除 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[oe,R.value]]),l(ae,{"current-page":m.current,"onUpdate:currentPage":e[3]||(e[3]=a=>m.current=a),"page-size":m.size,"onUpdate:pageSize":e[4]||(e[4]=a=>m.size=a),total:m.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",class:"mt-20",onSizeChange:b,onCurrentChange:b},null,8,["current-page","page-size","total"]),l(re,{modelValue:_.value,"onUpdate:modelValue":e[14]||(e[14]=a=>_.value=a),title:z.value,width:"600px",onClose:K},{footer:t(()=>[l(c,{onClick:e[13]||(e[13]=a=>_.value=!1)},{default:t(()=>[...e[23]||(e[23]=[n("取消",-1)])]),_:1}),l(c,{type:"primary",onClick:Q,loading:I.value},{default:t(()=>[...e[24]||(e[24]=[n(" 确定 ",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(A,{ref_key:"userFormRef",ref:U,model:o,rules:M,"label-width":"100px"},{default:t(()=>[l(u,{label:"用户名",prop:"username"},{default:t(()=>[l(s,{modelValue:o.username,"onUpdate:modelValue":e[5]||(e[5]=a=>o.username=a),placeholder:"请输入用户名",disabled:v.value},null,8,["modelValue","disabled"])]),_:1}),l(u,{label:"姓名",prop:"realName"},{default:t(()=>[l(s,{modelValue:o.realName,"onUpdate:modelValue":e[6]||(e[6]=a=>o.realName=a),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),l(u,{label:"邮箱",prop:"email"},{default:t(()=>[l(s,{modelValue:o.email,"onUpdate:modelValue":e[7]||(e[7]=a=>o.email=a),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),l(u,{label:"手机号",prop:"phone"},{default:t(()=>[l(s,{modelValue:o.phone,"onUpdate:modelValue":e[8]||(e[8]=a=>o.phone=a),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),l(u,{label:"部门",prop:"departmentId"},{default:t(()=>[l(T,{modelValue:o.departmentId,"onUpdate:modelValue":e[9]||(e[9]=a=>o.departmentId=a),placeholder:"请选择部门",clearable:"",style:{width:"100%"}},{default:t(()=>[(i(!0),C(F,null,L(S.value,a=>(i(),V(k,{key:a.id,label:a.departmentName,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"角色",prop:"userRole"},{default:t(()=>[l(T,{modelValue:o.userRole,"onUpdate:modelValue":e[10]||(e[10]=a=>o.userRole=a),placeholder:"请选择角色",style:{width:"100%"}},{default:t(()=>[(i(!0),C(F,null,L(x.value,a=>(i(),V(k,{key:a.id,label:a.roleName,value:a.roleCode},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),v.value?O("",!0):(i(),V(u,{key:0,label:"密码",prop:"password",required:""},{default:t(()=>[l(s,{modelValue:o.password,"onUpdate:modelValue":e[11]||(e[11]=a=>o.password=a),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1})),l(u,{label:"状态",prop:"status"},{default:t(()=>[l(te,{modelValue:o.status,"onUpdate:modelValue":e[12]||(e[12]=a=>o.status=a)},{default:t(()=>[l(P,{value:1},{default:t(()=>[...e[21]||(e[21]=[n("启用",-1)])]),_:1}),l(P,{value:0},{default:t(()=>[...e[22]||(e[22]=[n("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},al=se(Oe,[["__scopeId","data-v-0a58f301"]]);export{al as default};
