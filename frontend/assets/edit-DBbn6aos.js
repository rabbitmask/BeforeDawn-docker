import{_ as $,i as j,h as z,y as G,r as i,z as E,a as J,A as K,c,o as n,d as l,w as a,b as P,t as Q,aN as W,K as X,I as p,E as Y,j as Z,k as ee,$ as te,G as T,H as x,a0 as le,az as ae,s as m,q as oe,l as re,m as C,aH as se,aT as ne,a3 as ue,F as de,aM as ie,x as D}from"./index-DT2C5K_G.js";/* empty css                   *//* empty css                *//* empty css                 *//* empty css                   *//* empty css               *//* empty css                  *//* empty css                       */import{M as ce}from"./MarkdownEditor-DCPiU3Ta.js";import{b as pe,u as me,c as ye}from"./knowledge-BnEsFMCO.js";import"./style-CNpDB7o_.js";import"./file-BMGFJXiP.js";const ge={class:"page-container"},_e={class:"page-title"},fe={__name:"edit",setup(ve){const y=j(),S=z(),g=G(),_=i(!1),d=i(!1),f=i(null),v=E(()=>!!y.params.id),h=i([]),L=E(()=>g.getDictData("vuln_type")),A=E(()=>g.getDictData("asset_type")),o=J({title:"",summary:"",content:"",category:null,vulnType:"",assetType:"",techStack:""}),I={title:[{required:!0,message:"请输入文章标题",trigger:"blur"},{min:5,max:100,message:"标题长度5-100字符",trigger:"blur"}],content:[{required:!0,message:"请输入文章内容",trigger:"blur"},{min:10,message:"内容至少10字符",trigger:"blur"}],category:[{required:!0,message:"请选择文章分类",trigger:"change"}]},O=async()=>{try{const r=await ie("knowledge_category");h.value=r||[]}catch(r){console.error("加载分类列表失败:",r)}},q=async()=>{if(v.value){_.value=!0;try{const r=await pe(y.params.id);Object.assign(o,{title:r.title,summary:r.summary,content:r.content,category:r.category,vulnType:r.vulnType,assetType:r.assetType,techStack:r.techStack})}catch(r){console.error("加载文章详情失败:",r),D.error("加载文章详情失败")}finally{_.value=!1}}},B=async r=>{f.value&&await f.value.validate(async e=>{if(e){d.value=!0;try{const u={...o,status:r};v.value?(await me(y.params.id,u),D.success("更新文章成功")):(await ye(u),D.success("创建文章成功")),S.push("/knowledge/article")}catch(u){console.error("保存文章失败:",u)}finally{d.value=!1}}})},M=()=>{S.back()};return K(async()=>{await g.loadDicts(["knowledge_category","vuln_type","asset_type"]),O(),q()}),(r,e)=>{const u=W,b=ee,s=Z,V=le,k=te,F=ae,U=re,w=oe,N=Y,R=de,H=ue;return n(),c("div",ge,[l(u,{onBack:M,class:"mb-20"},{content:a(()=>[P("span",_e,Q(v.value?"编辑文章":"创建文章"),1)]),_:1}),l(R,{shadow:"never"},{default:a(()=>[X((n(),p(N,{ref_key:"formRef",ref:f,model:o,rules:I,"label-width":"100px"},{default:a(()=>[l(s,{label:"文章标题",prop:"title"},{default:a(()=>[l(b,{modelValue:o.title,"onUpdate:modelValue":e[0]||(e[0]=t=>o.title=t),placeholder:"请输入文章标题",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(s,{label:"文章摘要",prop:"summary"},{default:a(()=>[l(b,{modelValue:o.summary,"onUpdate:modelValue":e[1]||(e[1]=t=>o.summary=t),type:"textarea",rows:3,placeholder:"请输入文章摘要（选填）",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(s,{label:"文章分类",prop:"category"},{default:a(()=>[l(k,{modelValue:o.category,"onUpdate:modelValue":e[2]||(e[2]=t=>o.category=t),placeholder:"请选择分类",filterable:"",style:{width:"100%"}},{default:a(()=>[(n(!0),c(T,null,x(h.value,t=>(n(),p(V,{key:t.dictValue,label:t.dictLabel,value:t.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(s,{label:"文章内容",prop:"content"},{default:a(()=>[l(ce,{modelValue:o.content,"onUpdate:modelValue":e[3]||(e[3]=t=>o.content=t),placeholder:"请输入文章内容（支持Markdown语法）",height:"600px"},null,8,["modelValue"])]),_:1}),l(F,{"content-position":"left"},{default:a(()=>[...e[9]||(e[9]=[m("关联信息（选填）",-1)])]),_:1}),l(s,{label:"漏洞类型"},{default:a(()=>[l(k,{modelValue:o.vulnType,"onUpdate:modelValue":e[4]||(e[4]=t=>o.vulnType=t),placeholder:"请选择",clearable:"",style:{width:"100%"}},{default:a(()=>[(n(!0),c(T,null,x(L.value,t=>(n(),p(V,{key:t.dictValue,label:t.dictLabel,value:t.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(s,{label:"资产类型"},{default:a(()=>[l(k,{modelValue:o.assetType,"onUpdate:modelValue":e[5]||(e[5]=t=>o.assetType=t),placeholder:"请选择",clearable:"",style:{width:"100%"}},{default:a(()=>[(n(!0),c(T,null,x(A.value,t=>(n(),p(V,{key:t.dictValue,label:t.dictLabel,value:t.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(s,{label:"技术栈"},{default:a(()=>[l(b,{modelValue:o.techStack,"onUpdate:modelValue":e[6]||(e[6]=t=>o.techStack=t),placeholder:"如：Java, Spring Boot, MySQL",clearable:""},null,8,["modelValue"])]),_:1}),l(s,null,{default:a(()=>[l(w,{type:"primary",loading:d.value,onClick:e[7]||(e[7]=t=>B("published"))},{default:a(()=>[l(U,null,{default:a(()=>[l(C(se))]),_:1}),e[10]||(e[10]=m(" 发布文章 ",-1))]),_:1},8,["loading"]),l(w,{loading:d.value,onClick:e[8]||(e[8]=t=>B("draft"))},{default:a(()=>[l(U,null,{default:a(()=>[l(C(ne))]),_:1}),e[11]||(e[11]=m(" 保存草稿 ",-1))]),_:1},8,["loading"]),l(w,{onClick:M},{default:a(()=>[...e[12]||(e[12]=[m("取消",-1)])]),_:1})]),_:1})]),_:1},8,["model"])),[[H,_.value]])]),_:1})])}}},Ue=$(fe,[["__scopeId","data-v-0aa7b2c8"]]);export{Ue as default};
