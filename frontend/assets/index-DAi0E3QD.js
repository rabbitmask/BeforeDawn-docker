import{_ as Le,f as Se,u as Te,q as Re,r as i,a as D,s as q,t as De,c as g,o as s,e as t,w as a,h as Fe,j as Ee,k as Ue,X as he,F as w,B as C,C as b,Y as ze,m as qe,n as p,H as Be,A as B,Z as Xe,$ as Ie,E as $e,b as X,a2 as Pe,I as Oe,aN as Ne,z as K,a7 as je,aa as Me,D as Ae,a8 as Ge,a9 as He,p as L,ab as W}from"./index-DG9m7imz.js";/* empty css                       *//* empty css               *//* empty css                  *//* empty css                   *//* empty css                      *//* empty css                  *//* empty css                 *//* empty css                *//* empty css                */import{V as Qe}from"./VulnListTable-DI8TTLbU.js";import{g as Ye,t as Ze,d as Je,s as Ke,f as We,r as el}from"./vulnerability-BPpAdgVn.js";/* empty css                   *//* empty css                        */import"./format-BQFyjrq8.js";const ll={class:"page-container"},tl={class:"toolbar"},al={class:"toolbar-right"},ol={class:"pagination-wrapper"},ul={__name:"index",setup(sl){const I=Se(),ee=Te(),y=Re(),$=i(!1),P=i(!1),O=i(!1),N=i(!1),d=D({keyword:"",vulnSource:"",vulnType:"",riskLevel:"",vulnStatus:""}),V=D({current:1,size:10}),H=i([]),j=i(0),le=i([]),Q=q(()=>y.getDictData("vuln_source")),te=q(()=>y.getDictData("vuln_type")),Y=q(()=>y.getDictData("risk_level")),ae=q(()=>y.getDictData("vuln_status")),F=i(!1),E=i(null),r=D({title:"",description:"",vulnType:"",riskLevel:"",sourceType:"",assetId:null}),oe={title:[{required:!0,message:"请输入漏洞标题",trigger:"blur"}],description:[{required:!0,message:"请输入漏洞描述",trigger:"blur"}],vulnType:[{required:!0,message:"请选择漏洞类型",trigger:"change"}],riskLevel:[{required:!0,message:"请选择风险等级",trigger:"change"}],sourceType:[{required:!0,message:"请选择漏洞来源",trigger:"change"}],assetId:[{required:!0,message:"请选择关联资产",trigger:"change"}]},S=i(!1),T=i(null),U=D({fixComment:""}),_=i(null),ue={fixComment:[{required:!0,message:"请输入修复说明",trigger:"blur"},{min:3,message:"修复说明至少3个字符",trigger:"blur"}]},R=i(!1),h=i(null),k=D({retestResult:"passed",retestComment:""}),se={retestResult:[{required:!0,message:"请选择复测结果",trigger:"change"}],retestComment:[{required:!0,message:"请填写复测意见",trigger:"blur"},{min:3,message:"复测意见至少3个字符",trigger:"blur"}]},re=o=>y.getDictLabel("risk_level",o),ne=o=>{const e=y.getDictData("risk_level").find(m=>m.dictValue===o);return(e==null?void 0:e.cssClass)||""},v=async()=>{$.value=!0;try{const o={current:V.current,size:V.size,...d},e=await Ye(o);H.value=e.records||[],j.value=e.total||0}catch(o){console.error("加载漏洞列表失败:",o),L.error("加载漏洞列表失败")}finally{$.value=!1}},x=()=>{V.current=1,v()},ie=()=>{Object.assign(d,{keyword:"",vulnSource:"",vulnType:"",riskLevel:"",vulnStatus:""}),x()},de=o=>{I.push(`/vulnerability/submit?id=${o.id}`)},pe=o=>{I.push(`/vulnerability/detail/${o.id}`)},me=()=>{I.push("/vulnerability/submit")},ve=async()=>{E.value&&await E.value.validate(async o=>{if(o){P.value=!0;try{await Ke(r),L.success("提交漏洞成功"),F.value=!1,E.value.resetFields(),v()}catch(e){console.error("提交漏洞失败:",e)}finally{P.value=!1}}})},ce=o=>{_.value=o,S.value=!0},fe=async()=>{T.value&&await T.value.validate(async o=>{if(o){O.value=!0;try{await We(_.value.id,U),L.success("提交修复成功，等待复测"),S.value=!1,T.value.resetFields(),v()}catch(e){console.error("修复漏洞失败:",e)}finally{O.value=!1}}})},ge=()=>{var o;(o=T.value)==null||o.resetFields()},be=o=>{_.value=o,R.value=!0},ye=async()=>{h.value&&await h.value.validate(async o=>{if(o){N.value=!0;try{await el(_.value.id,k);const e=k.retestResult==="passed"?"复测通过":"复测不通过，已打回";L.success(e),R.value=!1,h.value.resetFields(),v()}catch(e){console.error("复测漏洞失败:",e)}finally{N.value=!1}}})},Ve=o=>{W.confirm("确定要删除这个漏洞吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Je(o.id),L.success("删除成功"),v()}catch(e){console.error("删除漏洞失败:",e)}}).catch(()=>{})},_e=o=>{const e=o.isPublic===1?"取消公开":"公开";W.confirm(`确定要${e}这个漏洞吗？${o.isPublic===1?"取消后将不在漏洞案例中显示。":"公开后将在知识库-漏洞案例中展示供大家学习。"}`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Ze(o.id),L.success(`${e}成功`),v()}catch(m){console.error("切换公开状态失败:",m)}}).catch(()=>{})};return De(async()=>{await y.loadDicts(["vuln_source","vuln_type","risk_level","vuln_status"]),v()}),(o,e)=>{const m=Ue,u=Ee,n=ze,f=he,M=Be,c=qe,z=Fe,A=$e,ke=Ne,xe=je,G=Me,we=Ae,Z=He,Ce=Ge;return s(),g("div",ll,[t(A,{shadow:"never",class:"search-card"},{default:a(()=>[t(z,{model:d,inline:""},{default:a(()=>[t(u,{label:"关键词"},{default:a(()=>[t(m,{modelValue:d.keyword,"onUpdate:modelValue":e[0]||(e[0]=l=>d.keyword=l),placeholder:"漏洞标题",clearable:"",style:{width:"200px"},onClear:x},null,8,["modelValue"])]),_:1}),t(u,{label:"漏洞来源"},{default:a(()=>[t(f,{modelValue:d.vulnSource,"onUpdate:modelValue":e[1]||(e[1]=l=>d.vulnSource=l),placeholder:"请选择",clearable:"",style:{width:"150px"},onChange:x},{default:a(()=>[(s(!0),g(w,null,C(Q.value,l=>(s(),b(n,{key:l.dictValue,label:l.dictLabel,value:l.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"漏洞类型"},{default:a(()=>[t(f,{modelValue:d.vulnType,"onUpdate:modelValue":e[2]||(e[2]=l=>d.vulnType=l),placeholder:"请选择",clearable:"",style:{width:"150px"},onChange:x},{default:a(()=>[(s(!0),g(w,null,C(te.value,l=>(s(),b(n,{key:l.dictValue,label:l.dictLabel,value:l.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"风险等级"},{default:a(()=>[t(f,{modelValue:d.riskLevel,"onUpdate:modelValue":e[3]||(e[3]=l=>d.riskLevel=l),placeholder:"请选择",clearable:"",style:{width:"120px"},onChange:x},{default:a(()=>[(s(!0),g(w,null,C(Y.value,l=>(s(),b(n,{key:l.dictValue,label:l.dictLabel,value:l.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"状态"},{default:a(()=>[t(f,{modelValue:d.vulnStatus,"onUpdate:modelValue":e[4]||(e[4]=l=>d.vulnStatus=l),placeholder:"请选择",clearable:"",style:{width:"120px"},onChange:x},{default:a(()=>[(s(!0),g(w,null,C(ae.value,l=>(s(),b(n,{key:l.dictValue,label:l.dictLabel,value:l.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(u,null,{default:a(()=>[t(c,{type:"primary",onClick:x},{default:a(()=>[t(M,null,{default:a(()=>[t(B(Xe))]),_:1}),e[22]||(e[22]=p(" 搜索 ",-1))]),_:1}),t(c,{onClick:ie},{default:a(()=>[t(M,null,{default:a(()=>[t(B(Ie))]),_:1}),e[23]||(e[23]=p(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(A,{shadow:"never",class:"toolbar-card"},{default:a(()=>[X("div",tl,[X("div",null,[B(ee).hasPermission("vuln:submit:add")?(s(),b(c,{key:0,type:"primary",onClick:me},{default:a(()=>[t(M,null,{default:a(()=>[t(B(Oe))]),_:1}),e[24]||(e[24]=p(" 提交漏洞 ",-1))]),_:1})):Pe("",!0)]),X("div",al,[t(ke,{type:"info"},{default:a(()=>[p(" 共 "+K(j.value)+" 条记录 ",1)]),_:1})])])]),_:1}),t(A,{shadow:"never",class:"table-card"},{default:a(()=>[t(Qe,{data:H.value,loading:$.value,onView:pe,onEdit:de,onFix:ce,onRetest:be,onDelete:Ve,onTogglePublic:_e},null,8,["data","loading"]),X("div",ol,[t(xe,{"current-page":V.current,"onUpdate:currentPage":e[5]||(e[5]=l=>V.current=l),"page-size":V.size,"onUpdate:pageSize":e[6]||(e[6]=l=>V.size=l),total:j.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:v,onCurrentChange:v},null,8,["current-page","page-size","total"])])]),_:1}),t(G,{modelValue:F.value,"onUpdate:modelValue":e[14]||(e[14]=l=>F.value=l),title:"提交漏洞",width:"800px","close-on-click-modal":!1},{footer:a(()=>[t(c,{onClick:e[13]||(e[13]=l=>F.value=!1)},{default:a(()=>[...e[25]||(e[25]=[p("取消",-1)])]),_:1}),t(c,{type:"primary",loading:P.value,onClick:ve},{default:a(()=>[...e[26]||(e[26]=[p(" 确定 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[t(z,{ref_key:"submitFormRef",ref:E,model:r,rules:oe,"label-width":"100px"},{default:a(()=>[t(u,{label:"漏洞标题",prop:"title"},{default:a(()=>[t(m,{modelValue:r.title,"onUpdate:modelValue":e[7]||(e[7]=l=>r.title=l),placeholder:"请输入漏洞标题"},null,8,["modelValue"])]),_:1}),t(u,{label:"漏洞描述",prop:"description"},{default:a(()=>[t(m,{modelValue:r.description,"onUpdate:modelValue":e[8]||(e[8]=l=>r.description=l),type:"textarea",rows:4,placeholder:"请详细描述漏洞情况"},null,8,["modelValue"])]),_:1}),t(u,{label:"漏洞类型",prop:"vulnType"},{default:a(()=>[t(f,{modelValue:r.vulnType,"onUpdate:modelValue":e[9]||(e[9]=l=>r.vulnType=l),placeholder:"请选择",style:{width:"100%"}},{default:a(()=>[t(n,{label:"SQL注入",value:"sql_injection"}),t(n,{label:"XSS",value:"xss"}),t(n,{label:"CSRF",value:"csrf"}),t(n,{label:"文件上传",value:"file_upload"}),t(n,{label:"权限绕过",value:"auth_bypass"}),t(n,{label:"信息泄露",value:"info_leak"}),t(n,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"风险等级",prop:"riskLevel"},{default:a(()=>[t(f,{modelValue:r.riskLevel,"onUpdate:modelValue":e[10]||(e[10]=l=>r.riskLevel=l),placeholder:"请选择",style:{width:"100%"}},{default:a(()=>[(s(!0),g(w,null,C(Y.value,l=>(s(),b(n,{key:l.dictValue,label:l.dictLabel,value:l.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"漏洞来源",prop:"sourceType"},{default:a(()=>[t(f,{modelValue:r.sourceType,"onUpdate:modelValue":e[11]||(e[11]=l=>r.sourceType=l),placeholder:"请选择",style:{width:"100%"}},{default:a(()=>[(s(!0),g(w,null,C(Q.value,l=>(s(),b(n,{key:l.dictValue,label:l.dictLabel,value:l.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"关联资产",prop:"assetId"},{default:a(()=>[t(f,{modelValue:r.assetId,"onUpdate:modelValue":e[12]||(e[12]=l=>r.assetId=l),placeholder:"请选择资产",filterable:"",style:{width:"100%"}},{default:a(()=>[(s(!0),g(w,null,C(le.value,l=>(s(),b(n,{key:l.id,label:l.assetName,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(G,{modelValue:S.value,"onUpdate:modelValue":e[17]||(e[17]=l=>S.value=l),title:"提交修复",width:"700px",onClose:ge},{footer:a(()=>[t(c,{onClick:e[16]||(e[16]=l=>S.value=!1)},{default:a(()=>[...e[27]||(e[27]=[p("取消",-1)])]),_:1}),t(c,{type:"primary",loading:O.value,onClick:fe},{default:a(()=>[...e[28]||(e[28]=[p(" 确定提交 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[t(z,{ref_key:"fixFormRef",ref:T,model:U,rules:ue,"label-width":"100px"},{default:a(()=>[t(u,{label:"漏洞标题"},{default:a(()=>{var l;return[t(m,{value:(l=_.value)==null?void 0:l.title,disabled:""},null,8,["value"])]}),_:1}),t(u,{label:"风险等级"},{default:a(()=>{var l;return[t(we,{type:ne((l=_.value)==null?void 0:l.riskLevel),size:"small"},{default:a(()=>{var J;return[p(K(re((J=_.value)==null?void 0:J.riskLevel)),1)]}),_:1},8,["type"])]}),_:1}),t(u,{label:"修复说明",prop:"fixComment"},{default:a(()=>[t(m,{modelValue:U.fixComment,"onUpdate:modelValue":e[15]||(e[15]=l=>U.fixComment=l),type:"textarea",rows:6,placeholder:`请详细描述修复方案和修复内容，例如：
1. 修复方案：XXX
2. 修复内容：XXX
3. 验证方法：XXX`},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(G,{modelValue:R.value,"onUpdate:modelValue":e[21]||(e[21]=l=>R.value=l),title:"复测漏洞",width:"600px","close-on-click-modal":!1},{footer:a(()=>[t(c,{onClick:e[20]||(e[20]=l=>R.value=!1)},{default:a(()=>[...e[31]||(e[31]=[p("取消",-1)])]),_:1}),t(c,{type:"primary",loading:N.value,onClick:ye},{default:a(()=>[...e[32]||(e[32]=[p(" 提交复测 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[t(z,{ref_key:"retestFormRef",ref:h,model:k,rules:se,"label-width":"100px"},{default:a(()=>[t(u,{label:"复测结果",prop:"retestResult"},{default:a(()=>[t(Ce,{modelValue:k.retestResult,"onUpdate:modelValue":e[18]||(e[18]=l=>k.retestResult=l)},{default:a(()=>[t(Z,{value:"passed"},{default:a(()=>[...e[29]||(e[29]=[p("通过",-1)])]),_:1}),t(Z,{value:"rejected"},{default:a(()=>[...e[30]||(e[30]=[p("不通过",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"复测意见",prop:"retestComment"},{default:a(()=>[t(m,{modelValue:k.retestComment,"onUpdate:modelValue":e[19]||(e[19]=l=>k.retestComment=l),type:"textarea",rows:5,placeholder:"请填写复测意见"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},xl=Le(ul,[["__scopeId","data-v-e135f172"]]);export{xl as default};
