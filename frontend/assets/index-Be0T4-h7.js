import{_ as tt,f as et,u as st,q as ot,r as D,s as V,a as A,t as lt,v as at,x as nt,c as v,o as u,e as s,w as o,y as it,E as rt,b as t,z as r,A as d,F as L,B as P,C as p,D as ct,n as h,G as dt,m as ut,H as _t,I as mt,J as ft,K as vt,L as M,M as $,N as K,O as pt,P as ht,Q as gt,R as Ct,S as bt,T as kt,U as yt,p as wt,V as C,W as b}from"./index-DG9m7imz.js";/* empty css                         *//* empty css                    *//* empty css               *//* empty css                *//* empty css               */import{g as xt}from"./statistics-Bv-euc0B.js";import{f as St}from"./index-Czr33Ccv.js";import{i as Et}from"./index-Bb6yjXMn.js";const Nt={class:"dashboard-container"},zt={class:"welcome-content"},Dt={class:"welcome-left"},Lt={class:"user-tags"},Pt={class:"welcome-right"},Rt={class:"stat-icon stat-icon--asset"},It={class:"stat-content"},Tt={class:"stat-value"},Bt={class:"stat-icon stat-icon--vuln"},Ot={class:"stat-content"},Vt={class:"stat-value"},At={class:"stat-icon stat-icon--fixed"},Mt={class:"stat-content"},$t={class:"stat-value"},Kt={class:"stat-icon stat-icon--article"},Ut={class:"stat-content"},Wt={class:"stat-value"},qt={class:"card-header"},Ft={class:"risk-chart-container"},Ht={class:"card-header"},Jt={class:"fix-progress"},Gt={class:"progress-circle"},Qt={class:"percentage-value"},jt={class:"progress-stats"},Xt={class:"progress-item total"},Yt={class:"item-icon"},Zt={class:"item-content"},te={class:"value"},ee={class:"progress-item success"},se={class:"item-icon"},oe={class:"item-content"},le={class:"value"},ae={class:"progress-item danger"},ne={class:"item-icon"},ie={class:"item-content"},re={class:"value"},ce={class:"card-header"},de={class:"todo-list"},ue={key:1,class:"todo-items"},_e=["onClick"],me={class:"todo-left"},fe={class:"todo-title"},ve={class:"todo-right"},pe={class:"todo-time"},he={class:"activity-list"},ge=["onClick"],Ce={class:"activity-action"},be={class:"activity-target"},ke={__name:"index",setup(ye){const g=et(),k=st(),R=ot(),U=e=>R.getDictLabel("risk_level",e),y=D(null);let c=null;const W=V(()=>{const e=new Date().getHours();return e<6?"å‡Œæ™¨å¥½":e<9?"æ—©ä¸Šå¥½":e<12?"ä¸Šåˆå¥½":e<14?"ä¸­åˆå¥½":e<18?"ä¸‹åˆå¥½":e<22?"æ™šä¸Šå¥½":"å¤œæ·±äº†"}),a=A({assetCount:0,vulnCount:0,fixedCount:0,articleCount:0}),i=A({critical:0,high:0,medium:0,low:0,info:0,criticalPercent:0,highPercent:0,mediumPercent:0,lowPercent:0,infoPercent:0}),q=()=>{if(console.log("ğŸ”¥ [å›¾è¡¨] å¼€å§‹åˆå§‹åŒ–é¥¼çŠ¶å›¾"),console.log("ğŸ”¥ [å›¾è¡¨] riskChartRef.value:",y.value),!y.value){console.error("âŒ [å›¾è¡¨] riskChartRef.valueä¸ºç©ºï¼Œæ— æ³•åˆå§‹åŒ–");return}c&&(c.dispose(),c=null),c=Et(y.value),console.log("âœ… [å›¾è¡¨] EChartså®ä¾‹åˆ›å»ºæˆåŠŸ:",c);const e={tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},legend:{orient:"vertical",right:"10%",top:"center"},series:[{name:"æ¼æ´é£é™©",type:"pie",radius:["40%","70%"],center:["40%","50%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!0,formatter:"{b}: {c}"},emphasis:{label:{show:!0,fontSize:16,fontWeight:"bold"}},data:[]}]};c.setOption(e),console.log("âœ… [å›¾è¡¨] åˆå§‹é…ç½®å·²è®¾ç½®"),window.addEventListener("resize",()=>{c==null||c.resize()})},F=()=>{if(console.log("ğŸ”¥ [å›¾è¡¨] å¼€å§‹æ›´æ–°æ•°æ®"),console.log("ğŸ”¥ [å›¾è¡¨] riskChartInstance:",c),console.log("ğŸ”¥ [å›¾è¡¨] riskStats:",JSON.stringify(i)),!c){console.error("âŒ [å›¾è¡¨] riskChartInstanceä¸ºç©ºï¼Œæ— æ³•æ›´æ–°");return}const e=[{name:b.critical,value:i.critical,itemStyle:{color:C.critical}},{name:b.high,value:i.high,itemStyle:{color:C.high}},{name:b.medium,value:i.medium,itemStyle:{color:C.medium}},{name:b.low,value:i.low,itemStyle:{color:C.low}},{name:b.info,value:i.info,itemStyle:{color:C.info}}].filter(l=>l.value>0);console.log("ğŸ”¥ [å›¾è¡¨] chartData:",e),c.setOption({series:[{data:e}]}),console.log("âœ… [å›¾è¡¨] æ•°æ®æ›´æ–°å®Œæˆ")},I=V(()=>a.vulnCount===0?0:Math.round(a.fixedCount/a.vulnCount*100)),w=D([]),z=D([]);async function H(){try{console.log("å¼€å§‹åŠ è½½Dashboardæ•°æ®...");const e=await xt();console.log("Dashboard APIè¿”å›:",e),e?(console.log("åŸå§‹æ•°æ®:",{assetCount:e.assetCount,vulnCount:e.vulnCount,fixedCount:e.fixedCount,articleCount:e.articleCount}),a.assetCount=Number(e.assetCount)||0,a.vulnCount=Number(e.vulnCount)||0,a.fixedCount=Number(e.fixedCount)||0,a.articleCount=Number(e.articleCount)||0,console.log("è½¬æ¢åçš„stats:",{assetCount:a.assetCount,vulnCount:a.vulnCount,fixedCount:a.fixedCount,articleCount:a.articleCount}),e.riskStats&&(i.critical=Number(e.riskStats.critical)||0,i.high=Number(e.riskStats.high)||0,i.medium=Number(e.riskStats.medium)||0,i.low=Number(e.riskStats.low)||0,i.info=Number(e.riskStats.info)||0,i.criticalPercent=Number(e.riskStats.criticalPercent)||0,i.highPercent=Number(e.riskStats.highPercent)||0,i.mediumPercent=Number(e.riskStats.mediumPercent)||0,i.lowPercent=Number(e.riskStats.lowPercent)||0,i.infoPercent=Number(e.riskStats.infoPercent)||0,F(),console.log("é£é™©ç»Ÿè®¡:",i)),await R.loadDict("risk_level"),w.value=e.todoList||[],z.value=e.activityList||[],console.log("Dashboardæ•°æ®åŠ è½½æˆåŠŸ")):console.warn("Dashboardè¿”å›æ•°æ®æ ¼å¼ä¸æ­£ç¡®:",e)}catch(e){console.error("åŠ è½½Dashboardæ•°æ®å¤±è´¥:",e),wt.error("åŠ è½½æ•°æ®å¤±è´¥")}}const T=e=>{g.push(e)},J=()=>{g.push("/vulnerability/mytodo")},G=e=>{e.type==="vuln_case"?g.push("/knowledge/case"):e.type==="article"?g.push("/knowledge/article"):g.push("/knowledge")};return lt(()=>{var e;console.log("é¦–é¡µåŠ è½½å®Œæˆï¼Œç”¨æˆ·:",(e=k.userInfo)==null?void 0:e.username),setTimeout(()=>{console.log("â° [æ—¶åº] å¼€å§‹åˆå§‹åŒ–å›¾è¡¨"),q(),console.log("â° [æ—¶åº] å›¾è¡¨åˆå§‹åŒ–å®Œæˆï¼Œå¼€å§‹åŠ è½½æ•°æ®"),H()},100)}),at(()=>{c&&(c.dispose(),c=null)}),(e,l)=>{const x=ct,_=_t,B=ut,m=rt,f=it,S=vt,Q=ht,j=bt,O=gt,X=yt,Y=kt,Z=nt("permission");return u(),v("div",Nt,[s(S,{gutter:20},{default:o(()=>[s(f,{span:24},{default:o(()=>[s(m,{class:"welcome-card"},{default:o(()=>{var n,E;return[t("div",zt,[t("div",Dt,[t("h2",null,r(W.value)+"ï¼Œ"+r(((n=d(k).userInfo)==null?void 0:n.realName)||((E=d(k).userInfo)==null?void 0:E.username)||"æœ‹å‹")+"ï¼",1),t("div",Lt,[(u(!0),v(L,null,P(d(k).roles,N=>(u(),p(x,{key:N,type:"primary",effect:"dark"},{default:o(()=>[h(r(N),1)]),_:2},1024))),128))]),l[2]||(l[2]=t("p",{class:"welcome-desc"},"ä»Šå¤©ä¹Ÿè¦åŠªåŠ›æå®‰å…¨å•Šï¼",-1))]),t("div",Pt,[dt((u(),p(B,{type:"primary",size:"large",onClick:l[0]||(l[0]=N=>T("/vulnerability/submit"))},{default:o(()=>[s(_,null,{default:o(()=>[s(d(mt))]),_:1}),l[3]||(l[3]=h(" æäº¤æ¼æ´ ",-1))]),_:1})),[[Z,"vuln:submit:add"]]),s(B,{type:"success",size:"large",onClick:l[1]||(l[1]=N=>T("/vulnerability/mytodo"))},{default:o(()=>[s(_,null,{default:o(()=>[s(d(ft))]),_:1}),l[4]||(l[4]=h(" æˆ‘çš„å¾…åŠ ",-1))]),_:1})])])]}),_:1})]),_:1})]),_:1}),s(S,{gutter:20,class:"mt-20"},{default:o(()=>[s(f,{xs:24,sm:12,md:6},{default:o(()=>[s(m,{class:"stat-card",shadow:"hover"},{default:o(()=>[t("div",Rt,[s(_,{size:32},{default:o(()=>[s(d(M))]),_:1})]),t("div",It,[t("div",Tt,r(a.assetCount),1),l[5]||(l[5]=t("div",{class:"stat-label"},"èµ„äº§æ€»æ•°",-1))])]),_:1})]),_:1}),s(f,{xs:24,sm:12,md:6},{default:o(()=>[s(m,{class:"stat-card",shadow:"hover"},{default:o(()=>[t("div",Bt,[s(_,{size:32},{default:o(()=>[s(d($))]),_:1})]),t("div",Ot,[t("div",Vt,r(a.vulnCount),1),l[6]||(l[6]=t("div",{class:"stat-label"},"æ¼æ´æ€»æ•°",-1))])]),_:1})]),_:1}),s(f,{xs:24,sm:12,md:6},{default:o(()=>[s(m,{class:"stat-card",shadow:"hover"},{default:o(()=>[t("div",At,[s(_,{size:32},{default:o(()=>[s(d(K))]),_:1})]),t("div",Mt,[t("div",$t,r(a.fixedCount),1),l[7]||(l[7]=t("div",{class:"stat-label"},"å·²ä¿®å¤",-1))])]),_:1})]),_:1}),s(f,{xs:24,sm:12,md:6},{default:o(()=>[s(m,{class:"stat-card",shadow:"hover"},{default:o(()=>[t("div",Kt,[s(_,{size:32},{default:o(()=>[s(d(pt))]),_:1})]),t("div",Ut,[t("div",Wt,r(a.articleCount),1),l[8]||(l[8]=t("div",{class:"stat-label"},"çŸ¥è¯†åº“æ–‡ç« ",-1))])]),_:1})]),_:1})]),_:1}),s(S,{gutter:20,class:"mt-20"},{default:o(()=>[s(f,{xs:24,md:12},{default:o(()=>[s(m,null,{header:o(()=>[t("div",qt,[l[10]||(l[10]=t("span",null,"æ¼æ´é£é™©",-1)),s(x,{type:"danger",size:"small"},{default:o(()=>[...l[9]||(l[9]=[h("å®æ—¶",-1)])]),_:1})])]),default:o(()=>[t("div",Ft,[t("div",{ref_key:"riskChartRef",ref:y,class:"risk-chart"},null,512)])]),_:1})]),_:1}),s(f,{xs:24,md:12},{default:o(()=>[s(m,null,{header:o(()=>[t("div",Ht,[l[11]||(l[11]=t("span",null,"ä¿®å¤è¿›åº¦",-1)),s(x,{type:"success",size:"small"},{default:o(()=>[h(r(I.value)+"%",1)]),_:1})])]),default:o(()=>[t("div",Jt,[t("div",Gt,[s(Q,{type:"circle",percentage:I.value,width:180,"stroke-width":14},{default:o(({percentage:n})=>[t("span",Qt,r(n)+"%",1),l[12]||(l[12]=t("span",{class:"percentage-label"},"ä¿®å¤ç‡",-1))]),_:1},8,["percentage"])]),t("div",jt,[t("div",Xt,[t("div",Yt,[s(_,{size:24},{default:o(()=>[s(d(M))]),_:1})]),t("div",Zt,[l[13]||(l[13]=t("span",{class:"label"},"æ€»è®¡æ¼æ´",-1)),t("span",te,r(a.vulnCount),1)])]),t("div",ee,[t("div",se,[s(_,{size:24},{default:o(()=>[s(d(K))]),_:1})]),t("div",oe,[l[14]||(l[14]=t("span",{class:"label"},"å·²ä¿®å¤",-1)),t("span",le,r(a.fixedCount),1)])]),t("div",ae,[t("div",ne,[s(_,{size:24},{default:o(()=>[s(d($))]),_:1})]),t("div",ie,[l[15]||(l[15]=t("span",{class:"label"},"å¾…ä¿®å¤",-1)),t("span",re,r(a.vulnCount-a.fixedCount),1)])])])])]),_:1})]),_:1})]),_:1}),s(S,{gutter:20,class:"mt-20"},{default:o(()=>[s(f,{xs:24,md:12},{default:o(()=>[s(m,null,{header:o(()=>[t("div",ce,[l[16]||(l[16]=t("span",null,"æˆ‘çš„å¾…åŠ",-1)),s(j,{value:w.value.length,type:"danger"},null,8,["value"])])]),default:o(()=>[t("div",de,[w.value.length===0?(u(),p(O,{key:0,description:"æš‚æ— å¾…åŠäº‹é¡¹","image-size":100})):(u(),v("div",ue,[(u(!0),v(L,null,P(w.value,n=>(u(),v("div",{key:n.id,class:"todo-item",onClick:E=>J(n)},[t("div",me,[s(x,{type:n.levelType,size:"small"},{default:o(()=>[h(r(U(n.level)),1)]),_:2},1032,["type"]),t("span",fe,r(n.title),1)]),t("div",ve,[t("span",pe,r(n.time),1),s(_,null,{default:o(()=>[s(d(Ct))]),_:1})])],8,_e))),128))]))])]),_:1})]),_:1}),s(f,{xs:24,md:12},{default:o(()=>[s(m,null,{header:o(()=>[...l[17]||(l[17]=[t("div",{class:"card-header"},[t("span",null,"æœ€æ–°åŠ¨æ€")],-1)])]),default:o(()=>[t("div",he,[z.value.length===0?(u(),p(O,{key:0,description:"æš‚æ— æœ€æ–°åŠ¨æ€","image-size":100})):(u(),p(Y,{key:1},{default:o(()=>[(u(!0),v(L,null,P(z.value,n=>(u(),p(X,{key:n.id,timestamp:d(St)(n.time),color:n.color},{default:o(()=>[t("div",{class:"activity-content",onClick:E=>G(n)},[t("span",Ce,"ã€"+r(n.action)+"ã€‘",1),t("span",be,r(n.target),1)],8,ge)]),_:2},1032,["timestamp","color"]))),128))]),_:1}))])]),_:1})]),_:1})]),_:1})])}}},Re=tt(ke,[["__scopeId","data-v-ad44dca3"]]);export{Re as default};
