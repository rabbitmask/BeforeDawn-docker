import{_ as Y,a as h,r as u,z as ee,c as le,o as i,d as l,w as t,J as te,H as p,a7 as ae,a3 as oe,I as se,s as r,a4 as N,l as re,at as ne,q as ie,a2 as de,b as U,m as B,K as ue,ad as pe,t as me,D as fe,E as ce,j as _e,k as ye,a9 as be,aa as ve,af as ge,Z as Ve,$ as Te,ag as Ee,ab as ke,x as f,ac as we}from"./index-P-kv1zA8.js";/* empty css                   *//* empty css                   *//* empty css                 *//* empty css                        *//* empty css               *//* empty css                  *//* empty css                *//* empty css                        *//* empty css                *//* empty css                       *//* empty css                       *//* empty css                */import{k as Ce,q as Pe,r as xe,s as Ne,t as Ue}from"./system-vI2kx4NC.js";const De={class:"app-container"},Ie={class:"card-header"},Oe={__name:"index",setup(he){const q=h({keyword:"",permissionType:"",status:null}),E=u(!1),_=u(!0),R=u(),T=u([]),k=u([]),D=u([]),c=u(!1),w=u(""),C=u(null),o=h({id:null,permissionCode:"",permissionName:"",permissionType:"menu",parentId:0,resourcePath:"",method:"",icon:"",sortOrder:0,description:"",status:1}),A={permissionCode:[{required:!0,message:"请输入权限编码",trigger:"blur"},{pattern:/^[a-z0-9:_]+$/,message:"只能包含小写字母、数字、冒号和下划线",trigger:"blur"}],permissionName:[{required:!0,message:"请输入权限名称",trigger:"blur"}],permissionType:[{required:!0,message:"请选择权限类型",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},P=u(!1),x=async()=>{E.value=!0;try{const s=await Ce(q);k.value=s||[],D.value=[{id:0,permissionName:"顶级权限",children:s||[]}],_.value&&(T.value=I(s||[]))}catch{f.error("查询权限列表失败")}finally{E.value=!1}},L=()=>{_.value=!_.value,_.value?T.value=I(k.value):T.value=[]},I=s=>{const e=[],m=y=>{y&&y.forEach(n=>{e.push(n.id),n.children&&n.children.length>0&&m(n.children)})};return m(s),e},S=()=>{w.value="新增权限",Object.assign(o,{id:null,permissionCode:"",permissionName:"",permissionType:"menu",parentId:0,resourcePath:"",method:"",icon:"",sortOrder:0,description:"",status:1}),c.value=!0},H=async s=>{w.value="编辑权限";try{const e=await Pe(s.id);Object.assign(o,e),c.value=!0}catch{f.error("获取权限详情失败")}},$=async()=>{await C.value.validate(),P.value=!0;try{o.id?(await Ne(o.id,o),f.success("更新权限成功")):(await Ue(o),f.success("创建权限成功")),c.value=!1,x()}catch(s){f.error(s.message||"操作失败")}finally{P.value=!1}},j=s=>{we.confirm("确定要删除该权限吗？如果有子权限将无法删除。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await xe(s.id),f.success("删除成功"),x()}catch(e){f.error(e.message||"删除失败")}}).catch(()=>{})},F=()=>{var s;(s=C.value)==null||s.resetFields()};return ee(()=>{x()}),(s,e)=>{const m=ie,y=re,n=oe,b=se,G=ae,K=fe,v=ye,d=_e,g=ve,O=be,M=ge,V=Te,z=Ve,J=Ee,Z=ce,Q=ke,W=de;return i(),le("div",De,[l(K,{class:"table-card",shadow:"never"},{header:t(()=>[U("div",Ie,[e[13]||(e[13]=U("span",null,"权限列表",-1)),U("div",null,[l(m,{type:"primary",icon:B(ue),onClick:S},{default:t(()=>[...e[12]||(e[12]=[r("新增权限",-1)])]),_:1},8,["icon"]),l(m,{onClick:L},{default:t(()=>[l(y,null,{default:t(()=>[l(B(pe))]),_:1}),r(" "+me(_.value?"折叠全部":"展开全部"),1)]),_:1})])])]),default:t(()=>[te((i(),p(G,{ref_key:"permTableRef",ref:R,data:k.value,"row-key":"id","expand-row-keys":T.value,border:"",stripe:"","tree-props":{children:"children"}},{default:t(()=>[l(n,{label:"权限名称",prop:"permissionName","min-width":"200"}),l(n,{label:"权限编码",prop:"permissionCode",width:"200"}),l(n,{label:"权限类型",prop:"permissionType",width:"100"},{default:t(({row:a})=>[a.permissionType==="menu"?(i(),p(b,{key:0,type:"primary"},{default:t(()=>[...e[14]||(e[14]=[r("菜单",-1)])]),_:1})):a.permissionType==="button"?(i(),p(b,{key:1,type:"success"},{default:t(()=>[...e[15]||(e[15]=[r("按钮",-1)])]),_:1})):(i(),p(b,{key:2,type:"warning"},{default:t(()=>[...e[16]||(e[16]=[r("接口",-1)])]),_:1}))]),_:1}),l(n,{label:"资源路径",prop:"resourcePath","show-overflow-tooltip":"",width:"200"}),l(n,{label:"HTTP方法",prop:"method",width:"100"}),l(n,{label:"图标",prop:"icon",width:"80"},{default:t(({row:a})=>[a.icon?(i(),p(y,{key:0},{default:t(()=>[(i(),p(ne(a.icon)))]),_:2},1024)):N("",!0)]),_:1}),l(n,{label:"排序",prop:"sortOrder",width:"80"}),l(n,{label:"状态",prop:"status",width:"80"},{default:t(({row:a})=>[a.status===1?(i(),p(b,{key:0,type:"success"},{default:t(()=>[...e[17]||(e[17]=[r("启用",-1)])]),_:1})):(i(),p(b,{key:1,type:"danger"},{default:t(()=>[...e[18]||(e[18]=[r("禁用",-1)])]),_:1}))]),_:1}),l(n,{label:"操作",fixed:"right",width:"180"},{default:t(({row:a})=>[l(m,{link:"",type:"primary",onClick:X=>H(a)},{default:t(()=>[...e[19]||(e[19]=[r("编辑",-1)])]),_:1},8,["onClick"]),l(m,{link:"",type:"danger",onClick:X=>j(a)},{default:t(()=>[...e[20]||(e[20]=[r("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data","expand-row-keys"])),[[W,E.value]])]),_:1}),l(Q,{modelValue:c.value,"onUpdate:modelValue":e[11]||(e[11]=a=>c.value=a),title:w.value,width:"600px",onClose:F},{footer:t(()=>[l(m,{onClick:e[10]||(e[10]=a=>c.value=!1)},{default:t(()=>[...e[26]||(e[26]=[r("取消",-1)])]),_:1}),l(m,{type:"primary",loading:P.value,onClick:$},{default:t(()=>[...e[27]||(e[27]=[r("确定",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(Z,{ref_key:"formRef",ref:C,model:o,rules:A,"label-width":"100px"},{default:t(()=>[l(d,{label:"权限编码",prop:"permissionCode"},{default:t(()=>[l(v,{modelValue:o.permissionCode,"onUpdate:modelValue":e[0]||(e[0]=a=>o.permissionCode=a),placeholder:"如：system:user:add"},null,8,["modelValue"])]),_:1}),l(d,{label:"权限名称",prop:"permissionName"},{default:t(()=>[l(v,{modelValue:o.permissionName,"onUpdate:modelValue":e[1]||(e[1]=a=>o.permissionName=a),placeholder:"如：新增用户"},null,8,["modelValue"])]),_:1}),l(d,{label:"权限类型",prop:"permissionType"},{default:t(()=>[l(O,{modelValue:o.permissionType,"onUpdate:modelValue":e[2]||(e[2]=a=>o.permissionType=a)},{default:t(()=>[l(g,{label:"menu"},{default:t(()=>[...e[21]||(e[21]=[r("菜单",-1)])]),_:1}),l(g,{label:"button"},{default:t(()=>[...e[22]||(e[22]=[r("按钮",-1)])]),_:1}),l(g,{label:"api"},{default:t(()=>[...e[23]||(e[23]=[r("接口",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"父权限"},{default:t(()=>[l(M,{modelValue:o.parentId,"onUpdate:modelValue":e[3]||(e[3]=a=>o.parentId=a),data:D.value,props:{children:"children",label:"permissionName",value:"id"},"check-strictly":"",placeholder:"请选择父权限（不选则为顶级权限）",clearable:""},null,8,["modelValue","data"])]),_:1}),l(d,{label:"资源路径"},{default:t(()=>[l(v,{modelValue:o.resourcePath,"onUpdate:modelValue":e[4]||(e[4]=a=>o.resourcePath=a),placeholder:"菜单路由或API路径"},null,8,["modelValue"])]),_:1}),o.permissionType==="api"?(i(),p(d,{key:0,label:"HTTP方法"},{default:t(()=>[l(z,{modelValue:o.method,"onUpdate:modelValue":e[5]||(e[5]=a=>o.method=a),placeholder:"请选择"},{default:t(()=>[l(V,{label:"GET",value:"GET"}),l(V,{label:"POST",value:"POST"}),l(V,{label:"PUT",value:"PUT"}),l(V,{label:"DELETE",value:"DELETE"}),l(V,{label:"PATCH",value:"PATCH"})]),_:1},8,["modelValue"])]),_:1})):N("",!0),o.permissionType==="menu"?(i(),p(d,{key:1,label:"图标"},{default:t(()=>[l(v,{modelValue:o.icon,"onUpdate:modelValue":e[6]||(e[6]=a=>o.icon=a),placeholder:"Element Plus图标名称"},null,8,["modelValue"])]),_:1})):N("",!0),l(d,{label:"排序"},{default:t(()=>[l(J,{modelValue:o.sortOrder,"onUpdate:modelValue":e[7]||(e[7]=a=>o.sortOrder=a),min:0},null,8,["modelValue"])]),_:1}),l(d,{label:"描述"},{default:t(()=>[l(v,{modelValue:o.description,"onUpdate:modelValue":e[8]||(e[8]=a=>o.description=a),type:"textarea",rows:3,placeholder:"权限描述"},null,8,["modelValue"])]),_:1}),l(d,{label:"状态",prop:"status"},{default:t(()=>[l(O,{modelValue:o.status,"onUpdate:modelValue":e[9]||(e[9]=a=>o.status=a)},{default:t(()=>[l(g,{label:1},{default:t(()=>[...e[24]||(e[24]=[r("启用",-1)])]),_:1}),l(g,{label:0},{default:t(()=>[...e[25]||(e[25]=[r("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Je=Y(Oe,[["__scopeId","data-v-835b4363"]]);export{Je as default};
