import{_ as Z,i as ee,h as te,u as ae,aG as se,r as y,y as B,z as le,c,o as i,d as a,J as oe,w as s,b as l,aB as ne,a2 as ie,H as p,C as ue,D as ce,a4 as _,t as o,aQ as re,l as de,m as u,n as _e,aO as ve,aw as I,aN as V,ae as me,F as R,G as x,I as pe,s as r,ay as fe,v as ye,q as he,a5 as ge,aC as ke,aD as be,S as we,M as Ce,x as L}from"./index-P-kv1zA8.js";/* empty css                   *//* empty css               *//* empty css                             *//* empty css                *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                       */import{r as Te}from"./style-WFyn0wIQ.js";import{b as Ee,m as De,g as Se}from"./knowledge-D4KuY_Xz.js";import{f as T}from"./format-BQFyjrq8.js";const Ae={class:"page-container"},Ne={class:"article-header"},Be={class:"article-title"},Ie={class:"article-meta"},Ve={class:"meta-item"},Re={class:"author-name"},xe={class:"meta-item"},Le={class:"meta-item"},ze={class:"meta-item"},Me={class:"article-tags-section"},Ue={key:0,class:"category-tag"},$e={key:1,class:"tags-wrapper"},Fe={key:0,class:"article-summary"},Ge={class:"summary-title"},He={class:"article-footer"},qe={class:"related-info"},Je={key:0,class:"info-item"},Oe={class:"info-value"},Pe={key:1,class:"info-item"},Qe={class:"info-value"},je={key:2,class:"info-item"},Ke={class:"info-value"},We={key:0,class:"recommend-list"},Xe=["onClick"],Ye={class:"rec-title"},Ze={class:"rec-meta"},et="https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png",tt={__name:"detail",setup(at){const z=ee(),h=te(),E=ae(),g=se(),k=y(!1),e=y({}),b=y(!1),w=y([]),M=B(()=>e.value.vulnType||e.value.assetType||e.value.techStack),U=B(()=>{var n;return e.value.authorId===((n=E.userInfo)==null?void 0:n.id)||E.hasRole("ADMIN")}),$=n=>g.getDictLabel("vuln_type",n),F=n=>g.getDictLabel("asset_type",n),D=async()=>{k.value=!0;try{const n=z.params.id,t=await Ee(n);e.value=t,(t.vulnType||t.assetType||t.techStack)&&G({vulnType:t.vulnType,assetType:t.assetType,techStack:t.techStack})}catch(n){console.error("加载文章详情失败:",n),L.error("加载文章详情失败")}finally{k.value=!1}},G=async n=>{try{const t=await Se(n);w.value=(t||[]).filter(C=>C.id!==e.value.id)}catch(t){console.error("加载推荐文章失败:",t)}},H=()=>{h.back()},q=async()=>{try{await De(e.value.id),e.value.usefulCount=(e.value.usefulCount||0)+1,b.value=!0,L.success("点赞成功")}catch(n){console.error("点赞失败:",n)}},J=()=>{h.push(`/knowledge/article/edit/${e.value.id}`)},O=n=>{h.push(`/knowledge/article/detail/${n}`),D()};return le(async()=>{await g.loadDicts(["vuln_type","asset_type"]),D()}),(n,t)=>{const C=ne,v=de,P=re,Q=pe,j=fe,S=he,f=ce,A=ue,m=be,K=ke,W=we,X=Ce,Y=ie;return i(),c("div",Ae,[a(C,{onBack:H,class:"mb-20"},{content:s(()=>[...t[1]||(t[1]=[l("span",{class:"page-title"},"文章详情",-1)])]),_:1}),oe((i(),p(X,{gutter:20},{default:s(()=>[a(A,{span:18},{default:s(()=>[a(f,{shadow:"never",class:"article-card"},{default:s(()=>[l("div",Ne,[l("h1",Be,o(e.value.title),1),l("div",Ie,[l("div",Ve,[a(P,{size:32,src:et},{default:s(()=>[a(v,null,{default:s(()=>[a(u(_e))]),_:1})]),_:1}),l("span",Re,o(e.value.authorName),1)]),l("div",xe,[a(v,null,{default:s(()=>[a(u(ve))]),_:1}),l("span",null,o(u(T)(e.value.publishTime||e.value.createTime)),1)]),l("div",Le,[a(v,null,{default:s(()=>[a(u(I))]),_:1}),l("span",null,o(e.value.viewCount||0)+" 浏览",1)]),l("div",ze,[a(v,null,{default:s(()=>[a(u(V))]),_:1}),l("span",null,o(e.value.usefulCount||0)+" 点赞",1)])]),l("div",Me,[e.value.categoryName?(i(),c("div",Ue,[a(v,null,{default:s(()=>[a(u(me))]),_:1}),l("span",null,o(e.value.categoryName),1)])):_("",!0),e.value.tags&&e.value.tags.length>0?(i(),c("div",$e,[(i(!0),c(R,null,x(e.value.tags,(d,N)=>(i(),p(Q,{key:N,type:"info"},{default:s(()=>[r(o(d),1)]),_:2},1024))),128))])):_("",!0)])]),e.value.summary?(i(),c("div",Fe,[a(j,{type:"info",closable:!1},{title:s(()=>[l("div",Ge,[a(v,null,{default:s(()=>[a(u(ye))]),_:1}),t[2]||(t[2]=l("span",null,"内容摘要",-1))])]),default:s(()=>[r(" "+o(e.value.summary),1)]),_:1})])):_("",!0),a(u(Te),{modelValue:e.value.content,"onUpdate:modelValue":t[0]||(t[0]=d=>e.value.content=d),language:"zh-CN",class:"article-content"},null,8,["modelValue"]),l("div",He,[a(S,{type:"primary",icon:u(V),onClick:q,disabled:b.value},{default:s(()=>[r(o(b.value?"已点赞":"觉得有用")+" ("+o(e.value.usefulCount||0)+") ",1)]),_:1},8,["icon","disabled"]),U.value?(i(),p(S,{key:0,type:"warning",icon:u(ge),onClick:J},{default:s(()=>[...t[3]||(t[3]=[r(" 编辑文章 ",-1)])]),_:1},8,["icon"])):_("",!0)])]),_:1})]),_:1}),a(A,{span:6},{default:s(()=>[a(f,{shadow:"never",class:"mb-20"},{header:s(()=>[...t[4]||(t[4]=[l("span",null,"文章信息",-1)])]),default:s(()=>[a(K,{column:1,border:"",size:"small"},{default:s(()=>[a(m,{label:"文章编号"},{default:s(()=>[r(o(e.value.articleCode),1)]),_:1}),a(m,{label:"浏览次数"},{default:s(()=>[r(o(e.value.viewCount||0),1)]),_:1}),a(m,{label:"引用次数"},{default:s(()=>[r(o(e.value.referenceCount||0),1)]),_:1}),a(m,{label:"点赞次数"},{default:s(()=>[r(o(e.value.usefulCount||0),1)]),_:1}),a(m,{label:"发布时间"},{default:s(()=>[r(o(u(T)(e.value.publishTime)),1)]),_:1}),a(m,{label:"更新时间"},{default:s(()=>[r(o(u(T)(e.value.updateTime)),1)]),_:1})]),_:1})]),_:1}),M.value?(i(),p(f,{key:0,shadow:"never",class:"mb-20"},{header:s(()=>[...t[5]||(t[5]=[l("span",null,"关联信息",-1)])]),default:s(()=>[l("div",qe,[e.value.vulnType?(i(),c("div",Je,[t[6]||(t[6]=l("div",{class:"info-label"},"漏洞类型",-1)),l("div",Oe,o($(e.value.vulnType)),1)])):_("",!0),e.value.assetType?(i(),c("div",Pe,[t[7]||(t[7]=l("div",{class:"info-label"},"资产类型",-1)),l("div",Qe,o(F(e.value.assetType)),1)])):_("",!0),e.value.techStack?(i(),c("div",je,[t[8]||(t[8]=l("div",{class:"info-label"},"技术栈",-1)),l("div",Ke,o(e.value.techStack),1)])):_("",!0)])]),_:1})):_("",!0),a(f,{shadow:"never"},{header:s(()=>[...t[9]||(t[9]=[l("span",null,"相关文章",-1)])]),default:s(()=>[w.value.length>0?(i(),c("div",We,[(i(!0),c(R,null,x(w.value,d=>(i(),c("div",{key:d.id,class:"recommend-item",onClick:N=>O(d.id)},[l("h4",Ye,o(d.title),1),l("div",Ze,[a(v,null,{default:s(()=>[a(u(I))]),_:1}),l("span",null,o(d.viewCount||0),1)])],8,Xe))),128))])):(i(),p(W,{key:1,description:"暂无推荐","image-size":80}))]),_:1})]),_:1})]),_:1})),[[Y,k.value]])])}}},pt=Z(tt,[["__scopeId","data-v-0505ae96"]]);export{pt as default};
