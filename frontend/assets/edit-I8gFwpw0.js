import{_ as $,i as z,h as G,r as i,y as E,a as H,z as J,c,o as n,d as l,w as a,b as P,t as Q,aq as X,I as Y,G as p,E as K,j as W,k as Z,X as ee,F as T,D as x,Y as te,aE as le,s as m,q as ae,l as oe,m as L,ak as re,ax as se,a0 as ne,C as ue,x as D}from"./index-bBUAzOnK.js";/* empty css                   *//* empty css                *//* empty css                 *//* empty css                       *//* empty css               *//* empty css                  */import{M as de}from"./MarkdownEditor-DjlcAQld.js";import{b as ie,u as ce,c as pe}from"./knowledge-Cmde9Vbp.js";import{f as me}from"./dict-BgffWH13.js";import{u as ye}from"./dict-EIgV8cgj.js";import"./style-CCN6Cyms.js";import"./file-BNPWs1fO.js";const fe={class:"page-container"},ge={class:"page-title"},_e={__name:"edit",setup(ve){const y=z(),S=G(),f=ye(),g=i(!1),d=i(!1),_=i(null),v=E(()=>!!y.params.id),h=i([]),M=E(()=>f.getDictData("vuln_type")),q=E(()=>f.getDictData("asset_type")),o=H({title:"",summary:"",content:"",category:null,vulnType:"",assetType:"",techStack:""}),I={title:[{required:!0,message:"请输入文章标题",trigger:"blur"},{min:5,max:100,message:"标题长度5-100字符",trigger:"blur"}],content:[{required:!0,message:"请输入文章内容",trigger:"blur"},{min:10,message:"内容至少10字符",trigger:"blur"}],category:[{required:!0,message:"请选择文章分类",trigger:"change"}]},O=async()=>{try{const r=await me("knowledge_category");h.value=r||[]}catch(r){console.error("加载分类列表失败:",r)}},A=async()=>{if(v.value){g.value=!0;try{const r=await ie(y.params.id);Object.assign(o,{title:r.title,summary:r.summary,content:r.content,category:r.category,vulnType:r.vulnType,assetType:r.assetType,techStack:r.techStack})}catch(r){console.error("加载文章详情失败:",r),D.error("加载文章详情失败")}finally{g.value=!1}}},B=async r=>{_.value&&await _.value.validate(async e=>{if(e){d.value=!0;try{const u={...o,status:r};v.value?(await ce(y.params.id,u),D.success("更新文章成功")):(await pe(u),D.success("创建文章成功")),S.push("/knowledge/article")}catch(u){console.error("保存文章失败:",u)}finally{d.value=!1}}})},C=()=>{S.back()};return J(async()=>{await f.loadDicts(["knowledge_category","vuln_type","asset_type"]),O(),A()}),(r,e)=>{const u=X,b=Z,s=W,V=te,k=ee,F=le,U=oe,w=ae,R=K,N=ue,j=ne;return n(),c("div",fe,[l(u,{onBack:C,class:"mb-20"},{content:a(()=>[P("span",ge,Q(v.value?"编辑文章":"创建文章"),1)]),_:1}),l(N,{shadow:"never"},{default:a(()=>[Y((n(),p(R,{ref_key:"formRef",ref:_,model:o,rules:I,"label-width":"100px"},{default:a(()=>[l(s,{label:"文章标题",prop:"title"},{default:a(()=>[l(b,{modelValue:o.title,"onUpdate:modelValue":e[0]||(e[0]=t=>o.title=t),placeholder:"请输入文章标题",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(s,{label:"文章摘要",prop:"summary"},{default:a(()=>[l(b,{modelValue:o.summary,"onUpdate:modelValue":e[1]||(e[1]=t=>o.summary=t),type:"textarea",rows:3,placeholder:"请输入文章摘要（选填）",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(s,{label:"文章分类",prop:"category"},{default:a(()=>[l(k,{modelValue:o.category,"onUpdate:modelValue":e[2]||(e[2]=t=>o.category=t),placeholder:"请选择分类",filterable:"",style:{width:"100%"}},{default:a(()=>[(n(!0),c(T,null,x(h.value,t=>(n(),p(V,{key:t.dictValue,label:t.dictLabel,value:t.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(s,{label:"文章内容",prop:"content"},{default:a(()=>[l(de,{modelValue:o.content,"onUpdate:modelValue":e[3]||(e[3]=t=>o.content=t),placeholder:"请输入文章内容（支持Markdown语法）",height:"600px"},null,8,["modelValue"])]),_:1}),l(F,{"content-position":"left"},{default:a(()=>[...e[9]||(e[9]=[m("关联信息（选填）",-1)])]),_:1}),l(s,{label:"漏洞类型"},{default:a(()=>[l(k,{modelValue:o.vulnType,"onUpdate:modelValue":e[4]||(e[4]=t=>o.vulnType=t),placeholder:"请选择",clearable:"",style:{width:"100%"}},{default:a(()=>[(n(!0),c(T,null,x(M.value,t=>(n(),p(V,{key:t.dictValue,label:t.dictLabel,value:t.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(s,{label:"资产类型"},{default:a(()=>[l(k,{modelValue:o.assetType,"onUpdate:modelValue":e[5]||(e[5]=t=>o.assetType=t),placeholder:"请选择",clearable:"",style:{width:"100%"}},{default:a(()=>[(n(!0),c(T,null,x(q.value,t=>(n(),p(V,{key:t.dictValue,label:t.dictLabel,value:t.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(s,{label:"技术栈"},{default:a(()=>[l(b,{modelValue:o.techStack,"onUpdate:modelValue":e[6]||(e[6]=t=>o.techStack=t),placeholder:"如：Java, Spring Boot, MySQL",clearable:""},null,8,["modelValue"])]),_:1}),l(s,null,{default:a(()=>[l(w,{type:"primary",loading:d.value,onClick:e[7]||(e[7]=t=>B("published"))},{default:a(()=>[l(U,null,{default:a(()=>[l(L(re))]),_:1}),e[10]||(e[10]=m(" 发布文章 ",-1))]),_:1},8,["loading"]),l(w,{loading:d.value,onClick:e[8]||(e[8]=t=>B("draft"))},{default:a(()=>[l(U,null,{default:a(()=>[l(L(se))]),_:1}),e[11]||(e[11]=m(" 保存草稿 ",-1))]),_:1},8,["loading"]),l(w,{onClick:C},{default:a(()=>[...e[12]||(e[12]=[m("取消",-1)])]),_:1})]),_:1})]),_:1},8,["model"])),[[j,g.value]])]),_:1})])}}},Le=$(_e,[["__scopeId","data-v-f520ccd2"]]);export{Le as default};
