import{_ as te,r as u,c as R,z as le,d as ae,x as w,f as e,w as l,p as ne,E as oe,h as de,X as re,Y as se,m as ue,n as d,i as ie,j as i,Z as pe,$ as me,C as ce,e as S,J as j,ab as fe,t as N,I as _e,G as A,a5 as ve,a1 as ge,a2 as be,ac as ye,H as he,a3 as Ve,a4 as Ee,a0 as Ne,ad as Ce,ae as ke,a7 as xe,a8 as Te,a9 as Oe,v as g,aa as Ie}from"./index-nPQbSI0E.js";/* empty css                   *//* empty css                   *//* empty css                       *//* empty css                 *//* empty css                        *//* empty css               *//* empty css                  *//* empty css                *//* empty css                        *//* empty css                *//* empty css                       *//* empty css                */import{a as we}from"./index-OpVLjujC.js";import{e as De,f as Be,h as Fe,i as $e}from"./system-Cg7qzDSY.js";const Ue={class:"page-container"},Re={class:"toolbar"},Se={__name:"index",setup(je){const C=u(!1),b=u(!0),k=u(!1),c=R({departmentName:"",status:null}),y=u([]),h=u([]),f=u(!1),x=u(""),T=u(!1),V=u(null),o=R({id:null,parentId:null,departmentName:"",sortOrder:0,status:1}),M={departmentName:[{required:!0,message:"请输入部门名称",trigger:"blur"}]},_=async()=>{C.value=!0;try{const a=await De();y.value=a||[],h.value=E(a,o.id)}catch(a){console.error("加载部门树失败:",a),g.error("加载部门树失败")}finally{C.value=!1}},E=(a,t)=>!a||a.length===0?[]:a.filter(r=>r.id!==t).map(r=>({id:r.id,departmentName:r.departmentName,children:r.children?E(r.children,t):[]})),O=()=>{_()},z=()=>{Object.assign(c,{departmentName:"",status:null}),_()},G=()=>{b.value=!b.value},D=a=>{T.value=!1,x.value=a?`新增子部门 - ${a.departmentName}`:"新增部门",Object.assign(o,{id:null,parentId:a?a.id:null,departmentName:"",sortOrder:0,status:1}),h.value=E(y.value,null),f.value=!0},q=a=>{T.value=!0,x.value="编辑部门",Object.assign(o,{id:a.id,parentId:a.parentId,departmentName:a.departmentName,sortOrder:a.sortOrder,status:a.status}),h.value=E(y.value,a.id),f.value=!0},H=a=>{if(a.children&&a.children.length>0){g.warning("该部门下存在子部门，无法删除！");return}Ie.confirm(`确定要删除部门 "${a.departmentName}" 吗？此操作不可恢复！`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Be(a.id),g.success("删除部门成功"),_()}catch(t){console.error("删除部门失败:",t)}}).catch(()=>{})},J=()=>{var a;(a=V.value)==null||a.resetFields()},L=async()=>{V.value&&await V.value.validate(async a=>{if(a){k.value=!0;try{T.value?(await Fe(o.id,o),g.success("更新部门成功")):(await $e(o),g.success("创建部门成功")),f.value=!1,_()}catch(t){console.error("保存部门失败:",t)}finally{k.value=!1}}})};return le(()=>{_()}),(a,t)=>{const r=de,m=oe,B=se,X=re,p=ie,s=ue,F=ne,I=ce,v=ge,Y=he,Z=ve,K=Ce,P=ke,$=Te,Q=xe,W=Oe,ee=Ne;return w(),ae("div",Ue,[e(I,{shadow:"never",class:"search-card"},{default:l(()=>[e(F,{model:c,inline:""},{default:l(()=>[e(m,{label:"部门名称"},{default:l(()=>[e(r,{modelValue:c.departmentName,"onUpdate:modelValue":t[0]||(t[0]=n=>c.departmentName=n),placeholder:"请输入部门名称",clearable:"",style:{width:"200px"},onClear:O},null,8,["modelValue"])]),_:1}),e(m,{label:"状态"},{default:l(()=>[e(X,{modelValue:c.status,"onUpdate:modelValue":t[1]||(t[1]=n=>c.status=n),placeholder:"请选择状态",clearable:"",style:{width:"120px"},onChange:O},{default:l(()=>[e(B,{label:"启用",value:1}),e(B,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1}),e(m,null,{default:l(()=>[e(s,{type:"primary",onClick:O},{default:l(()=>[e(p,null,{default:l(()=>[e(i(pe))]),_:1}),t[9]||(t[9]=d(" 搜索 ",-1))]),_:1}),e(s,{onClick:z},{default:l(()=>[e(p,null,{default:l(()=>[e(i(me))]),_:1}),t[10]||(t[10]=d(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(I,{shadow:"never",class:"toolbar-card"},{default:l(()=>[S("div",Re,[S("div",null,[e(s,{type:"primary",onClick:t[2]||(t[2]=n=>D(null))},{default:l(()=>[e(p,null,{default:l(()=>[e(i(j))]),_:1}),t[11]||(t[11]=d(" 新增部门 ",-1))]),_:1}),e(s,{onClick:G},{default:l(()=>[e(p,null,{default:l(()=>[e(i(fe))]),_:1}),d(" "+N(b.value?"折叠全部":"展开全部"),1)]),_:1})])])]),_:1}),e(I,{shadow:"never"},{default:l(()=>[_e((w(),A(Z,{data:y.value,"row-key":"id","default-expand-all":b.value,"tree-props":{children:"children",hasChildren:"hasChildren"},border:"",style:{width:"100%"}},{default:l(()=>[e(v,{prop:"departmentName",label:"部门名称","min-width":"200"},{default:l(({row:n})=>[n.children&&n.children.length>0?(w(),A(p,{key:0,style:{"margin-right":"5px"}},{default:l(()=>[e(i(ye))]),_:1})):be("",!0),d(" "+N(n.departmentName),1)]),_:1}),e(v,{prop:"sortOrder",label:"排序",width:"80",align:"center"}),e(v,{label:"状态",width:"80",align:"center"},{default:l(({row:n})=>[e(Y,{type:n.status===1?"success":"danger",size:"small"},{default:l(()=>[d(N(n.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),e(v,{prop:"createTime",label:"创建时间",width:"180"},{default:l(({row:n})=>[d(N(i(we)(n.createTime)),1)]),_:1}),e(v,{label:"操作",width:"280",fixed:"right",align:"center"},{default:l(({row:n})=>[e(s,{link:"",type:"primary",onClick:U=>D(n)},{default:l(()=>[e(p,null,{default:l(()=>[e(i(j))]),_:1}),t[12]||(t[12]=d(" 新增 ",-1))]),_:1},8,["onClick"]),e(s,{link:"",type:"warning",onClick:U=>q(n)},{default:l(()=>[e(p,null,{default:l(()=>[e(i(Ve))]),_:1}),t[13]||(t[13]=d(" 编辑 ",-1))]),_:1},8,["onClick"]),e(s,{link:"",type:"danger",onClick:U=>H(n)},{default:l(()=>[e(p,null,{default:l(()=>[e(i(Ee))]),_:1}),t[14]||(t[14]=d(" 删除 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data","default-expand-all"])),[[ee,C.value]])]),_:1}),e(W,{modelValue:f.value,"onUpdate:modelValue":t[8]||(t[8]=n=>f.value=n),title:x.value,width:"600px",onClose:J},{footer:l(()=>[e(s,{onClick:t[7]||(t[7]=n=>f.value=!1)},{default:l(()=>[...t[17]||(t[17]=[d("取消",-1)])]),_:1}),e(s,{type:"primary",onClick:L,loading:k.value},{default:l(()=>[...t[18]||(t[18]=[d(" 确定 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[e(F,{ref_key:"deptFormRef",ref:V,model:o,rules:M,"label-width":"100px"},{default:l(()=>[e(m,{label:"上级部门",prop:"parentId"},{default:l(()=>[e(K,{modelValue:o.parentId,"onUpdate:modelValue":t[3]||(t[3]=n=>o.parentId=n),data:h.value,props:{label:"departmentName",value:"id",children:"children"},placeholder:"请选择上级部门(为空则为顶级部门)",clearable:"","check-strictly":"","render-after-expand":!1,style:{width:"100%"}},null,8,["modelValue","data"])]),_:1}),e(m,{label:"部门名称",prop:"departmentName"},{default:l(()=>[e(r,{modelValue:o.departmentName,"onUpdate:modelValue":t[4]||(t[4]=n=>o.departmentName=n),placeholder:"请输入部门名称"},null,8,["modelValue"])]),_:1}),e(m,{label:"排序",prop:"sortOrder"},{default:l(()=>[e(P,{modelValue:o.sortOrder,"onUpdate:modelValue":t[5]||(t[5]=n=>o.sortOrder=n),min:0,"controls-position":"right",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(m,{label:"状态",prop:"status"},{default:l(()=>[e(Q,{modelValue:o.status,"onUpdate:modelValue":t[6]||(t[6]=n=>o.status=n)},{default:l(()=>[e($,{value:1},{default:l(()=>[...t[15]||(t[15]=[d("启用",-1)])]),_:1}),e($,{value:0},{default:l(()=>[...t[16]||(t[16]=[d("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},et=te(Se,[["__scopeId","data-v-eab450a8"]]);export{et as default};
