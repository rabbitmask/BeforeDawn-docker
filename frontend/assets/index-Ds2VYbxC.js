import{_ as se,h as oe,u as ne,r as x,a as L,A as re,c as y,o as r,d as e,K as ue,I as i,a5 as m,w as l,E as de,j as ie,k as ce,l as _e,m as u,a1 as M,$ as pe,G as I,H as S,a0 as me,q as fe,s as c,a2 as ge,F as ye,b as n,a6 as F,g as ve,t as _,a3 as he,D as ke,J as we,af as Ce,n as be,aJ as P,aW as Ee,aX as xe,ak as ze,aH as Ve,a7 as Te,N as Be,T as De,a9 as Ie,aM as Se,x as $,ad as R}from"./index-DT2C5K_G.js";/* empty css                   *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                 *//* empty css               *//* empty css                *//* empty css                */import{h as $e}from"./permission-CDgDTLYz.js";import{a as Ne,p as Ue,d as Ae}from"./knowledge-BnEsFMCO.js";import{b as Le}from"./format-BQFyjrq8.js";const Me={class:"page-container"},Fe={class:"toolbar"},Pe={class:"toolbar-right"},Re={key:0,class:"status-badge"},je={class:"article-title"},Oe={class:"article-summary"},He={key:1,class:"article-tags"},Je={class:"article-category"},qe={class:"article-meta"},Ge={class:"meta-item"},Ke={class:"meta-item"},We={class:"meta-item"},Xe={class:"meta-item"},Ye={key:1,class:"pagination-wrapper"},Qe={__name:"index",setup(Ze){const z=oe(),V=ne(),C=x(!1),d=L({keyword:"",category:null,status:""}),f=L({current:1,size:9}),T=x([]),b=x(0),B=x([]),N=s=>{var t;return s.authorId===((t=V.userInfo)==null?void 0:t.id)||V.hasPermission("knowledge:edit")},j=(s,t)=>{if(!s)return"";const o=s.replace(/<[^>]+>/g,"");return o.length<=t?o:o.substring(0,t)+"..."},v=async()=>{C.value=!0;try{const s={current:f.current,size:f.size,...d},t=await Ne(s),o=t.records||[];T.value=o.map(E=>{const p=B.value.find(w=>w.dictValue===E.category);return{...E,categoryLabel:(p==null?void 0:p.dictLabel)||"未分类"}}),b.value=t.total||0}catch(s){console.error("加载文章列表失败:",s),$.error("加载文章列表失败")}finally{C.value=!1}},O=async()=>{try{const s=await Se("knowledge_category");B.value=s||[]}catch(s){console.error("加载分类列表失败:",s)}},k=()=>{f.current=1,v()},H=()=>{Object.assign(d,{keyword:"",category:null,status:""}),k()},J=()=>{z.push("/knowledge/article/edit")},U=s=>{z.push(`/knowledge/article/detail/${s.id}`)},q=s=>{z.push(`/knowledge/article/edit/${s.id}`)},G=s=>{R.confirm("确定要发布这篇文章吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Ue(s.id),$.success("发布成功"),v()}catch(t){console.error("发布文章失败:",t)}}).catch(()=>{})},K=s=>{R.confirm("确定要删除这篇文章吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Ae(s.id),$.success("删除成功"),v()}catch(t){console.error("删除文章失败:",t)}}).catch(()=>{})};return re(async()=>{await O(),v()}),(s,t)=>{const o=_e,E=ce,p=ie,w=me,A=pe,g=fe,W=de,D=ye,X=ve,Y=we,Q=ke,Z=Be,ee=De,te=Ie,ae=he;return r(),y("div",Me,[e(D,{shadow:"never",class:"search-card"},{default:l(()=>[e(W,{model:d,inline:""},{default:l(()=>[e(p,{label:"关键词"},{default:l(()=>[e(E,{modelValue:d.keyword,"onUpdate:modelValue":t[0]||(t[0]=a=>d.keyword=a),placeholder:"文章标题或内容",clearable:"",style:{width:"250px"},onClear:k},{prefix:l(()=>[e(o,null,{default:l(()=>[e(u(M))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"分类"},{default:l(()=>[e(A,{modelValue:d.category,"onUpdate:modelValue":t[1]||(t[1]=a=>d.category=a),placeholder:"请选择",clearable:"",style:{width:"150px"},onChange:k},{default:l(()=>[(r(!0),y(I,null,S(B.value,a=>(r(),i(w,{key:a.dictValue,label:a.dictLabel,value:a.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"状态"},{default:l(()=>[e(A,{modelValue:d.status,"onUpdate:modelValue":t[2]||(t[2]=a=>d.status=a),placeholder:"请选择",clearable:"",style:{width:"120px"},onChange:k},{default:l(()=>[e(w,{label:"草稿",value:"draft"}),e(w,{label:"已发布",value:"published"})]),_:1},8,["modelValue"])]),_:1}),e(p,null,{default:l(()=>[e(g,{type:"primary",onClick:k},{default:l(()=>[e(o,null,{default:l(()=>[e(u(M))]),_:1}),t[6]||(t[6]=c(" 搜索 ",-1))]),_:1}),e(g,{onClick:H},{default:l(()=>[e(o,null,{default:l(()=>[e(u(ge))]),_:1}),t[7]||(t[7]=c(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(D,{shadow:"never",class:"toolbar-card"},{default:l(()=>[n("div",Fe,[n("div",null,[u($e)(["ADMIN","SECURITY"])?(r(),i(g,{key:0,type:"primary",onClick:J},{default:l(()=>[e(o,null,{default:l(()=>[e(u(F))]),_:1}),t[8]||(t[8]=c(" 写文章 ",-1))]),_:1})):m("",!0)]),n("div",Pe,[e(X,{type:"info"},{default:l(()=>[c(" 共 "+_(b.value)+" 篇文章 ",1)]),_:1})])])]),_:1}),ue((r(),i(Z,{gutter:20},{default:l(()=>[(r(!0),y(I,null,S(T.value,a=>(r(),i(Q,{key:a.id,xs:24,sm:12,md:8},{default:l(()=>[e(D,{shadow:"hover",class:"article-card",onClick:h=>U(a)},{default:l(()=>[a.status==="draft"?(r(),y("div",Re," 草稿 ")):m("",!0),n("h3",je,_(a.title),1),n("div",Oe,_(a.summary||j(a.content,100)),1),a.tags&&a.tags.length>0?(r(),y("div",He,[(r(!0),y(I,null,S(a.tags.slice(0,3),(h,le)=>(r(),i(Y,{key:le,size:"small",type:"info"},{default:l(()=>[c(_(h),1)]),_:2},1024))),128))])):m("",!0),n("div",Je,[e(o,null,{default:l(()=>[e(u(Ce))]),_:1}),n("span",null,_(a.categoryLabel||"未分类"),1)]),n("div",qe,[n("div",Ge,[e(o,null,{default:l(()=>[e(u(be))]),_:1}),n("span",null,_(a.authorName),1)]),n("div",Ke,[e(o,null,{default:l(()=>[e(u(P))]),_:1}),n("span",null,_(a.viewCount||0),1)]),n("div",We,[e(o,null,{default:l(()=>[e(u(Ee))]),_:1}),n("span",null,_(a.usefulCount||0),1)]),n("div",Xe,[e(o,null,{default:l(()=>[e(u(xe))]),_:1}),n("span",null,_(u(Le)(a.publishTime||a.createTime)),1)])]),n("div",{class:"card-actions",onClick:t[3]||(t[3]=ze(()=>{},["stop"]))},[e(g,{link:"",type:"primary",size:"small",onClick:h=>U(a)},{default:l(()=>[e(o,null,{default:l(()=>[e(u(P))]),_:1}),t[9]||(t[9]=c(" 查看 ",-1))]),_:1},8,["onClick"]),N(a)?(r(),i(g,{key:0,link:"",type:"warning",size:"small",onClick:h=>q(a)},{default:l(()=>[e(o,null,{default:l(()=>[e(u(F))]),_:1}),t[10]||(t[10]=c(" 编辑 ",-1))]),_:1},8,["onClick"])):m("",!0),a.status==="draft"&&N(a)?(r(),i(g,{key:1,link:"",type:"success",size:"small",onClick:h=>G(a)},{default:l(()=>[e(o,null,{default:l(()=>[e(u(Ve))]),_:1}),t[11]||(t[11]=c(" 发布 ",-1))]),_:1},8,["onClick"])):m("",!0),u(V).hasPermission("knowledge:delete")?(r(),i(g,{key:2,link:"",type:"danger",size:"small",onClick:h=>K(a)},{default:l(()=>[e(o,null,{default:l(()=>[e(u(Te))]),_:1}),t[12]||(t[12]=c(" 删除 ",-1))]),_:1},8,["onClick"])):m("",!0)])]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})),[[ae,C.value]]),!C.value&&T.value.length===0?(r(),i(ee,{key:0,description:"暂无文章","image-size":200})):m("",!0),b.value>0?(r(),y("div",Ye,[e(te,{"current-page":f.current,"onUpdate:currentPage":t[4]||(t[4]=a=>f.current=a),"page-size":f.size,"onUpdate:pageSize":t[5]||(t[5]=a=>f.size=a),total:b.value,"page-sizes":[9,18,36,72],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:v,onCurrentChange:v},null,8,["current-page","page-size","total"])])):m("",!0)])}}},_t=se(Qe,[["__scopeId","data-v-3322907d"]]);export{_t as default};
