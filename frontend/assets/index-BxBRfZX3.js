import{av as h,_ as ce,a as F,r as _,z as fe,A as be,C as ye,c as w,o as d,d as t,w as o,K as C,b as V,E as _e,j as ve,k as ge,$ as ke,a0 as we,q as Ce,m as S,a1 as Ve,s,a2 as j,I as r,a8 as he,a4 as Ee,aw as Se,J as xe,a5 as z,G,H as O,t as H,a3 as Ue,a9 as Te,L as ze,F as $e,ax as De,ay as Ae,az as qe,aA as Be,ac as Le,x as v,ad as Fe}from"./index-DT2C5K_G.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                 *//* empty css                   *//* empty css                        *//* empty css                *//* empty css                      *//* empty css               *//* empty css                  */function He(i){return h({url:"/system/alarm-config/page",method:"get",params:i})}function Pe(i){return h({url:"/system/alarm-config",method:"post",data:i})}function Ie(i,g){return h({url:`/system/alarm-config/${i}`,method:"put",data:g})}function Me(i){return h({url:`/system/alarm-config/${i}`,method:"delete"})}function Ne(i,g){return h({url:`/system/alarm-config/${i}/enabled`,method:"put",params:{enabled:g}})}function Re(i){return h({url:`/system/alarm-config/${i}/test`,method:"post"})}const We={class:"app-container"},je={class:"card-header"},Ge={key:0},Oe={key:1},Je={class:"pagination"},Ke={style:{width:"100%"}},Qe={key:0,style:{"margin-bottom":"8px"}},Xe={__name:"index",setup(i){const g=[{code:"vuln_publish",label:"漏洞发布"},{code:"vuln_retest",label:"漏洞复测"},{code:"vuln_fix",label:"漏洞修复"},{code:"article_publish",label:"文章发布"},{code:"case_public",label:"漏洞案例公开"}],P=g.reduce((n,e)=>(n[e.code]=e.label,n),{});P.daily_summary="每日汇总推送";const c=F({keyword:"",enabled:null}),f=F({current:1,size:10}),$=_(!1),I=_(0),M=_([]),b=async()=>{$.value=!0;try{const n=await He({current:f.current,size:f.size,keyword:c.keyword||void 0,enabled:c.enabled});M.value=(n==null?void 0:n.records)||[],I.value=(n==null?void 0:n.total)||0}catch{v.error("查询告警配置失败")}finally{$.value=!1}},J=()=>{f.current=1,b()},K=()=>{c.keyword="",c.enabled=null,f.current=1,b()},k=_(!1),D=_(""),A=_(!1),x=_(null),l=F({id:null,name:"",webhookUrl:"",enabledSwitch:!0,updateSecret:!1,secret:"",eventCodes:[],dailyEnabledSwitch:!1,dailyTime:""}),q=fe(()=>!!l.id),Q={name:[{required:!0,message:"请输入名称",trigger:"blur"}],webhookUrl:[{required:!0,message:"请输入Webhook地址",trigger:"blur"}],dailyTime:[{required:!0,message:"请选择每日推送时间",trigger:"change"}]},X=()=>{D.value="新增告警配置",B(),k.value=!0},Y=n=>{D.value="编辑告警配置",B(),l.id=n.id,l.name=n.name,l.webhookUrl=n.webhookUrl,l.enabledSwitch=n.enabled===1,l.eventCodes=(n.eventCodes||[]).filter(e=>e!=="daily_summary"),l.dailyEnabledSwitch=n.dailyEnabled===1,l.dailyTime=n.dailyTime||"",l.updateSecret=!1,l.secret="",k.value=!0},Z=async n=>{try{await Fe.confirm(`确定删除配置「${n.name}」吗？`,"提示",{type:"warning"}),await Me(n.id),v.success("删除成功"),b()}catch{}},ee=async(n,e)=>{try{await Ne(n.id,e),v.success("操作成功")}catch{n.enabled=e===1?0:1}},le=async n=>{try{await Re(n.id),v.success("测试通知已发送")}catch{v.error("测试通知发送失败")}},ae=async()=>{x.value&&await x.value.validate(async n=>{if(n){A.value=!0;try{const e={name:l.name,webhookUrl:l.webhookUrl,enabled:l.enabledSwitch?1:0,eventCodes:l.eventCodes,dailyEnabled:l.dailyEnabledSwitch?1:0,dailyTime:l.dailyEnabledSwitch?l.dailyTime:null};q.value?(e.secret=l.updateSecret?l.secret:null,await Ie(l.id,e)):(e.secret=l.secret,await Pe(e)),v.success("保存成功"),k.value=!1,b()}catch{v.error("保存失败")}finally{A.value=!1}}})},B=()=>{var n,e;l.id=null,l.name="",l.webhookUrl="",l.enabledSwitch=!0,l.updateSecret=!1,l.secret="",l.eventCodes=[],l.dailyEnabledSwitch=!1,l.dailyTime="",(e=(n=x.value)==null?void 0:n.clearValidate)==null||e.call(n)},te=()=>{B()};return be(()=>{b()}),(n,e)=>{const u=Ce,U=ge,m=ve,N=we,oe=ke,R=_e,y=Ee,L=Se,T=xe,ne=he,de=Te,se=$e,W=De,ie=Ae,re=qe,ue=Be,me=Le,E=ye("permission"),pe=Ue;return d(),w("div",We,[t(se,{class:"table-card",shadow:"never"},{header:o(()=>[V("div",je,[e[16]||(e[16]=V("span",null,"告警管理",-1)),V("div",null,[C((d(),r(u,{type:"primary",icon:S(ze),onClick:X},{default:o(()=>[...e[14]||(e[14]=[s(" 新增配置 ",-1)])]),_:1},8,["icon"])),[[E,"system:alarm:add"]]),t(u,{icon:S(j),onClick:b},{default:o(()=>[...e[15]||(e[15]=[s("刷新",-1)])]),_:1},8,["icon"])])])]),default:o(()=>[t(R,{inline:!0,model:c,class:"query-form"},{default:o(()=>[t(m,{label:"关键词"},{default:o(()=>[t(U,{modelValue:c.keyword,"onUpdate:modelValue":e[0]||(e[0]=a=>c.keyword=a),placeholder:"名称/Webhook",clearable:"",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),t(m,{label:"状态"},{default:o(()=>[t(oe,{modelValue:c.enabled,"onUpdate:modelValue":e[1]||(e[1]=a=>c.enabled=a),placeholder:"全部",clearable:"",style:{width:"120px"}},{default:o(()=>[t(N,{label:"启用",value:1}),t(N,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1}),t(m,null,{default:o(()=>[t(u,{type:"primary",icon:S(Ve),onClick:J},{default:o(()=>[...e[17]||(e[17]=[s("查询",-1)])]),_:1},8,["icon"]),t(u,{icon:S(j),onClick:K},{default:o(()=>[...e[18]||(e[18]=[s("重置",-1)])]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"]),C((d(),r(ne,{data:M.value,border:"",stripe:""},{default:o(()=>[t(y,{label:"名称",prop:"name","min-width":"160"}),t(y,{label:"启用",width:"90"},{default:o(({row:a})=>[C(t(L,{modelValue:a.enabled,"onUpdate:modelValue":p=>a.enabled=p,"active-value":1,"inactive-value":0,onChange:p=>ee(a,p)},null,8,["modelValue","onUpdate:modelValue","onChange"]),[[E,"system:alarm:enable"]])]),_:1}),t(y,{label:"密钥",width:"100"},{default:o(({row:a})=>[a.secretConfigured?(d(),r(T,{key:0,type:"success"},{default:o(()=>[...e[19]||(e[19]=[s("已配置",-1)])]),_:1})):(d(),r(T,{key:1,type:"info"},{default:o(()=>[...e[20]||(e[20]=[s("未配置",-1)])]),_:1}))]),_:1}),t(y,{label:"事件勾选","min-width":"240"},{default:o(({row:a})=>[(d(!0),w(G,null,O(a.eventCodes||[],p=>(d(),r(T,{key:p,style:{"margin-right":"6px","margin-bottom":"6px"}},{default:o(()=>[s(H(S(P)[p]||p),1)]),_:2},1024))),128)),!a.eventCodes||!a.eventCodes.length?(d(),r(T,{key:0,type:"info"},{default:o(()=>[...e[21]||(e[21]=[s("无",-1)])]),_:1})):z("",!0)]),_:1}),t(y,{label:"每日汇总",width:"160"},{default:o(({row:a})=>[a.dailyEnabled===1?(d(),w("span",Ge,"启用（"+H(a.dailyTime||"-")+"）",1)):(d(),w("span",Oe,"禁用"))]),_:1}),t(y,{label:"更新时间",prop:"updateTime",width:"170"}),t(y,{label:"操作",fixed:"right",width:"220"},{default:o(({row:a})=>[C((d(),r(u,{link:"",type:"primary",onClick:p=>le(a)},{default:o(()=>[...e[22]||(e[22]=[s("测试",-1)])]),_:1},8,["onClick"])),[[E,"system:alarm:test"]]),C((d(),r(u,{link:"",type:"primary",onClick:p=>Y(a)},{default:o(()=>[...e[23]||(e[23]=[s("编辑",-1)])]),_:1},8,["onClick"])),[[E,"system:alarm:edit"]]),C((d(),r(u,{link:"",type:"danger",onClick:p=>Z(a)},{default:o(()=>[...e[24]||(e[24]=[s("删除",-1)])]),_:1},8,["onClick"])),[[E,"system:alarm:delete"]])]),_:1})]),_:1},8,["data"])),[[pe,$.value]]),V("div",Je,[t(de,{"current-page":f.current,"onUpdate:currentPage":e[2]||(e[2]=a=>f.current=a),"page-size":f.size,"onUpdate:pageSize":e[3]||(e[3]=a=>f.size=a),layout:"total, sizes, prev, pager, next, jumper",total:I.value,"page-sizes":[10,20,50,100],onSizeChange:b,onCurrentChange:b},null,8,["current-page","page-size","total"])])]),_:1}),t(me,{modelValue:k.value,"onUpdate:modelValue":e[13]||(e[13]=a=>k.value=a),title:D.value,width:"680px",onClose:te},{footer:o(()=>[t(u,{onClick:e[12]||(e[12]=a=>k.value=!1)},{default:o(()=>[...e[28]||(e[28]=[s("取消",-1)])]),_:1}),t(u,{type:"primary",loading:A.value,onClick:ae},{default:o(()=>[...e[29]||(e[29]=[s("确定",-1)])]),_:1},8,["loading"])]),default:o(()=>[t(R,{ref_key:"formRef",ref:x,model:l,rules:Q,"label-width":"110px"},{default:o(()=>[t(m,{label:"名称",prop:"name"},{default:o(()=>[t(U,{modelValue:l.name,"onUpdate:modelValue":e[4]||(e[4]=a=>l.name=a),placeholder:"如：安全群机器人"},null,8,["modelValue"])]),_:1}),t(m,{label:"Webhook",prop:"webhookUrl"},{default:o(()=>[t(U,{modelValue:l.webhookUrl,"onUpdate:modelValue":e[5]||(e[5]=a=>l.webhookUrl=a),placeholder:"钉钉机器人Webhook地址"},null,8,["modelValue"])]),_:1}),t(m,{label:"启用"},{default:o(()=>[t(L,{modelValue:l.enabledSwitch,"onUpdate:modelValue":e[6]||(e[6]=a=>l.enabledSwitch=a)},null,8,["modelValue"])]),_:1}),t(m,{label:"密钥"},{default:o(()=>[V("div",Ke,[q.value?(d(),w("div",Qe,[t(W,{modelValue:l.updateSecret,"onUpdate:modelValue":e[7]||(e[7]=a=>l.updateSecret=a)},{default:o(()=>[...e[25]||(e[25]=[s("修改/清空密钥",-1)])]),_:1},8,["modelValue"]),e[26]||(e[26]=V("span",{style:{"margin-left":"8px",color:"#909399"}}," （不勾选则保持原值） ",-1))])):z("",!0),!q.value||l.updateSecret?(d(),r(U,{key:1,modelValue:l.secret,"onUpdate:modelValue":e[8]||(e[8]=a=>l.secret=a),placeholder:"可选：机器人加签密钥；留空=清空","show-password":""},null,8,["modelValue"])):z("",!0)])]),_:1}),t(m,{label:"通知内容"},{default:o(()=>[t(ie,{modelValue:l.eventCodes,"onUpdate:modelValue":e[9]||(e[9]=a=>l.eventCodes=a)},{default:o(()=>[(d(),w(G,null,O(g,a=>t(W,{key:a.code,label:a.code},{default:o(()=>[s(H(a.label),1)]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])]),_:1}),t(re,{"content-position":"left"},{default:o(()=>[...e[27]||(e[27]=[s("每日汇总",-1)])]),_:1}),t(m,{label:"启用每日汇总"},{default:o(()=>[t(L,{modelValue:l.dailyEnabledSwitch,"onUpdate:modelValue":e[10]||(e[10]=a=>l.dailyEnabledSwitch=a)},null,8,["modelValue"])]),_:1}),l.dailyEnabledSwitch?(d(),r(m,{key:0,label:"推送时间",prop:"dailyTime"},{default:o(()=>[t(ue,{modelValue:l.dailyTime,"onUpdate:modelValue":e[11]||(e[11]=a=>l.dailyTime=a),format:"HH:mm","value-format":"HH:mm",placeholder:"选择时间",style:{width:"180px"}},null,8,["modelValue"])]),_:1})):z("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},rl=ce(Xe,[["__scopeId","data-v-eb56a1d5"]]);export{rl as default};
