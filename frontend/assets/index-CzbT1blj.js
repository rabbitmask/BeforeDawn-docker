import{_ as ee,r as d,a as F,z as te,c as ae,o as I,d as t,w as l,b as R,q as le,s,l as ne,m as p,J as $,ab as re,t as E,C as oe,I as se,G as U,a5 as de,a1 as ie,a2 as ue,ac as pe,H as me,a3 as ce,a4 as fe,a0 as _e,E as ve,j as ge,ad as ye,k as be,ae as he,a7 as ke,a8 as Ee,a9 as xe,x as v,aa as Ne}from"./index-bBUAzOnK.js";/* empty css                   *//* empty css                   *//* empty css                 *//* empty css                       *//* empty css                        *//* empty css               *//* empty css                  *//* empty css                *//* empty css                        *//* empty css                *//* empty css                       *//* empty css                */import{a as Ve}from"./index-BUyVPmSR.js";import{e as Ce,f as Te,h as Ie,i as Oe}from"./system-Dl4V20rG.js";const De={class:"page-container"},we={class:"toolbar"},Be={__name:"index",setup(Fe){const x=d(!1),c=d(!0),N=d(!1),A=d(),g=d([]),j=F({departmentName:"",status:null}),f=d([]),y=d([]),m=d(!1),V=d(""),C=d(!1),b=d(null),o=F({id:null,parentId:null,departmentName:"",sortOrder:0,status:1}),M={departmentName:[{required:!0,message:"请输入部门名称",trigger:"blur"}]},T=async()=>{x.value=!0;try{const a=await Ce(j);f.value=a||[],y.value=h(a,o.id),c.value&&(g.value=O(a))}catch(a){console.error("加载部门树失败:",a),v.error("加载部门树失败")}finally{x.value=!1}},h=(a,e)=>!a||a.length===0?[]:a.filter(r=>r.id!==e).map(r=>({id:r.id,departmentName:r.departmentName,children:r.children?h(r.children,e):[]})),S=()=>{c.value=!c.value,c.value?g.value=O(f.value):g.value=[]},O=a=>{const e=[],r=i=>{i&&i.forEach(u=>{e.push(u.id),u.children&&u.children.length>0&&r(u.children)})};return r(a),e},D=a=>{C.value=!1,V.value=a?`新增子部门 - ${a.departmentName}`:"新增部门",Object.assign(o,{id:null,parentId:a?a.id:null,departmentName:"",sortOrder:0,status:1}),y.value=h(f.value,null),m.value=!0},q=a=>{C.value=!0,V.value="编辑部门",Object.assign(o,{id:a.id,parentId:a.parentId,departmentName:a.departmentName,sortOrder:a.sortOrder,status:a.status}),y.value=h(f.value,a.id),m.value=!0},z=a=>{if(a.children&&a.children.length>0){v.warning("该部门下存在子部门，无法删除！");return}Ne.confirm(`确定要删除部门 "${a.departmentName}" 吗？此操作不可恢复！`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Te(a.id),v.success("删除部门成功"),T()}catch(e){console.error("删除部门失败:",e)}}).catch(()=>{})},G=()=>{var a;(a=b.value)==null||a.resetFields()},K=async()=>{b.value&&await b.value.validate(async a=>{if(a){N.value=!0;try{C.value?(await Ie(o.id,o),v.success("更新部门成功")):(await Oe(o),v.success("创建部门成功")),m.value=!1,T()}catch(e){console.error("保存部门失败:",e)}finally{N.value=!1}}})};return te(()=>{T()}),(a,e)=>{const r=ne,i=le,u=oe,_=ie,H=me,J=de,L=ye,k=ge,P=be,Q=he,w=Ee,W=ke,X=ve,Y=xe,Z=_e;return I(),ae("div",De,[t(u,{shadow:"never",class:"toolbar-card"},{default:l(()=>[R("div",we,[R("div",null,[t(i,{type:"primary",onClick:e[0]||(e[0]=n=>D(null))},{default:l(()=>[t(r,null,{default:l(()=>[t(p($))]),_:1}),e[7]||(e[7]=s(" 新增部门 ",-1))]),_:1}),t(i,{onClick:S},{default:l(()=>[t(r,null,{default:l(()=>[t(p(re))]),_:1}),s(" "+E(c.value?"折叠全部":"展开全部"),1)]),_:1})])])]),_:1}),t(u,{shadow:"never"},{default:l(()=>[se((I(),U(J,{ref_key:"deptTableRef",ref:A,data:f.value,"row-key":"id","expand-row-keys":g.value,"tree-props":{children:"children",hasChildren:"hasChildren"},border:"",style:{width:"100%"}},{default:l(()=>[t(_,{prop:"departmentName",label:"部门名称","min-width":"200"},{default:l(({row:n})=>[n.children&&n.children.length>0?(I(),U(r,{key:0,style:{"margin-right":"5px"}},{default:l(()=>[t(p(pe))]),_:1})):ue("",!0),s(" "+E(n.departmentName),1)]),_:1}),t(_,{prop:"sortOrder",label:"排序",width:"80",align:"center"}),t(_,{label:"状态",width:"80",align:"center"},{default:l(({row:n})=>[t(H,{type:n.status===1?"success":"danger",size:"small"},{default:l(()=>[s(E(n.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(_,{prop:"createTime",label:"创建时间",width:"180"},{default:l(({row:n})=>[s(E(p(Ve)(n.createTime)),1)]),_:1}),t(_,{label:"操作",width:"280",fixed:"right",align:"center"},{default:l(({row:n})=>[t(i,{link:"",type:"primary",onClick:B=>D(n)},{default:l(()=>[t(r,null,{default:l(()=>[t(p($))]),_:1}),e[8]||(e[8]=s(" 新增 ",-1))]),_:1},8,["onClick"]),t(i,{link:"",type:"warning",onClick:B=>q(n)},{default:l(()=>[t(r,null,{default:l(()=>[t(p(ce))]),_:1}),e[9]||(e[9]=s(" 编辑 ",-1))]),_:1},8,["onClick"]),t(i,{link:"",type:"danger",onClick:B=>z(n)},{default:l(()=>[t(r,null,{default:l(()=>[t(p(fe))]),_:1}),e[10]||(e[10]=s(" 删除 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data","expand-row-keys"])),[[Z,x.value]])]),_:1}),t(Y,{modelValue:m.value,"onUpdate:modelValue":e[6]||(e[6]=n=>m.value=n),title:V.value,width:"600px",onClose:G},{footer:l(()=>[t(i,{onClick:e[5]||(e[5]=n=>m.value=!1)},{default:l(()=>[...e[13]||(e[13]=[s("取消",-1)])]),_:1}),t(i,{type:"primary",onClick:K,loading:N.value},{default:l(()=>[...e[14]||(e[14]=[s(" 确定 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[t(X,{ref_key:"deptFormRef",ref:b,model:o,rules:M,"label-width":"100px"},{default:l(()=>[t(k,{label:"上级部门",prop:"parentId"},{default:l(()=>[t(L,{modelValue:o.parentId,"onUpdate:modelValue":e[1]||(e[1]=n=>o.parentId=n),data:y.value,props:{label:"departmentName",value:"id",children:"children"},placeholder:"请选择上级部门(为空则为顶级部门)",clearable:"","check-strictly":"","render-after-expand":!1,style:{width:"100%"}},null,8,["modelValue","data"])]),_:1}),t(k,{label:"部门名称",prop:"departmentName"},{default:l(()=>[t(P,{modelValue:o.departmentName,"onUpdate:modelValue":e[2]||(e[2]=n=>o.departmentName=n),placeholder:"请输入部门名称"},null,8,["modelValue"])]),_:1}),t(k,{label:"排序",prop:"sortOrder"},{default:l(()=>[t(Q,{modelValue:o.sortOrder,"onUpdate:modelValue":e[3]||(e[3]=n=>o.sortOrder=n),min:0,"controls-position":"right",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(k,{label:"状态",prop:"status"},{default:l(()=>[t(W,{modelValue:o.status,"onUpdate:modelValue":e[4]||(e[4]=n=>o.status=n)},{default:l(()=>[t(w,{value:1},{default:l(()=>[...e[11]||(e[11]=[s("启用",-1)])]),_:1}),t(w,{value:0},{default:l(()=>[...e[12]||(e[12]=[s("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Qe=ee(Be,[["__scopeId","data-v-1e6aff70"]]);export{Qe as default};
