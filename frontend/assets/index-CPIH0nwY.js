import{_ as X,c as q,r as b,z as Y,d as Z,x as i,f as l,w as a,p as W,ah as ee,E as le,h as ae,o as te,X as oe,Y as se,m as re,j as P,Z as ne,n as s,$ as ie,C as de,I as ue,G as p,a5 as pe,a1 as me,H as fe,a2 as x,i as be,aj as ye,a0 as _e,e as L,J as ve,a7 as Ve,a8 as ce,ad as ge,ae as Te,a9 as we,v as y,aa as ke}from"./index-CEScC7kL.js";/* empty css                   *//* empty css                   *//* empty css                 *//* empty css                        *//* empty css               *//* empty css                  *//* empty css                *//* empty css                        *//* empty css                *//* empty css                       *//* empty css                       *//* empty css                */import{k as Ee,q as Ce,r as Pe,s as xe,t as Ue}from"./system-CQ67kDOC.js";const Ne={class:"app-container"},Ie={class:"card-header"},Oe={__name:"index",setup(De){const d=q({keyword:"",permissionType:"",status:null}),T=b(!1),U=b([]),N=b([]),_=b(!1),w=b(""),k=b(null),o=q({id:null,permissionCode:"",permissionName:"",permissionType:"menu",parentId:0,resourcePath:"",method:"",icon:"",sortOrder:0,description:"",status:1}),R={permissionCode:[{required:!0,message:"请输入权限编码",trigger:"blur"},{pattern:/^[a-z0-9:_]+$/,message:"只能包含小写字母、数字、冒号和下划线",trigger:"blur"}],permissionName:[{required:!0,message:"请输入权限名称",trigger:"blur"}],permissionType:[{required:!0,message:"请选择权限类型",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},E=b(!1),V=async()=>{T.value=!0;try{const n=await Ee();U.value=n||[],N.value=[{id:0,permissionName:"顶级权限",children:n||[]}]}catch{y.error("查询权限列表失败")}finally{T.value=!1}},I=()=>{V()},S=()=>{d.keyword="",d.permissionType="",d.status=null,V()},H=()=>{w.value="新增权限",Object.assign(o,{id:null,permissionCode:"",permissionName:"",permissionType:"menu",parentId:0,resourcePath:"",method:"",icon:"",sortOrder:0,description:"",status:1}),_.value=!0},$=async n=>{w.value="编辑权限";try{const e=await Ce(n.id);Object.assign(o,e),_.value=!0}catch{y.error("获取权限详情失败")}},j=async()=>{await k.value.validate(),E.value=!0;try{o.id?(await xe(o.id,o),y.success("更新权限成功")):(await Ue(o),y.success("创建权限成功")),_.value=!1,V()}catch(n){y.error(n.message||"操作失败")}finally{E.value=!1}},G=n=>{ke.confirm("确定要删除该权限吗？如果有子权限将无法删除。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Pe(n.id),y.success("删除成功"),V()}catch(e){y.error(e.message||"删除失败")}}).catch(()=>{})},M=()=>{var n;(n=k.value)==null||n.resetFields()};return Y(()=>{V()}),(n,e)=>{const v=ae,r=le,u=se,C=oe,f=re,O=W,D=de,m=me,c=fe,A=be,F=pe,g=ce,B=Ve,h=ge,z=Te,K=we,J=_e;return i(),Z("div",Ne,[l(D,{class:"search-card",shadow:"never"},{default:a(()=>[l(O,{inline:!0,model:d,onSubmit:e[3]||(e[3]=ee(()=>{},["prevent"]))},{default:a(()=>[l(r,{label:"关键词"},{default:a(()=>[l(v,{modelValue:d.keyword,"onUpdate:modelValue":e[0]||(e[0]=t=>d.keyword=t),placeholder:"权限编码/权限名称",clearable:"",onKeyup:te(I,["enter"])},null,8,["modelValue"])]),_:1}),l(r,{label:"权限类型"},{default:a(()=>[l(C,{modelValue:d.permissionType,"onUpdate:modelValue":e[1]||(e[1]=t=>d.permissionType=t),clearable:"",placeholder:"请选择"},{default:a(()=>[l(u,{label:"菜单",value:"menu"}),l(u,{label:"按钮",value:"button"}),l(u,{label:"接口",value:"api"})]),_:1},8,["modelValue"])]),_:1}),l(r,{label:"状态"},{default:a(()=>[l(C,{modelValue:d.status,"onUpdate:modelValue":e[2]||(e[2]=t=>d.status=t),clearable:"",placeholder:"请选择"},{default:a(()=>[l(u,{label:"启用",value:1}),l(u,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1}),l(r,null,{default:a(()=>[l(f,{type:"primary",icon:P(ne),onClick:I},{default:a(()=>[...e[16]||(e[16]=[s("搜索",-1)])]),_:1},8,["icon"]),l(f,{icon:P(ie),onClick:S},{default:a(()=>[...e[17]||(e[17]=[s("重置",-1)])]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1}),l(D,{class:"table-card",shadow:"never"},{header:a(()=>[L("div",Ie,[e[19]||(e[19]=L("span",null,"权限列表",-1)),l(f,{type:"primary",icon:P(ve),onClick:H},{default:a(()=>[...e[18]||(e[18]=[s("新增权限",-1)])]),_:1},8,["icon"])])]),default:a(()=>[ue((i(),p(F,{data:U.value,"row-key":"id",border:"",stripe:"","default-expand-all":"","tree-props":{children:"children"}},{default:a(()=>[l(m,{label:"权限名称",prop:"permissionName","min-width":"200"}),l(m,{label:"权限编码",prop:"permissionCode",width:"200"}),l(m,{label:"权限类型",prop:"permissionType",width:"100"},{default:a(({row:t})=>[t.permissionType==="menu"?(i(),p(c,{key:0,type:"primary"},{default:a(()=>[...e[20]||(e[20]=[s("菜单",-1)])]),_:1})):t.permissionType==="button"?(i(),p(c,{key:1,type:"success"},{default:a(()=>[...e[21]||(e[21]=[s("按钮",-1)])]),_:1})):(i(),p(c,{key:2,type:"warning"},{default:a(()=>[...e[22]||(e[22]=[s("接口",-1)])]),_:1}))]),_:1}),l(m,{label:"资源路径",prop:"resourcePath","show-overflow-tooltip":"",width:"200"}),l(m,{label:"HTTP方法",prop:"method",width:"100"}),l(m,{label:"图标",prop:"icon",width:"80"},{default:a(({row:t})=>[t.icon?(i(),p(A,{key:0},{default:a(()=>[(i(),p(ye(t.icon)))]),_:2},1024)):x("",!0)]),_:1}),l(m,{label:"排序",prop:"sortOrder",width:"80"}),l(m,{label:"状态",prop:"status",width:"80"},{default:a(({row:t})=>[t.status===1?(i(),p(c,{key:0,type:"success"},{default:a(()=>[...e[23]||(e[23]=[s("启用",-1)])]),_:1})):(i(),p(c,{key:1,type:"danger"},{default:a(()=>[...e[24]||(e[24]=[s("禁用",-1)])]),_:1}))]),_:1}),l(m,{label:"操作",fixed:"right",width:"180"},{default:a(({row:t})=>[l(f,{link:"",type:"primary",onClick:Q=>$(t)},{default:a(()=>[...e[25]||(e[25]=[s("编辑",-1)])]),_:1},8,["onClick"]),l(f,{link:"",type:"danger",onClick:Q=>G(t)},{default:a(()=>[...e[26]||(e[26]=[s("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[J,T.value]])]),_:1}),l(K,{modelValue:_.value,"onUpdate:modelValue":e[15]||(e[15]=t=>_.value=t),title:w.value,width:"600px",onClose:M},{footer:a(()=>[l(f,{onClick:e[14]||(e[14]=t=>_.value=!1)},{default:a(()=>[...e[32]||(e[32]=[s("取消",-1)])]),_:1}),l(f,{type:"primary",loading:E.value,onClick:j},{default:a(()=>[...e[33]||(e[33]=[s("确定",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(O,{ref_key:"formRef",ref:k,model:o,rules:R,"label-width":"100px"},{default:a(()=>[l(r,{label:"权限编码",prop:"permissionCode"},{default:a(()=>[l(v,{modelValue:o.permissionCode,"onUpdate:modelValue":e[4]||(e[4]=t=>o.permissionCode=t),placeholder:"如：system:user:add"},null,8,["modelValue"])]),_:1}),l(r,{label:"权限名称",prop:"permissionName"},{default:a(()=>[l(v,{modelValue:o.permissionName,"onUpdate:modelValue":e[5]||(e[5]=t=>o.permissionName=t),placeholder:"如：新增用户"},null,8,["modelValue"])]),_:1}),l(r,{label:"权限类型",prop:"permissionType"},{default:a(()=>[l(B,{modelValue:o.permissionType,"onUpdate:modelValue":e[6]||(e[6]=t=>o.permissionType=t)},{default:a(()=>[l(g,{label:"menu"},{default:a(()=>[...e[27]||(e[27]=[s("菜单",-1)])]),_:1}),l(g,{label:"button"},{default:a(()=>[...e[28]||(e[28]=[s("按钮",-1)])]),_:1}),l(g,{label:"api"},{default:a(()=>[...e[29]||(e[29]=[s("接口",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(r,{label:"父权限"},{default:a(()=>[l(h,{modelValue:o.parentId,"onUpdate:modelValue":e[7]||(e[7]=t=>o.parentId=t),data:N.value,props:{children:"children",label:"permissionName",value:"id"},"check-strictly":"",placeholder:"请选择父权限（不选则为顶级权限）",clearable:""},null,8,["modelValue","data"])]),_:1}),l(r,{label:"资源路径"},{default:a(()=>[l(v,{modelValue:o.resourcePath,"onUpdate:modelValue":e[8]||(e[8]=t=>o.resourcePath=t),placeholder:"菜单路由或API路径"},null,8,["modelValue"])]),_:1}),o.permissionType==="api"?(i(),p(r,{key:0,label:"HTTP方法"},{default:a(()=>[l(C,{modelValue:o.method,"onUpdate:modelValue":e[9]||(e[9]=t=>o.method=t),placeholder:"请选择"},{default:a(()=>[l(u,{label:"GET",value:"GET"}),l(u,{label:"POST",value:"POST"}),l(u,{label:"PUT",value:"PUT"}),l(u,{label:"DELETE",value:"DELETE"}),l(u,{label:"PATCH",value:"PATCH"})]),_:1},8,["modelValue"])]),_:1})):x("",!0),o.permissionType==="menu"?(i(),p(r,{key:1,label:"图标"},{default:a(()=>[l(v,{modelValue:o.icon,"onUpdate:modelValue":e[10]||(e[10]=t=>o.icon=t),placeholder:"Element Plus图标名称"},null,8,["modelValue"])]),_:1})):x("",!0),l(r,{label:"排序"},{default:a(()=>[l(z,{modelValue:o.sortOrder,"onUpdate:modelValue":e[11]||(e[11]=t=>o.sortOrder=t),min:0},null,8,["modelValue"])]),_:1}),l(r,{label:"描述"},{default:a(()=>[l(v,{modelValue:o.description,"onUpdate:modelValue":e[12]||(e[12]=t=>o.description=t),type:"textarea",rows:3,placeholder:"权限描述"},null,8,["modelValue"])]),_:1}),l(r,{label:"状态",prop:"status"},{default:a(()=>[l(B,{modelValue:o.status,"onUpdate:modelValue":e[13]||(e[13]=t=>o.status=t)},{default:a(()=>[l(g,{label:1},{default:a(()=>[...e[30]||(e[30]=[s("启用",-1)])]),_:1}),l(g,{label:0},{default:a(()=>[...e[31]||(e[31]=[s("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Ke=X(Oe,[["__scopeId","data-v-c516a682"]]);export{Ke as default};
