import{_ as H,g as J,f as $,q as z,r as i,s as E,a as G,t as K,c,o as s,e as l,w as a,b as P,z as Q,aK as X,G as Y,C as p,h as W,j as Z,k as ee,X as te,F as T,B as S,Y as le,aw as ae,n as m,m as oe,H as re,A as L,aE as ne,aS as se,a0 as ue,E as de,aJ as ie,p as D}from"./index-D-KiCPd7.js";/* empty css                   *//* empty css                *//* empty css                 *//* empty css                   *//* empty css               *//* empty css                  *//* empty css                       */import{M as ce}from"./MarkdownEditor-BBZmQUfe.js";import{b as pe,u as me,c as ge}from"./knowledge-BqkRw3O0.js";import"./style-H_2_VudH.js";import"./file-SAR5oKAK.js";const ye={class:"page-container"},_e={class:"page-title"},fe={__name:"edit",setup(ve){const g=J(),h=$(),y=z(),_=i(!1),d=i(!1),f=i(null),v=E(()=>!!g.params.id),x=i([]),M=E(()=>y.getDictData("vuln_type")),A=E(()=>y.getDictData("asset_type")),o=G({title:"",summary:"",content:"",category:null,vulnType:"",assetType:"",techStack:""}),O={title:[{required:!0,message:"请输入文章标题",trigger:"blur"},{min:5,max:100,message:"标题长度5-100字符",trigger:"blur"}],content:[{required:!0,message:"请输入文章内容",trigger:"blur"},{min:10,message:"内容至少10字符",trigger:"blur"}],category:[{required:!0,message:"请选择文章分类",trigger:"change"}]},q=async()=>{try{const r=await ie("knowledge_category");x.value=r||[]}catch(r){console.error("加载分类列表失败:",r)}},F=async()=>{if(v.value){_.value=!0;try{const r=await pe(g.params.id);Object.assign(o,{title:r.title,summary:r.summary,content:r.content,category:r.category,vulnType:r.vulnType,assetType:r.assetType,techStack:r.techStack})}catch(r){console.error("加载文章详情失败:",r),D.error("加载文章详情失败")}finally{_.value=!1}}},B=async r=>{f.value&&await f.value.validate(async e=>{if(e){d.value=!0;try{const u={...o,status:r};v.value?(await me(g.params.id,u),D.success("更新文章成功")):(await ge(u),D.success("创建文章成功")),h.push("/knowledge/article")}catch(u){console.error("保存文章失败:",u)}finally{d.value=!1}}})},C=()=>{h.back()};return K(async()=>{await y.loadDicts(["knowledge_category","vuln_type","asset_type"]),q(),F()}),(r,e)=>{const u=X,b=ee,n=Z,V=le,w=te,I=ae,U=re,k=oe,R=W,N=de,j=ue;return s(),c("div",ye,[l(u,{onBack:C,class:"mb-20"},{content:a(()=>[P("span",_e,Q(v.value?"编辑文章":"创建文章"),1)]),_:1}),l(N,{shadow:"never"},{default:a(()=>[Y((s(),p(R,{ref_key:"formRef",ref:f,model:o,rules:O,"label-width":"100px"},{default:a(()=>[l(n,{label:"文章标题",prop:"title"},{default:a(()=>[l(b,{modelValue:o.title,"onUpdate:modelValue":e[0]||(e[0]=t=>o.title=t),placeholder:"请输入文章标题",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(n,{label:"文章摘要",prop:"summary"},{default:a(()=>[l(b,{modelValue:o.summary,"onUpdate:modelValue":e[1]||(e[1]=t=>o.summary=t),type:"textarea",rows:3,placeholder:"请输入文章摘要（选填）",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(n,{label:"文章分类",prop:"category"},{default:a(()=>[l(w,{modelValue:o.category,"onUpdate:modelValue":e[2]||(e[2]=t=>o.category=t),placeholder:"请选择分类",filterable:"",style:{width:"100%"}},{default:a(()=>[(s(!0),c(T,null,S(x.value,t=>(s(),p(V,{key:t.dictValue,label:t.dictLabel,value:t.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"文章内容",prop:"content"},{default:a(()=>[l(ce,{modelValue:o.content,"onUpdate:modelValue":e[3]||(e[3]=t=>o.content=t),placeholder:"请输入文章内容（支持Markdown语法）",height:"600px"},null,8,["modelValue"])]),_:1}),l(I,{"content-position":"left"},{default:a(()=>[...e[9]||(e[9]=[m("关联信息（选填）",-1)])]),_:1}),l(n,{label:"漏洞类型"},{default:a(()=>[l(w,{modelValue:o.vulnType,"onUpdate:modelValue":e[4]||(e[4]=t=>o.vulnType=t),placeholder:"请选择",clearable:"",style:{width:"100%"}},{default:a(()=>[(s(!0),c(T,null,S(M.value,t=>(s(),p(V,{key:t.dictValue,label:t.dictLabel,value:t.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"资产类型"},{default:a(()=>[l(w,{modelValue:o.assetType,"onUpdate:modelValue":e[5]||(e[5]=t=>o.assetType=t),placeholder:"请选择",clearable:"",style:{width:"100%"}},{default:a(()=>[(s(!0),c(T,null,S(A.value,t=>(s(),p(V,{key:t.dictValue,label:t.dictLabel,value:t.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"技术栈"},{default:a(()=>[l(b,{modelValue:o.techStack,"onUpdate:modelValue":e[6]||(e[6]=t=>o.techStack=t),placeholder:"如：Java, Spring Boot, MySQL",clearable:""},null,8,["modelValue"])]),_:1}),l(n,null,{default:a(()=>[l(k,{type:"primary",loading:d.value,onClick:e[7]||(e[7]=t=>B("published"))},{default:a(()=>[l(U,null,{default:a(()=>[l(L(ne))]),_:1}),e[10]||(e[10]=m(" 发布文章 ",-1))]),_:1},8,["loading"]),l(k,{loading:d.value,onClick:e[8]||(e[8]=t=>B("draft"))},{default:a(()=>[l(U,null,{default:a(()=>[l(L(se))]),_:1}),e[11]||(e[11]=m(" 保存草稿 ",-1))]),_:1},8,["loading"]),l(k,{onClick:C},{default:a(()=>[...e[12]||(e[12]=[m("取消",-1)])]),_:1})]),_:1})]),_:1},8,["model"])),[[j,_.value]])]),_:1})])}}},Ue=H(fe,[["__scopeId","data-v-0aa7b2c8"]]);export{Ue as default};
