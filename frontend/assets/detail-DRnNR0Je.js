import{_ as Y,i as ee,h as te,u as ae,y as se,r as y,z as I,A as le,c,o as i,d as a,K as oe,w as s,b as l,aN as ne,a3 as ie,I as p,D as ue,F as ce,a5 as _,t as o,aZ as re,l as de,m as u,n as _e,aX as ve,aJ as V,aW as B,af as me,G as L,H as R,J as pe,s as r,aL as fe,v as ye,q as he,a6 as ge,aE as ke,aF as be,T as we,N as Te,x}from"./index-DT2C5K_G.js";/* empty css                   *//* empty css               *//* empty css                             *//* empty css                *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                   *//* empty css                       */import{r as Ce}from"./style-CNpDB7o_.js";import{b as Ee,m as De,g as Ae}from"./knowledge-BnEsFMCO.js";import{f as C}from"./format-BQFyjrq8.js";const Ne={class:"page-container"},Se={class:"article-header"},Ie={class:"article-title"},Ve={class:"article-meta"},Be={class:"meta-item"},Le={class:"author-name"},Re={class:"meta-item"},xe={class:"meta-item"},ze={class:"meta-item"},Ue={class:"article-tags-section"},Me={key:0,class:"category-tag"},Fe={key:1,class:"tags-wrapper"},$e={key:0,class:"article-summary"},He={class:"summary-title"},Je={class:"article-footer"},qe={class:"related-info"},Ge={key:0,class:"info-item"},Ke={class:"info-value"},Pe={key:1,class:"info-item"},We={class:"info-value"},Xe={key:2,class:"info-item"},Ze={class:"info-value"},je={key:0,class:"recommend-list"},Oe=["onClick"],Qe={class:"rec-title"},Ye={class:"rec-meta"},et="https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png",tt={__name:"detail",setup(at){const z=ee(),h=te(),E=ae(),g=se(),k=y(!1),e=y({}),b=y(!1),w=y([]),U=I(()=>e.value.vulnType||e.value.assetType||e.value.techStack),M=I(()=>{var n;return e.value.authorId===((n=E.userInfo)==null?void 0:n.id)||E.hasRole("ADMIN")}),F=n=>g.getDictLabel("vuln_type",n),$=n=>g.getDictLabel("asset_type",n),D=async()=>{k.value=!0;try{const n=z.params.id,t=await Ee(n);e.value=t,(t.vulnType||t.assetType||t.techStack)&&H({vulnType:t.vulnType,assetType:t.assetType,techStack:t.techStack})}catch(n){console.error("加载文章详情失败:",n),x.error("加载文章详情失败")}finally{k.value=!1}},H=async n=>{try{const t=await Ae(n);w.value=(t||[]).filter(T=>T.id!==e.value.id)}catch(t){console.error("加载推荐文章失败:",t)}},J=()=>{h.back()},q=async()=>{try{await De(e.value.id),e.value.usefulCount=(e.value.usefulCount||0)+1,b.value=!0,x.success("点赞成功")}catch(n){console.error("点赞失败:",n)}},G=()=>{h.push(`/knowledge/article/edit/${e.value.id}`)},K=n=>{h.push(`/knowledge/article/detail/${n}`),D()};return le(async()=>{await g.loadDicts(["vuln_type","asset_type"]),D()}),(n,t)=>{const T=ne,v=de,P=re,W=pe,X=fe,A=he,f=ce,N=ue,m=be,Z=ke,j=we,O=Te,Q=ie;return i(),c("div",Ne,[a(T,{onBack:J,class:"mb-20"},{content:s(()=>[...t[1]||(t[1]=[l("span",{class:"page-title"},"文章详情",-1)])]),_:1}),oe((i(),p(O,{gutter:20},{default:s(()=>[a(N,{span:18},{default:s(()=>[a(f,{shadow:"never",class:"article-card"},{default:s(()=>[l("div",Se,[l("h1",Ie,o(e.value.title),1),l("div",Ve,[l("div",Be,[a(P,{size:32,src:et},{default:s(()=>[a(v,null,{default:s(()=>[a(u(_e))]),_:1})]),_:1}),l("span",Le,o(e.value.authorName),1)]),l("div",Re,[a(v,null,{default:s(()=>[a(u(ve))]),_:1}),l("span",null,o(u(C)(e.value.publishTime||e.value.createTime)),1)]),l("div",xe,[a(v,null,{default:s(()=>[a(u(V))]),_:1}),l("span",null,o(e.value.viewCount||0)+" 浏览",1)]),l("div",ze,[a(v,null,{default:s(()=>[a(u(B))]),_:1}),l("span",null,o(e.value.usefulCount||0)+" 点赞",1)])]),l("div",Ue,[e.value.categoryName?(i(),c("div",Me,[a(v,null,{default:s(()=>[a(u(me))]),_:1}),l("span",null,o(e.value.categoryName),1)])):_("",!0),e.value.tags&&e.value.tags.length>0?(i(),c("div",Fe,[(i(!0),c(L,null,R(e.value.tags,(d,S)=>(i(),p(W,{key:S,type:"info"},{default:s(()=>[r(o(d),1)]),_:2},1024))),128))])):_("",!0)])]),e.value.summary?(i(),c("div",$e,[a(X,{type:"info",closable:!1},{title:s(()=>[l("div",He,[a(v,null,{default:s(()=>[a(u(ye))]),_:1}),t[2]||(t[2]=l("span",null,"内容摘要",-1))])]),default:s(()=>[r(" "+o(e.value.summary),1)]),_:1})])):_("",!0),a(u(Ce),{modelValue:e.value.content,"onUpdate:modelValue":t[0]||(t[0]=d=>e.value.content=d),language:"zh-CN",class:"article-content"},null,8,["modelValue"]),l("div",Je,[a(A,{type:"primary",icon:u(B),onClick:q,disabled:b.value},{default:s(()=>[r(o(b.value?"已点赞":"觉得有用")+" ("+o(e.value.usefulCount||0)+") ",1)]),_:1},8,["icon","disabled"]),M.value?(i(),p(A,{key:0,type:"warning",icon:u(ge),onClick:G},{default:s(()=>[...t[3]||(t[3]=[r(" 编辑文章 ",-1)])]),_:1},8,["icon"])):_("",!0)])]),_:1})]),_:1}),a(N,{span:6},{default:s(()=>[a(f,{shadow:"never",class:"mb-20"},{header:s(()=>[...t[4]||(t[4]=[l("span",null,"文章信息",-1)])]),default:s(()=>[a(Z,{column:1,border:"",size:"small"},{default:s(()=>[a(m,{label:"文章编号"},{default:s(()=>[r(o(e.value.articleCode),1)]),_:1}),a(m,{label:"浏览次数"},{default:s(()=>[r(o(e.value.viewCount||0),1)]),_:1}),a(m,{label:"引用次数"},{default:s(()=>[r(o(e.value.referenceCount||0),1)]),_:1}),a(m,{label:"点赞次数"},{default:s(()=>[r(o(e.value.usefulCount||0),1)]),_:1}),a(m,{label:"发布时间"},{default:s(()=>[r(o(u(C)(e.value.publishTime)),1)]),_:1}),a(m,{label:"更新时间"},{default:s(()=>[r(o(u(C)(e.value.updateTime)),1)]),_:1})]),_:1})]),_:1}),U.value?(i(),p(f,{key:0,shadow:"never",class:"mb-20"},{header:s(()=>[...t[5]||(t[5]=[l("span",null,"关联信息",-1)])]),default:s(()=>[l("div",qe,[e.value.vulnType?(i(),c("div",Ge,[t[6]||(t[6]=l("div",{class:"info-label"},"漏洞类型",-1)),l("div",Ke,o(F(e.value.vulnType)),1)])):_("",!0),e.value.assetType?(i(),c("div",Pe,[t[7]||(t[7]=l("div",{class:"info-label"},"资产类型",-1)),l("div",We,o($(e.value.assetType)),1)])):_("",!0),e.value.techStack?(i(),c("div",Xe,[t[8]||(t[8]=l("div",{class:"info-label"},"技术栈",-1)),l("div",Ze,o(e.value.techStack),1)])):_("",!0)])]),_:1})):_("",!0),a(f,{shadow:"never"},{header:s(()=>[...t[9]||(t[9]=[l("span",null,"相关文章",-1)])]),default:s(()=>[w.value.length>0?(i(),c("div",je,[(i(!0),c(L,null,R(w.value,d=>(i(),c("div",{key:d.id,class:"recommend-item",onClick:S=>K(d.id)},[l("h4",Qe,o(d.title),1),l("div",Ye,[a(v,null,{default:s(()=>[a(u(V))]),_:1}),l("span",null,o(d.viewCount||0),1)])],8,Oe))),128))])):(i(),p(j,{key:1,description:"暂无推荐","image-size":80}))]),_:1})]),_:1})]),_:1})),[[Q,k.value]])])}}},ft=Y(tt,[["__scopeId","data-v-0505ae96"]]);export{ft as default};
