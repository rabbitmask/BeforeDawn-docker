import{_ as Z,a as ee,u as te,b as ae,r as y,y as N,z as se,d as c,x as i,f as a,I as le,w as s,e as l,aq as oe,a0 as ne,G as p,B as ie,C as ue,a2 as _,t as o,aD as ce,i as re,j as u,k as de,aB as _e,au as I,aA as V,ac as ve,F as L,D as R,H as me,n as r,an as pe,q as fe,m as ye,a3 as he,ar as ge,as as ke,S as be,L as we,v as x}from"./index-UXitE9cW.js";/* empty css                   *//* empty css               *//* empty css                             *//* empty css                *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                       */import{r as Te}from"./style-Y4lxmV2y.js";import{u as Ce}from"./dict-Ce4vKnBr.js";import{b as Ee,m as De,g as Ae}from"./knowledge-D3v4TZqr.js";import{f as C}from"./format-BQFyjrq8.js";import"./dict-BYKLDGau.js";const Se={class:"page-container"},Be={class:"article-header"},Ne={class:"article-title"},Ie={class:"article-meta"},Ve={class:"meta-item"},Le={class:"author-name"},Re={class:"meta-item"},xe={class:"meta-item"},ze={class:"meta-item"},Ue={class:"article-tags-section"},Me={key:0,class:"category-tag"},$e={key:1,class:"tags-wrapper"},qe={key:0,class:"article-summary"},Fe={class:"summary-title"},He={class:"article-footer"},je={class:"related-info"},Ge={key:0,class:"info-item"},Pe={class:"info-value"},Je={key:1,class:"info-item"},Ke={class:"info-value"},Oe={key:2,class:"info-item"},Qe={class:"info-value"},We={key:0,class:"recommend-list"},Xe=["onClick"],Ye={class:"rec-title"},Ze={class:"rec-meta"},et="https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png",tt={__name:"detail",setup(at){const z=ee(),h=te(),E=ae(),g=Ce(),k=y(!1),e=y({}),b=y(!1),w=y([]),U=N(()=>e.value.vulnType||e.value.assetType||e.value.techStack),M=N(()=>{var n;return e.value.authorId===((n=E.userInfo)==null?void 0:n.id)||E.hasRole("ADMIN")}),$=n=>g.getDictLabel("vuln_type",n),q=n=>g.getDictLabel("asset_type",n),D=async()=>{k.value=!0;try{const n=z.params.id,t=await Ee(n);e.value=t,(t.vulnType||t.assetType||t.techStack)&&F({vulnType:t.vulnType,assetType:t.assetType,techStack:t.techStack})}catch(n){console.error("加载文章详情失败:",n),x.error("加载文章详情失败")}finally{k.value=!1}},F=async n=>{try{const t=await Ae(n);w.value=(t||[]).filter(T=>T.id!==e.value.id)}catch(t){console.error("加载推荐文章失败:",t)}},H=()=>{h.back()},j=async()=>{try{await De(e.value.id),e.value.usefulCount=(e.value.usefulCount||0)+1,b.value=!0,x.success("点赞成功")}catch(n){console.error("点赞失败:",n)}},G=()=>{h.push(`/knowledge/article/edit/${e.value.id}`)},P=n=>{h.push(`/knowledge/article/detail/${n}`),D()};return se(async()=>{await g.loadDicts(["vuln_type","asset_type"]),D()}),(n,t)=>{const T=oe,v=re,J=ce,K=me,O=pe,A=ye,f=ue,S=ie,m=ke,Q=ge,W=be,X=we,Y=ne;return i(),c("div",Se,[a(T,{onBack:H,class:"mb-20"},{content:s(()=>[...t[1]||(t[1]=[l("span",{class:"page-title"},"文章详情",-1)])]),_:1}),le((i(),p(X,{gutter:20},{default:s(()=>[a(S,{span:18},{default:s(()=>[a(f,{shadow:"never",class:"article-card"},{default:s(()=>[l("div",Be,[l("h1",Ne,o(e.value.title),1),l("div",Ie,[l("div",Ve,[a(J,{size:32,src:et},{default:s(()=>[a(v,null,{default:s(()=>[a(u(de))]),_:1})]),_:1}),l("span",Le,o(e.value.authorName),1)]),l("div",Re,[a(v,null,{default:s(()=>[a(u(_e))]),_:1}),l("span",null,o(u(C)(e.value.publishTime||e.value.createTime)),1)]),l("div",xe,[a(v,null,{default:s(()=>[a(u(I))]),_:1}),l("span",null,o(e.value.viewCount||0)+" 浏览",1)]),l("div",ze,[a(v,null,{default:s(()=>[a(u(V))]),_:1}),l("span",null,o(e.value.usefulCount||0)+" 点赞",1)])]),l("div",Ue,[e.value.categoryName?(i(),c("div",Me,[a(v,null,{default:s(()=>[a(u(ve))]),_:1}),l("span",null,o(e.value.categoryName),1)])):_("",!0),e.value.tags&&e.value.tags.length>0?(i(),c("div",$e,[(i(!0),c(L,null,R(e.value.tags,(d,B)=>(i(),p(K,{key:B,type:"info"},{default:s(()=>[r(o(d),1)]),_:2},1024))),128))])):_("",!0)])]),e.value.summary?(i(),c("div",qe,[a(O,{type:"info",closable:!1},{title:s(()=>[l("div",Fe,[a(v,null,{default:s(()=>[a(u(fe))]),_:1}),t[2]||(t[2]=l("span",null,"内容摘要",-1))])]),default:s(()=>[r(" "+o(e.value.summary),1)]),_:1})])):_("",!0),a(u(Te),{modelValue:e.value.content,"onUpdate:modelValue":t[0]||(t[0]=d=>e.value.content=d),language:"zh-CN",class:"article-content"},null,8,["modelValue"]),l("div",He,[a(A,{type:"primary",icon:u(V),onClick:j,disabled:b.value},{default:s(()=>[r(o(b.value?"已点赞":"觉得有用")+" ("+o(e.value.usefulCount||0)+") ",1)]),_:1},8,["icon","disabled"]),M.value?(i(),p(A,{key:0,type:"warning",icon:u(he),onClick:G},{default:s(()=>[...t[3]||(t[3]=[r(" 编辑文章 ",-1)])]),_:1},8,["icon"])):_("",!0)])]),_:1})]),_:1}),a(S,{span:6},{default:s(()=>[a(f,{shadow:"never",class:"mb-20"},{header:s(()=>[...t[4]||(t[4]=[l("span",null,"文章信息",-1)])]),default:s(()=>[a(Q,{column:1,border:"",size:"small"},{default:s(()=>[a(m,{label:"文章编号"},{default:s(()=>[r(o(e.value.articleCode),1)]),_:1}),a(m,{label:"浏览次数"},{default:s(()=>[r(o(e.value.viewCount||0),1)]),_:1}),a(m,{label:"引用次数"},{default:s(()=>[r(o(e.value.referenceCount||0),1)]),_:1}),a(m,{label:"点赞次数"},{default:s(()=>[r(o(e.value.usefulCount||0),1)]),_:1}),a(m,{label:"发布时间"},{default:s(()=>[r(o(u(C)(e.value.publishTime)),1)]),_:1}),a(m,{label:"更新时间"},{default:s(()=>[r(o(u(C)(e.value.updateTime)),1)]),_:1})]),_:1})]),_:1}),U.value?(i(),p(f,{key:0,shadow:"never",class:"mb-20"},{header:s(()=>[...t[5]||(t[5]=[l("span",null,"关联信息",-1)])]),default:s(()=>[l("div",je,[e.value.vulnType?(i(),c("div",Ge,[t[6]||(t[6]=l("div",{class:"info-label"},"漏洞类型",-1)),l("div",Pe,o($(e.value.vulnType)),1)])):_("",!0),e.value.assetType?(i(),c("div",Je,[t[7]||(t[7]=l("div",{class:"info-label"},"资产类型",-1)),l("div",Ke,o(q(e.value.assetType)),1)])):_("",!0),e.value.techStack?(i(),c("div",Oe,[t[8]||(t[8]=l("div",{class:"info-label"},"技术栈",-1)),l("div",Qe,o(e.value.techStack),1)])):_("",!0)])]),_:1})):_("",!0),a(f,{shadow:"never"},{header:s(()=>[...t[9]||(t[9]=[l("span",null,"相关文章",-1)])]),default:s(()=>[w.value.length>0?(i(),c("div",We,[(i(!0),c(L,null,R(w.value,d=>(i(),c("div",{key:d.id,class:"recommend-item",onClick:B=>P(d.id)},[l("h4",Ye,o(d.title),1),l("div",Ze,[a(v,null,{default:s(()=>[a(u(I))]),_:1}),l("span",null,o(d.viewCount||0),1)])],8,Xe))),128))])):(i(),p(W,{key:1,description:"暂无推荐","image-size":80}))]),_:1})]),_:1})]),_:1})),[[Y,k.value]])])}}},yt=Z(tt,[["__scopeId","data-v-b7562895"]]);export{yt as default};
